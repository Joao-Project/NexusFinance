<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nexus Finance | Dashboard Inteligente Premium</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="firebase-config.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', 'Segoe UI', system-ui, sans-serif;
        }


        :root {
            --primary: #0066FF;
            --primary-dark: #0052CC;
            --primary-light: #3391FF;
            --secondary: #FF6B35;
            --accent: #00D4AA;
            --danger: #FF4757;
            --warning: #FFA502;
            --success: #00D4AA;
            --economy: #9B59B6;
            --dark: #1A1D29;
            --darker: #151822;
            --light: #F8FAFC;
            --gray: #64748B;
            --gray-dark: #334155;
            --card-bg: rgba(255, 255, 255, 0.05);
            --glass: rgba(255, 255, 255, 0.1);
            --glass-border: rgba(255, 255, 255, 0.2);
        }


        body {
            background: linear-gradient(135deg, var(--darker) 0%, var(--dark) 50%, #2D1B69 100%);
            color: var(--light);
            min-height: 100vh;
            overflow-x: hidden;
        }


        .app-container {
            display: flex;
            min-height: 100vh;
        }


        /* Sidebar */
        .sidebar {
            width: 280px;
            background: var(--card-bg);
            backdrop-filter: blur(20px);
            border-right: 1px solid var(--glass-border);
            padding: 25px 0;
            display: flex;
            flex-direction: column;
        }


        .sidebar-header {
            padding: 0 25px 25px;
            border-bottom: 1px solid var(--glass-border);
            margin-bottom: 25px;
        }


        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 1.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary), var(--success));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }


        .logo i {
            font-size: 1.8rem;
        }


        .nav-menu {
            flex: 1;
            padding: 0 15px;
        }


        .nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 15px 20px;
            border-radius: 12px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            color: var(--gray);
            font-weight: 500;
        }


        .nav-item.active {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            box-shadow: 0 4px 15px rgba(0, 102, 255, 0.3);
        }


        .nav-item:hover:not(.active) {
            background: rgba(255, 255, 255, 0.05);
            color: var(--light);
        }


        .nav-item i {
            width: 20px;
            text-align: center;
        }


        .sidebar-footer {
            padding: 20px 25px 0;
            border-top: 1px solid var(--glass-border);
            margin-top: auto;
        }


        .user-card {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
        }


        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--success));
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            font-size: 0.9rem;
        }


        .user-info {
            flex: 1;
        }


        .user-name {
            font-weight: 600;
            font-size: 0.9rem;
        }


        .user-email {
            font-size: 0.75rem;
            color: var(--gray);
        }


        .logout-btn {
            background: none;
            border: none;
            color: var(--danger);
            cursor: pointer;
            padding: 5px;
            border-radius: 6px;
            transition: all 0.3s ease;
        }


        .logout-btn:hover {
            background: var(--danger);
            color: white;
        }


        /* Main Content */
        .main-content {
            flex: 1;
            padding: 25px;
            overflow-y: auto;
        }


        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }


        .header-title {
            font-size: 1.8rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary), var(--success));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }


        .header-actions {
            display: flex;
            gap: 15px;
            align-items: center;
        }


        /* Novo Design para Filtro de Data */
        .date-filter-container {
            display: flex;
            align-items: center;
            gap: 10px;
            background: var(--card-bg);
            padding: 12px 20px;
            border-radius: 16px;
            border: 1px solid var(--glass-border);
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }


        .date-filter-container i {
            color: var(--primary);
            font-size: 1.1rem;
        }


        .date-select {
            background: transparent;
            border: none;
            color: var(--light);
            font-weight: 500;
            font-size: 0.95rem;
            padding: 5px 10px;
            border-radius: 8px;
            cursor: pointer;
            outline: none;
            transition: all 0.3s ease;
        }


        .date-select:hover {
            background: rgba(255, 255, 255, 0.05);
        }


        .date-select option {
            background: var(--dark);
            color: var(--light);
        }


        /* Tab Content */
        .tab-content {
            display: none;
        }


        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }


        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }


        /* Dashboard Grid */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }


        .stat-card {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 25px;
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            cursor: pointer;
        }


        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
        }


        .stat-card.revenue::before { background: var(--success); }
        .stat-card.essential::before { background: var(--primary); }
        .stat-card.non-essential::before { background: var(--secondary); }
        .stat-card.economy::before { background: var(--economy); }


        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3);
        }


        .stat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }


        .stat-title {
            font-size: 0.9rem;
            color: var(--gray);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }


        .stat-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }


        .stat-card.revenue .stat-icon { background: rgba(0, 212, 170, 0.2); color: var(--success); }
        .stat-card.essential .stat-icon { background: rgba(0, 102, 255, 0.2); color: var(--primary); }
        .stat-card.non-essential .stat-icon { background: rgba(255, 107, 53, 0.2); color: var(--secondary); }
        .stat-card.economy .stat-icon { background: rgba(155, 89, 182, 0.2); color: var(--economy); }


        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 8px;
        }


        .stat-change {
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            gap: 4px;
        }


        .stat-change.positive { color: var(--success); }
        .stat-change.negative { color: var(--danger); }


        /* Charts Grid */
        .charts-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }


        .chart-section {
            display: grid;
            gap: 20px;
        }


        .chart-section.full-width {
            grid-template-columns: 1fr;
        }


        .chart-section.half-width {
            grid-template-columns: 1fr 1fr;
        }


        .chart-card {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 25px;
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
        }


        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }


        .chart-title {
            font-size: 1.1rem;
            font-weight: 600;
        }


        .chart-actions {
            display: flex;
            gap: 8px;
        }


        .chart-container {
            position: relative;
            height: 300px;
        }


        /* Quick Actions */
        .quick-actions {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }


        .action-card {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 25px;
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
        }


        .action-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 102, 255, 0.2);
            border-color: var(--primary);
        }


        .action-icon {
            width: 60px;
            height: 60px;
            border-radius: 15px;
            background: linear-gradient(135deg, var(--primary), var(--success));
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 15px;
            font-size: 1.5rem;
        }


        .action-title {
            font-weight: 600;
            margin-bottom: 8px;
        }


        .action-description {
            font-size: 0.8rem;
            color: var(--gray);
        }


        /* Recent Activity */
        .activity-section {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 25px;
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            margin-bottom: 30px;
        }


        .activity-list {
            max-height: 400px;
            overflow-y: auto;
        }


        .activity-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }


        .activity-item:last-child {
            border-bottom: none;
        }


        .activity-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
        }


        .activity-icon.income { background: rgba(0, 212, 170, 0.2); color: var(--success); }
        .activity-icon.expense { background: rgba(255, 107, 53, 0.2); color: var(--secondary); }
        .activity-icon.transfer { background: rgba(0, 102, 255, 0.2); color: var(--primary); }


        .activity-content {
            flex: 1;
        }


        .activity-title {
            font-weight: 600;
            margin-bottom: 4px;
        }


        .activity-description {
            font-size: 0.8rem;
            color: var(--gray);
        }


        .activity-amount {
            font-weight: 600;
            text-align: right;
        }


        .activity-amount.positive { color: var(--success); }
        .activity-amount.negative { color: var(--secondary); }


        .activity-actions {
            display: flex;
            gap: 5px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }


        .activity-item:hover .activity-actions {
            opacity: 1;
        }


        /* Goals Progress */
        .goals-section {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }


        .goal-card {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 25px;
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
        }


        .goal-item {
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }


        .goal-item:last-child {
            margin-bottom: 0;
            padding-bottom: 0;
            border-bottom: none;
        }


        .goal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }


        .goal-name {
            font-weight: 600;
        }


        .goal-amount {
            font-weight: 700;
            color: var(--success);
        }


        .goal-progress {
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 8px;
        }


        .goal-progress-bar {
            height: 100%;
            background: linear-gradient(135deg, var(--primary), var(--success));
            border-radius: 4px;
            transition: width 0.5s ease;
        }


        .goal-info {
            display: flex;
            justify-content: space-between;
            font-size: 0.8rem;
            color: var(--gray);
        }


        .goal-actions {
            display: flex;
            gap: 5px;
            margin-top: 10px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }


        .goal-item:hover .goal-actions {
            opacity: 1;
        }


        /* AI Insights */
        .ai-insights {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 25px;
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            position: relative;
        }


        .ai-insights::before {
            content: 'ü§ñ';
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 1.5rem;
            opacity: 0.3;
        }


        .insight-item {
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            margin-bottom: 15px;
            border-left: 4px solid var(--primary);
        }


        .insight-item.warning {
            border-left-color: var(--warning);
        }


        .insight-item.success {
            border-left-color: var(--success);
        }


        .insight-title {
            font-weight: 600;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }


        .insight-content {
            font-size: 0.9rem;
            color: var(--gray);
            line-height: 1.5;
        }


        /* List Sections */
        .list-section {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 25px;
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            margin-bottom: 30px;
        }


        .list-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }


        .list-title {
            font-size: 1.3rem;
            font-weight: 600;
        }


        .list-actions {
            display: flex;
            gap: 10px;
        }


        .items-list {
            max-height: 500px;
            overflow-y: auto;
        }


        .list-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            transition: background-color 0.3s ease;
        }


        .list-item:hover {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
        }


        .list-item:last-child {
            border-bottom: none;
        }


        .list-item-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
        }


        .list-item-content {
            flex: 1;
        }


        .list-item-title {
            font-weight: 600;
            margin-bottom: 4px;
        }


        .list-item-description {
            font-size: 0.8rem;
            color: var(--gray);
        }


        .list-item-amount {
            font-weight: 600;
            text-align: right;
            margin-right: 10px;
        }


        .list-item-amount.positive { color: var(--success); }
        .list-item-amount.negative { color: var(--secondary); }


        .list-item-actions {
            display: flex;
            gap: 5px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }


        .list-item:hover .list-item-actions {
            opacity: 1;
        }


        /* Transaction Tabs */
        .transaction-tabs {
            display: flex;
            background: var(--card-bg);
            border-radius: 12px;
            padding: 8px;
            margin-bottom: 20px;
            border: 1px solid var(--glass-border);
        }


        .transaction-tab {
            flex: 1;
            padding: 12px 20px;
            text-align: center;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.3s ease;
            font-weight: 600;
            color: var(--gray);
        }


        .transaction-tab.active {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
        }


        /* Add Forms */
        .add-form {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 25px;
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            margin-bottom: 30px;
        }


        .form-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }


        .form-title {
            font-size: 1.2rem;
            font-weight: 600;
        }


        /* Buttons */
        .btn {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            border: none;
            border-radius: 10px;
            padding: 12px 20px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
        }


        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 102, 255, 0.3);
        }


        .btn-success {
            background: linear-gradient(135deg, var(--success), #00b894);
        }


        .btn-danger {
            background: linear-gradient(135deg, var(--danger), #ff3838);
        }


        .btn-outline {
            background: transparent;
            border: 1px solid var(--glass-border);
            color: var(--light);
        }


        .btn-outline:hover {
            background: var(--glass);
        }


        .btn-sm {
            padding: 8px 15px;
            font-size: 0.8rem;
        }


        .btn-xs {
            padding: 5px 10px;
            font-size: 0.7rem;
        }


        /* Forms */
        .form-group {
            margin-bottom: 20px;
        }


        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--gray);
            font-size: 0.9rem;
        }


        .form-input {
            width: 100%;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid var(--glass-border);
            border-radius: 10px;
            padding: 12px 15px;
            color: var(--light);
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }


        .form-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(0, 102, 255, 0.2);
        }


        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }


        .form-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 20px;
        }


        /* Modals */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }


        .modal.active {
            display: flex;
        }


        .modal-content {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 30px;
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            animation: modalSlideIn 0.3s ease;
        }


        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50px) scale(0.9);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }


        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--glass-border);
        }


        .modal-title {
            font-size: 1.3rem;
            font-weight: 600;
        }


        .modal-close {
            background: none;
            border: none;
            color: var(--gray);
            font-size: 1.5rem;
            cursor: pointer;
            padding: 5px;
        }


        .modal-close:hover {
            color: var(--light);
        }


        /* Notifications */
        .notification-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 10000;
        }


        .notification {
            background: var(--card-bg);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            padding: 15px 20px;
            margin-bottom: 10px;
            backdrop-filter: blur(20px);
            animation: slideInRight 0.3s ease;
            display: flex;
            align-items: center;
            gap: 12px;
            min-width: 300px;
        }


        .notification.success {
            border-left: 4px solid var(--success);
        }


        .notification.error {
            border-left: 4px solid var(--danger);
        }


        .notification.warning {
            border-left: 4px solid var(--warning);
        }


        .notification.info {
            border-left: 4px solid var(--primary);
        }


        .notification-icon {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            color: white;
        }


        .notification.success .notification-icon {
            background: var(--success);
        }


        .notification.error .notification-icon {
            background: var(--danger);
        }


        .notification.warning .notification-icon {
            background: var(--warning);
        }


        .notification.info .notification-icon {
            background: var(--primary);
        }


        .notification-close {
            background: none;
            border: none;
            color: var(--gray);
            cursor: pointer;
            padding: 5px;
            margin-left: auto;
        }


        .notification-close:hover {
            color: var(--light);
        }


        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(100%);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }


        /* Empty States */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--gray);
        }


        .empty-state i {
            font-size: 4rem;
            margin-bottom: 20px;
            opacity: 0.5;
        }


        .empty-state h3 {
            margin-bottom: 10px;
            color: var(--light);
        }


        /* Responsive */
        @media (max-width: 1200px) {
            .dashboard-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .charts-grid {
                grid-template-columns: 1fr;
            }
            
            .quick-actions {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .goals-section {
                grid-template-columns: 1fr;
            }
        }


        @media (max-width: 768px) {
            .app-container {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                height: auto;
            }
            
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .quick-actions {
                grid-template-columns: 1fr;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .chart-section.half-width {
                grid-template-columns: 1fr;
            }
        }


        /* New Styles for Transactions Tab */
        .transactions-container {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }


        .transaction-form-card {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 25px;
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
        }


        .form-header-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.3rem;
            margin-bottom: 15px;
        }


        .revenue-form .form-header-icon {
            background: rgba(0, 212, 170, 0.2);
            color: var(--success);
        }


        .essential-form .form-header-icon {
            background: rgba(0, 102, 255, 0.2);
            color: var(--primary);
        }


        .non-essential-form .form-header-icon {
            background: rgba(255, 107, 53, 0.2);
            color: var(--secondary);
        }


        .form-subtitle {
            color: var(--gray);
            margin-bottom: 20px;
            font-size: 0.9rem;
        }


        .transactions-list-section {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 25px;
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            margin-top: 30px;
        }


        .transaction-type-section {
            margin-bottom: 30px;
        }


        .transaction-type-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--glass-border);
        }


        .transaction-type-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem;
        }


        .transaction-type-icon.revenue {
            background: rgba(0, 212, 170, 0.2);
            color: var(--success);
        }


        .transaction-type-icon.essential {
            background: rgba(0, 102, 255, 0.2);
            color: var(--primary);
        }


        .transaction-type-icon.non-essential {
            background: rgba(255, 107, 53, 0.2);
            color: var(--secondary);
        }


        .transaction-type-title {
            font-size: 1.2rem;
            font-weight: 600;
        }


        .transaction-type-amount {
            margin-left: auto;
            font-weight: 600;
            font-size: 1.1rem;
        }


        .transaction-type-amount.revenue {
            color: var(--success);
        }


        .transaction-type-amount.essential {
            color: var(--primary);
        }


        .transaction-type-amount.non-essential {
            color: var(--secondary);
        }


        /* Estilo para o m√™s selecionado nos formul√°rios */
        .selected-month-info {
            background: rgba(0, 102, 255, 0.1);
            border: 1px solid rgba(0, 102, 255, 0.3);
            border-radius: 8px;
            padding: 10px 15px;
            margin-bottom: 15px;
            text-align: center;
            font-size: 0.9rem;
            color: var(--primary-light);
        }


        /* Estilo para modal de detalhes */
        .details-list {
            max-height: 400px;
            overflow-y: auto;
            margin-top: 15px;
        }


        .detail-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            transition: background-color 0.3s ease;
        }


        .detail-item:hover {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
        }


        .detail-item:last-child {
            border-bottom: none;
        }


        .detail-info {
            display: flex;
            flex-direction: column;
        }


        .detail-description {
            font-weight: 500;
            margin-bottom: 4px;
        }


        .detail-category {
            font-size: 0.8rem;
            color: var(--gray);
        }


        .detail-amount {
            font-weight: 600;
            margin-right: 10px;
        }


        .detail-actions {
            display: flex;
            gap: 5px;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <div class="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <i class="fas fa-brain-circuit"></i>
                    <span>NexusFinance</span>
                </div>
            </div>
            
            <div class="nav-menu">
                <div class="nav-item active" onclick="switchTab('dashboard')">
                    <i class="fas fa-chart-network"></i>
                    <span>Dashboard</span>
                </div>
                <div class="nav-item" onclick="switchTab('transactions')">
                    <i class="fas fa-exchange-alt"></i>
                    <span>Transa√ß√µes</span>
                </div>
                <div class="nav-item" onclick="switchTab('goals')">
                    <i class="fas fa-bullseye"></i>
                    <span>Metas</span>
                </div>
                <div class="nav-item" onclick="switchTab('investments')">
                    <i class="fas fa-chart-line"></i>
                    <span>Investimentos</span>
                </div>
                <div class="nav-item" onclick="switchTab('reports')">
                    <i class="fas fa-chart-bar"></i>
                    <span>Relat√≥rios</span>
                </div>
                <div class="nav-item" onclick="switchTab('insights')">
                    <i class="fas fa-robot"></i>
                    <span>Insights IA</span>
                </div>
            </div>
            
            <div class="sidebar-footer">
                <div class="user-card">
                    <div class="user-avatar" id="userAvatar">U</div>
                    <div class="user-info">
                        <div class="user-name" id="userName">Usu√°rio</div>
                        <div class="user-email" id="userEmail">usuario@email.com</div>
                    </div>
                    <button class="logout-btn" onclick="logout()">
                        <i class="fas fa-sign-out-alt"></i>
                    </button>
                </div>
            </div>
        </div>


        <div class="main-content">
            <div class="header">
                <h1 class="header-title" id="pageTitle">Dashboard Financeiro</h1>
                <div class="header-actions">
                    <div class="date-filter-container">
                        <i class="fas fa-calendar-alt"></i>
                        <select id="monthSelect" class="date-select">
                            </select>
                        <select id="yearSelect" class="date-select">
                            </select>
                    </div>
                </div>
            </div>


            <div id="dashboard" class="tab-content active">
                <div class="dashboard-grid">
                    <div class="stat-card revenue" onclick="showTransactionDetails('revenue')">
                        <div class="stat-header">
                            <div class="stat-title">Receita Total</div>
                            <div class="stat-icon">
                                <i class="fas fa-money-bill-wave"></i>
                            </div>
                        </div>
                        <div class="stat-value" id="revenueAmount">R$ 0,00</div>
                        <div class="stat-change positive">
                            <i class="fas fa-arrow-up"></i>
                            <span id="revenueChange">+0% vs √∫ltimo m√™s</span>
                        </div>
                    </div>
                    
                    <div class="stat-card essential" onclick="showTransactionDetails('essential')">
                        <div class="stat-header">
                            <div class="stat-title">Gastos Essenciais</div>
                            <div class="stat-icon">
                                <i class="fas fa-home"></i>
                            </div>
                        </div>
                        <div class="stat-value" id="essentialAmount">R$ 0,00</div>
                        <div class="stat-change negative">
                            <i class="fas fa-arrow-down"></i>
                            <span id="essentialChange">+0% vs √∫ltimo m√™s</span>
                        </div>
                    </div>
                    
                    <div class="stat-card non-essential" onclick="showTransactionDetails('non-essential')">
                        <div class="stat-header">
                            <div class="stat-title">Gastos N√£o Essenciais</div>
                            <div class="stat-icon">
                                <i class="fas fa-gamepad"></i>
                            </div>
                        </div>
                        <div class="stat-value" id="nonEssentialAmount">R$ 0,00</div>
                        <div class="stat-change positive">
                            <i class="fas fa-arrow-up"></i>
                            <span id="nonEssentialChange">+0% vs √∫ltimo m√™s</span>
                        </div>
                    </div>
                    
                    <div class="stat-card economy" onclick="showTransactionDetails('economy')">
                        <div class="stat-header">
                            <div class="stat-title">Economia</div>
                            <div class="stat-icon">
                                <i class="fas fa-piggy-bank"></i>
                            </div>
                        </div>
                        <div class="stat-value" id="economyAmount">R$ 0,00</div>
                        <div class="stat-change positive">
                            <i class="fas fa-arrow-up"></i>
                            <span id="economyChange">+0% vs √∫ltimo m√™s</span>
                        </div>
                    </div>
                </div>


                <div class="charts-grid">
                    <div class="chart-section">
                        <div class="chart-card">
                            <div class="chart-header">
                                <h3 class="chart-title">Distribui√ß√£o de Gastos</h3>
                                <div class="chart-actions">
                                    <button class="btn btn-sm btn-outline" onclick="switchChartPeriod('monthly')">Mensal</button>
                                    <button class="btn btn-sm btn-outline" onclick="switchChartPeriod('quarterly')">Trimestral</button>
                                    <button class="btn btn-sm btn-outline" onclick="switchChartPeriod('yearly')">Anual</button>
                                </div>
                            </div>
                            <div class="chart-container">
                                <canvas id="expenseDistributionChart"></canvas>
                            </div>
                        </div>
                        
                        <div class="chart-section half-width">
                            <div class="chart-card">
                                <div class="chart-header">
                                    <h3 class="chart-title">Evolu√ß√£o de Receitas</h3>
                                </div>
                                <div class="chart-container">
                                    <canvas id="incomeTrendChart"></canvas>
                                </div>
                            </div>
                            
                            <div class="chart-card">
                                <div class="chart-header">
                                    <h3 class="chart-title">Metas vs Realizado</h3>
                                </div>
                                <div class="chart-container">
                                    <canvas id="goalsProgressChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="chart-section">
                        <div class="chart-card">
                            <div class="chart-header">
                                <h3 class="chart-title">Proje√ß√£o de Economia</h3>
                            </div>
                            <div class="chart-container">
                                <canvas id="savingsProjectionChart"></canvas>
                            </div>
                        </div>
                        
                        <div class="chart-card">
                            <div class="chart-header">
                                <h3 class="chart-title">Comparativo Mensal</h3>
                            </div>
                            <div class="chart-container">
                                <canvas id="monthlyComparisonChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>


                <div class="quick-actions">
                    <div class="action-card" onclick="switchTab('transactions')">
                        <div class="action-icon">
                            <i class="fas fa-plus"></i>
                        </div>
                        <div class="action-title">Nova Transa√ß√£o</div>
                        <div class="action-description">Adicione receitas ou despesas</div>
                    </div>
                    
                    <div class="action-card" onclick="switchTab('goals')">
                        <div class="action-icon">
                            <i class="fas fa-bullseye"></i>
                        </div>
                        <div class="action-title">Nova Meta</div>
                        <div class="action-description">Defina objetivos financeiros</div>
                    </div>
                    
                    <div class="action-card" onclick="generateReport()">
                        <div class="action-icon">
                            <i class="fas fa-file-pdf"></i>
                        </div>
                        <div class="action-title">Relat√≥rio PDF</div>
                        <div class="action-description">Exporte seus dados</div>
                    </div>
                    
                    <div class="action-card" onclick="showInvestmentModal()">
                        <div class="action-icon">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <div class="action-title">Simular Investimento</div>
                        <div class="action-description">Proje√ß√µes de rendimento</div>
                    </div>
                </div>


                <div class="goals-section">
                    <div class="activity-section">
                        <div class="chart-header">
                            <h3 class="chart-title">Atividade Recente</h3>
                            <button class="btn btn-sm btn-outline" onclick="switchTab('transactions')">Ver Tudo</button>
                        </div>
                        <div class="activity-list" id="recentActivity">
                            </div>
                    </div>
                    
                    <div class="goal-card">
                        <div class="chart-header">
                            <h3 class="chart-title">Metas em Andamento</h3>
                            <button class="btn btn-sm btn-outline" onclick="switchTab('goals')">Ver Tudo</button>
                        </div>
                        <div id="goalsList">
                            </div>
                    </div>
                </div>


                <div class="ai-insights">
                    <div class="chart-header">
                        <h3 class="chart-title">Insights da IA</h3>
                        <button class="btn btn-sm btn-outline" onclick="refreshInsights()">
                            <i class="fas fa-sync-alt"></i>
                        </button>
                    </div>
                    <div id="aiInsightsContent">
                        </div>
                </div>
            </div>


            <div id="transactions" class="tab-content">
                <div class="selected-month-info">
                    <i class="fas fa-info-circle"></i>
                    Transa√ß√µes ser√£o registradas para: <strong id="selectedMonthDisplay"></strong>
                </div>
                
                <div class="transactions-container">
                    <div class="transaction-form-card revenue-form">
                        <div class="form-header-icon">
                            <i class="fas fa-arrow-down"></i>
                        </div>
                        <h3 class="form-title">Adicionar Receita</h3>
                        <p class="form-subtitle">Registre suas entradas de dinheiro</p>
                        
                        <div class="form-group">
                            <label class="form-label">Descri√ß√£o</label>
                            <input type="text" class="form-input" id="revenueDescription" placeholder="Ex: Sal√°rio, Freelance, Investimento...">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Valor (R$)</label>
                            <input type="number" class="form-input" id="revenueAmountInput" placeholder="0,00" step="0.01" min="0">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Categoria</label>
                            <select class="form-input" id="revenueCategory">
                                <option value="">Selecione uma categoria</option>
                                <option value="salary">Sal√°rio</option>
                                <option value="freelance">Freelance</option>
                                <option value="investment">Investimento</option>
                                <option value="bonus">B√¥nus</option>
                                <option value="other-income">Outra Receita</option>
                            </select>
                        </div>
                        
                        <div class="form-actions">
                            <button class="btn btn-success" onclick="addRevenue()">
                                <i class="fas fa-plus"></i> Adicionar Receita
                            </button>
                        </div>
                    </div>


                    <div class="transaction-form-card essential-form">
                        <div class="form-header-icon">
                            <i class="fas fa-home"></i>
                        </div>
                        <h3 class="form-title">Despesas Essenciais</h3>
                        <p class="form-subtitle">Gastos fixos e necess√°rios</p>
                        
                        <div class="form-group">
                            <label class="form-label">Descri√ß√£o</label>
                            <input type="text" class="form-input" id="essentialDescription" placeholder="Ex: Aluguel, Mercado, Transporte...">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Valor (R$)</label>
                            <input type="number" class="form-input" id="essentialAmountInput" placeholder="0,00" step="0.01" min="0">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Categoria</label>
                            <select class="form-input" id="essentialCategory">
                                <option value="">Selecione uma categoria</option>
                                <option value="rent">Aluguel</option>
                                <option value="food">Alimenta√ß√£o</option>
                                <option value="transport">Transporte</option>
                                <option value="health">Sa√∫de</option>
                                <option value="education">Educa√ß√£o</option>
                                <option value="utilities">Contas (Luz/√Ågua)</option>
                            </select>
                        </div>
                        
                        <div class="form-actions">
                            <button class="btn" onclick="addEssentialExpense()">
                                <i class="fas fa-plus"></i> Adicionar Despesa
                            </button>
                        </div>
                    </div>


                    <div class="transaction-form-card non-essential-form">
                        <div class="form-header-icon">
                            <i class="fas fa-gamepad"></i>
                        </div>
                        <h3 class="form-title">Despesas N√£o Essenciais</h3>
                        <p class="form-subtitle">Gastos vari√°veis e opcionais</p>
                        
                        <div class="form-group">
                            <label class="form-label">Descri√ß√£o</label>
                            <input type="text" class="form-input" id="nonEssentialDescription" placeholder="Ex: Restaurante, Cinema, Compras...">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Valor (R$)</label>
                            <input type="number" class="form-input" id="nonEssentialAmountInput" placeholder="0,00" step="0.01" min="0">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Categoria</label>
                            <select class="form-input" id="nonEssentialCategory">
                                <option value="">Selecione uma categoria</option>
                                <option value="entertainment">Entretenimento</option>
                                <option value="shopping">Compras</option>
                                <option value="restaurant">Restaurante</option>
                                <option value="travel">Viagens</option>
                                <option value="hobbies">Hobbies</option>
                                <option value="other-non-essential">Outros</option>
                            </select>
                        </div>
                        
                        <div class="form-actions">
                            <button class="btn" onclick="addNonEssentialExpense()">
                                <i class="fas fa-plus"></i> Adicionar Despesa
                            </button>
                        </div>
                    </div>
                </div>


                <div class="transactions-list-section">
                    <div class="list-header">
                        <h2 class="list-title">Todas as Transa√ß√µes</h2>
                        <div class="list-actions">
                            <button class="btn btn-outline" onclick="exportTransactions()">
                                <i class="fas fa-download"></i> Exportar
                            </button>
                        </div>
                    </div>


                    <div class="transaction-type-section">
                        <div class="transaction-type-header">
                            <div class="transaction-type-icon revenue">
                                <i class="fas fa-arrow-down"></i>
                            </div>
                            <h3 class="transaction-type-title">Receitas</h3>
                            <div class="transaction-type-amount revenue" id="revenueTotal">R$ 0,00</div>
                        </div>
                        <div class="items-list" id="revenueTransactionsList">
                            </div>
                    </div>


                    <div class="transaction-type-section">
                        <div class="transaction-type-header">
                            <div class="transaction-type-icon essential">
                                <i class="fas fa-home"></i>
                            </div>
                            <h3 class="transaction-type-title">Despesas Essenciais</h3>
                            <div class="transaction-type-amount essential" id="essentialTotal">R$ 0,00</div>
                        </div>
                        <div class="items-list" id="essentialTransactionsList">
                            </div>
                    </div>


                    <div class="transaction-type-section">
                        <div class="transaction-type-header">
                            <div class="transaction-type-icon non-essential">
                                <i class="fas fa-gamepad"></i>
                            </div>
                            <h3 class="transaction-type-title">Despesas N√£o Essenciais</h3>
                            <div class="transaction-type-amount non-essential" id="nonEssentialTotal">R$ 0,00</div>
                        </div>
                        <div class="items-list" id="nonEssentialTransactionsList">
                            </div>
                    </div>
                </div>
            </div>


            <div id="goals" class="tab-content">
                <div class="add-form">
                    <div class="form-header">
                        <h3 class="form-title">Adicionar Nova Meta</h3>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Nome da Meta</label>
                        <input type="text" class="form-input" id="goalName" placeholder="Ex: Reserva de Emerg√™ncia, Viagem...">
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Valor da Meta (R$)</label>
                            <input type="number" class="form-input" id="goalTarget" placeholder="0,00" step="0.01" min="0">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Valor Atual (R$)</label>
                            <input type="number" class="form-input" id="goalCurrent" placeholder="0,00" step="0.01" min="0">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Prazo (meses)</label>
                        <input type="number" class="form-input" id="goalDeadline" placeholder="12" min="1">
                    </div>
                    <div class="form-actions">
                        <button class="btn btn-success" onclick="addGoal()">
                            <i class="fas fa-plus"></i> Adicionar Meta
                        </button>
                    </div>
                </div>


                <div class="list-section">
                    <div class="list-header">
                        <h2 class="list-title">Metas Financeiras</h2>
                        <div class="list-actions">
                            <button class="btn btn-outline" onclick="exportGoals()">
                                <i class="fas fa-download"></i> Exportar
                            </button>
                        </div>
                    </div>
                    <div class="items-list" id="allGoalsList">
                        </div>
                </div>
            </div>


            <div id="investments" class="tab-content">
                <div class="list-section">
                    <div class="list-header">
                        <h2 class="list-title">Investimentos</h2>
                        <button class="btn" onclick="showAddInvestmentModal()">
                            <i class="fas fa-plus"></i> Novo Investimento
                        </button>
                    </div>
                    <div class="empty-state">
                        <i class="fas fa-chart-line"></i>
                        <h3>Em Desenvolvimento</h3>
                        <p>Esta funcionalidade estar√° dispon√≠vel em breve</p>
                    </div>
                </div>
            </div>


            <div id="reports" class="tab-content">
                <div class="list-section">
                    <div class="list-header">
                        <h2 class="list-title">Relat√≥rios</h2>
                        <button class="btn" onclick="generateReport()">
                            <i class="fas fa-download"></i> Gerar Relat√≥rio
                        </button>
                    </div>
                    <div class="empty-state">
                        <i class="fas fa-chart-bar"></i>
                        <h3>Em Desenvolvimento</h3>
                        <p>Esta funcionalidade estar√° dispon√≠vel em breve</p>
                    </div>
                </div>
            </div>


            <div id="insights" class="tab-content">
                <div class="list-section">
                    <div class="list-header">
                        <h2 class="list-title">Insights de IA</h2>
                        <button class="btn" onclick="refreshInsights()">
                            <i class="fas fa-sync-alt"></i> Atualizar
                        </button>
                    </div>
                    <div id="fullInsightsContent">
                        </div>
                </div>
            </div>
        </div>
    </div>


    <div id="editTransactionModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Editar Transa√ß√£o</h3>
                <button class="modal-close" onclick="closeEditTransactionModal()">&times;</button>
            </div>
            <div class="form-group">
                <label class="form-label">Descri√ß√£o</label>
                <input type="text" class="form-input" id="editTransactionDescription">
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">Valor (R$)</label>
                    <input type="number" class="form-input" id="editTransactionAmount" step="0.01" min="0">
                </div>
                <div class="form-group">
                    <label class="form-label">Data</label>
                    <input type="date" class="form-input" id="editTransactionDate">
                </div>
            </div>
            <div class="form-group">
                <label class="form-label">Tipo</label>
                <select class="form-input" id="editTransactionType">
                    <option value="revenue">Receita</option>
                    <option value="essential">Despesa Essencial</option>
                    <option value="non-essential">Despesa N√£o Essencial</option>
                </select>
            </div>
            <div class="form-group" id="editCategoryGroup">
                <label class="form-label">Categoria</label>
                <select class="form-input" id="editTransactionCategory">
                    </select>
            </div>
            <div class="form-actions">
                <button class="btn btn-danger" onclick="deleteTransaction()">
                    <i class="fas fa-trash"></i> Excluir
                </button>
                <button class="btn btn-outline" onclick="closeEditTransactionModal()">Cancelar</button>
                <button class="btn btn-success" onclick="saveTransaction()">
                    <i class="fas fa-save"></i> Salvar Altera√ß√µes
                </button>
            </div>
        </div>
    </div>


    <div id="editGoalModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Editar Meta Financeira</h3>
                <button class="modal-close" onclick="closeEditGoalModal()">&times;</button>
            </div>
            <div class="form-group">
                <label class="form-label">Nome da Meta</label>
                <input type="text" class="form-input" id="editGoalName">
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">Valor da Meta (R$)</label>
                    <input type="number" class="form-input" id="editGoalTarget" step="0.01" min="0">
                </div>
                <div class="form-group">
                    <label class="form-label">Valor Atual (R$)</label>
                    <input type="number" class="form-input" id="editGoalCurrent" step="0.01" min="0">
                </div>
            </div>
            <div class="form-group">
                <label class="form-label">Prazo (meses)</label>
                <input type="number" class="form-input" id="editGoalDeadline" min="1">
            </div>
            <div class="form-actions">
                <button class="btn btn-danger" onclick="deleteGoal()">
                    <i class="fas fa-trash"></i> Excluir
                </button>
                <button class="btn btn-outline" onclick="closeEditGoalModal()">Cancelar</button>
                <button class="btn btn-success" onclick="saveGoal()">
                    <i class="fas fa-save"></i> Salvar Altera√ß√µes
                </button>
            </div>
        </div>
    </div>


    <div id="transactionDetailsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="detailsModalTitle">Detalhes das Transa√ß√µes</h3>
                <button class="modal-close" onclick="closeTransactionDetailsModal()">&times;</button>
            </div>
            <div class="details-list" id="transactionDetailsList">
                </div>
            <div class="form-actions">
                <button class="btn btn-outline" onclick="closeTransactionDetailsModal()">Fechar</button>
            </div>
        </div>
    </div>


    <script>
        // Global variables
        let currentUser = null;
        let transactions = [];
        let goals = [];
        let currentMonth = new Date().getMonth();
        let currentYear = new Date().getFullYear();
        let editingTransactionId = null;
        let editingGoalId = null;
        
        // Chart instances
        let distributionChart, trendChart, goalsChart, projectionChart, comparisonChart;

        // Initialize the application
        // MODIFICADO: Fun√ß√£o initApp() SUBSTITU√çDA
        function initApp() {
            // Verificar se usu√°rio j√° est√° logado
            auth.onAuthStateChanged((user) => {
                if (user) {
                    // Usu√°rio logado - carrega da nuvem
                    currentUser = {
                        uid: user.uid,
                        email: user.email,
                        name: user.displayName || user.email.split('@')[0]
                    };
                    showNotification(`Bem-vindo, ${currentUser.name}! ‚úÖ`, 'success');
                } else {
                    // Usu√°rio n√£o logado - usa localStorage
                    showNotification('Modo offline - dados locais', 'info');
                }
                loadUserData();
            });

            setupDateFilters();
            updateDashboard();
            setupCharts();
            setupEventListeners();
            updateTransactionsList();
            updateAllGoalsList();
            updateFullInsights();
            updateSelectedMonthDisplay();
        }


        function setupDateFilters() {
            const monthSelect = document.getElementById('monthSelect');
            const yearSelect = document.getElementById('yearSelect');
            
            // Populate months
            const months = [
                'Janeiro', 'Fevereiro', 'Mar√ßo', 'Abril', 'Maio', 'Junho',
                'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'
            ];
            monthSelect.innerHTML = '';
            months.forEach((month, index) => {
                const option = document.createElement('option');
                option.value = index;
                option.textContent = month;
                if (index === currentMonth) {
                    option.selected = true;
                }
                monthSelect.appendChild(option);
            });

            // Populate years (from 2020 to 2030)
            yearSelect.innerHTML = '';
            for (let year = 2020; year <= 2030; year++) {
                const option = document.createElement('option');
                option.value = year;
                option.textContent = year;
                if (year === currentYear) {
                    option.selected = true;
                }
                yearSelect.appendChild(option);
            }
        }


        function updateSelectedMonthDisplay() {
            const monthSelect = document.getElementById('monthSelect');
            const yearSelect = document.getElementById('yearSelect');
            const selectedMonthDisplay = document.getElementById('selectedMonthDisplay');
            
            const monthNames = [
                'Janeiro', 'Fevereiro', 'Mar√ßo', 'Abril', 'Maio', 'Junho',
                'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'
            ];
            const selectedMonth = monthNames[parseInt(monthSelect.value)];
            const selectedYear = yearSelect.value;
            
            selectedMonthDisplay.textContent = `${selectedMonth} de ${selectedYear}`;
        }


        // MODIFICADO: Fun√ß√£o loadUserData() SUBSTITU√çDA
        function loadUserData() {
            const user = auth.currentUser;
            
            if (!user) {
                // Se n√£o est√° logado, usa localStorage (modo offline)
                const savedTransactions = localStorage.getItem('nexusFinanceTransactions');
                const savedGoals = localStorage.getItem('nexusFinanceGoals');

                if (savedTransactions) {
                    transactions = JSON.parse(savedTransactions);
                } else {
                    transactions = [];
                }

                if (savedGoals) {
                    goals = JSON.parse(savedGoals);
                } else {
                    goals = [];
                }
                
                updateDashboard();
                return;
            }

            // Se est√° logado, carrega do FIREBASE (nuvem)
            // Carregar transa√ß√µes
            db.collection('users').doc(user.uid).collection('transactions')
                .orderBy('createdAt', 'desc')
                .get()
                .then((querySnapshot) => {
                    transactions = [];
                    querySnapshot.forEach((doc) => {
                        const data = doc.data();
                        transactions.push({ 
                            id: doc.id, 
                            description: data.description,
                            amount: data.amount,
                            type: data.type,
                            category: data.category,
                            date: data.date
                        });
                    });
                    updateDashboard();
                    updateTransactionsList();
                })
                .catch((error) => {
                    console.error('Erro ao carregar transa√ß√µes:', error);
                });

            // Carregar metas
            db.collection('users').doc(user.uid).collection('goals')
                .get()
                .then((querySnapshot) => {
                    goals = [];
                    querySnapshot.forEach((doc) => {
                        const data = doc.data();
                        goals.push({ 
                            id: doc.id, 
                            name: data.name,
                            target: data.target,
                            current: data.current,
                            deadline: data.deadline
                        });
                    });
                    updateDashboard();
                    updateAllGoalsList();
                })
                .catch((error) => {
                    console.error('Erro ao carregar metas:', error);
                });
        }


        function saveData() {
            localStorage.setItem('nexusFinanceTransactions', JSON.stringify(transactions));
            localStorage.setItem('nexusFinanceGoals', JSON.stringify(goals));
        }


        function updateUserInfo() {
            document.getElementById('userName').textContent = currentUser.name;
            document.getElementById('userEmail').textContent = currentUser.email;
            document.getElementById('userAvatar').textContent = currentUser.name.split(' ').map(n => n[0]).join('').substring(0, 2);
        }


        // Tab Management
        function switchTab(tabName) {
            // Update navigation
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            // Find and activate the clicked nav item
            const navItems = document.querySelectorAll('.nav-item');
            for (let i = 0; i < navItems.length; i++) {
                if (navItems[i].textContent.includes(getTabName(tabName))) {
                    navItems[i].classList.add('active');
                    break;
                }
            }


            // Update content
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.getElementById(tabName).classList.add('active');


            // Update page title
            const titles = {
                'dashboard': 'Dashboard Financeiro',
                'transactions': 'Transa√ß√µes',
                'goals': 'Metas Financeiras',
                'investments': 'Investimentos',
                'reports': 'Relat√≥rios',
                'insights': 'Insights de IA'
            };
            document.getElementById('pageTitle').textContent = titles[tabName] || 'Dashboard Financeiro';


            // Refresh tab content if needed
            if (tabName === 'transactions') {
                updateTransactionsList();
                updateSelectedMonthDisplay();
            } else if (tabName === 'goals') {
                updateAllGoalsList();
            } else if (tabName === 'insights') {
                updateFullInsights();
            } else if (tabName === 'dashboard') {
                updateDashboard();
            }
        }


        function getTabName(tabId) {
            const tabNames = {
                'dashboard': 'Dashboard',
                'transactions': 'Transa√ß√µes',
                'goals': 'Metas',
                'investments': 'Investimentos',
                'reports': 'Relat√≥rios',
                'insights': 'Insights IA'
            };
            return tabNames[tabId] || '';
        }


        function updateDashboard() {
            updateStats();
            updateRecentActivity();
            updateGoals();
            updateAIInsights();
            updateCharts();
        }


        function updateStats() {
            const monthTransactions = getCurrentMonthTransactions();
            const revenue = monthTransactions.filter(t => t.type === 'revenue').reduce((sum, t) => sum + t.amount, 0);
            const essential = monthTransactions.filter(t => t.type === 'essential').reduce((sum, t) => sum + t.amount, 0);
            const nonEssential = monthTransactions.filter(t => t.type === 'non-essential').reduce((sum, t) => sum + t.amount, 0);
            const economy = revenue - essential - nonEssential;


            document.getElementById('revenueAmount').textContent = `R$ ${revenue.toLocaleString('pt-BR', { minimumFractionDigits: 2 })}`;
            document.getElementById('essentialAmount').textContent = `R$ ${essential.toLocaleString('pt-BR', { minimumFractionDigits: 2 })}`;
            document.getElementById('nonEssentialAmount').textContent = `R$ ${nonEssential.toLocaleString('pt-BR', { minimumFractionDigits: 2 })}`;
            document.getElementById('economyAmount').textContent = `R$ ${economy.toLocaleString('pt-BR', { minimumFractionDigits: 2 })}`;


            // Calculate changes (simplified)
            const lastMonthTransactions = getLastMonthTransactions();
            const lastMonthRevenue = lastMonthTransactions.filter(t => t.type === 'revenue').reduce((sum, t) => sum + t.amount, 0);
            const lastMonthEssential = lastMonthTransactions.filter(t => t.type === 'essential').reduce((sum, t) => sum + t.amount, 0);
            const lastMonthNonEssential = lastMonthTransactions.filter(t => t.type === 'non-essential').reduce((sum, t) => sum + t.amount, 0);
            const lastMonthEconomy = lastMonthRevenue - lastMonthEssential - lastMonthNonEssential;


            const revenueChange = lastMonthRevenue > 0 ?
                ((revenue - lastMonthRevenue) / lastMonthRevenue * 100).toFixed(1) : revenue > 0 ? 100 : 0;
            const essentialChange = lastMonthEssential > 0 ? ((essential - lastMonthEssential) / lastMonthEssential * 100).toFixed(1) : essential > 0 ?
                100 : 0;
            const nonEssentialChange = lastMonthNonEssential > 0 ?
                ((nonEssential - lastMonthNonEssential) / lastMonthNonEssential * 100).toFixed(1) : nonEssential > 0 ? 100 : 0;
            const economyChange = lastMonthEconomy > 0 ? ((economy - lastMonthEconomy) / lastMonthEconomy * 100).toFixed(1) : economy > 0 ?
                100 : 0;


            document.getElementById('revenueChange').textContent = `${revenueChange >= 0 ? '+' : ''}${revenueChange}% vs √∫ltimo m√™s`;
            document.getElementById('essentialChange').textContent = `${essentialChange >= 0 ? '+' : ''}${essentialChange}% vs √∫ltimo m√™s`;
            document.getElementById('nonEssentialChange').textContent = `${nonEssentialChange >= 0 ?
                '+' : ''}${nonEssentialChange}% vs √∫ltimo m√™s`;
            document.getElementById('economyChange').textContent = `${economyChange >= 0 ? '+' : ''}${economyChange}% vs √∫ltimo m√™s`;

            // Update change indicators
            document.getElementById('revenueChange').className = `stat-change ${revenueChange >= 0 ?
                'positive' : 'negative'}`;
            document.getElementById('essentialChange').className = `stat-change ${essentialChange <= 0 ? 'positive' : 'negative'}`;
            document.getElementById('nonEssentialChange').className = `stat-change ${nonEssentialChange <= 0 ?
                'positive' : 'negative'}`;
            document.getElementById('economyChange').className = `stat-change ${economyChange >= 0 ? 'positive' : 'negative'}`;
        }


        function getCurrentMonthTransactions() {
            return transactions.filter(t => {
                const transactionDate = new Date(t.date);
                return transactionDate.getMonth() === currentMonth && transactionDate.getFullYear() === currentYear;
            });
        }


        function getLastMonthTransactions() {
            let lastMonth = currentMonth - 1;
            let lastYear = currentYear;
            if (lastMonth < 0) {
                lastMonth = 11;
                lastYear = currentYear - 1;
            }


            return transactions.filter(t => {
                const transactionDate = new Date(t.date);
                return transactionDate.getMonth() === lastMonth && transactionDate.getFullYear() === lastYear;
            });
        }


        // NEW: Function to show transaction details when clicking on cards
        function showTransactionDetails(type) {
            const monthTransactions = getCurrentMonthTransactions();
            let filteredTransactions = [];
            let modalTitle = '';
            
            switch(type) {
                case 'revenue':
                    filteredTransactions = monthTransactions.filter(t => t.type === 'revenue');
                    modalTitle = 'Receitas do M√™s';
                    break;
                case 'essential':
                    filteredTransactions = monthTransactions.filter(t => t.type === 'essential');
                    modalTitle = 'Despesas Essenciais do M√™s';
                    break;
                case 'non-essential':
                    filteredTransactions = monthTransactions.filter(t => t.type === 'non-essential');
                    modalTitle = 'Despesas N√£o Essenciais do M√™s';
                    break;
                case 'economy':
                    const revenue = monthTransactions.filter(t => t.type === 'revenue').reduce((sum, t) => sum + t.amount, 0);
                    const essential = monthTransactions.filter(t => t.type === 'essential').reduce((sum, t) => sum + t.amount, 0);
                    const nonEssential = monthTransactions.filter(t => t.type === 'non-essential').reduce((sum, t) => sum + t.amount, 0);
                    const economy = revenue - essential - nonEssential;
                    
                    document.getElementById('detailsModalTitle').textContent = 'Economia do M√™s';
                    document.getElementById('transactionDetailsList').innerHTML = `
                        <div class="detail-item">
                            <div class="detail-info">
                                <div class="detail-description">Receitas Totais</div>
                            </div>
                            <div class="detail-amount positive">R$ ${revenue.toLocaleString('pt-BR', { minimumFractionDigits: 2 })}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-info">
                                <div class="detail-description">Despesas Essenciais</div>
                            </div>
                            <div class="detail-amount negative">- R$ ${essential.toLocaleString('pt-BR', { minimumFractionDigits: 2 })}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-info">
                                <div class="detail-description">Despesas N√£o Essenciais</div>
                            </div>
                            <div class="detail-amount negative">- R$ ${nonEssential.toLocaleString('pt-BR', { minimumFractionDigits: 2 })}</div>
                        </div>
                        <div class="detail-item" style="border-top: 2px solid var(--glass-border); padding-top: 15px;">
                            <div class="detail-info">
                                <div class="detail-description" style="font-weight: bold;">Economia Total</div>
                            </div>
                            <div class="detail-amount" style="color: ${economy >= 0 ? 'var(--success)' : 'var(--danger)'}; font-weight: bold;">
                                R$ ${economy.toLocaleString('pt-BR', { minimumFractionDigits: 2 })}
                            </div>
                        </div>
                    `;
                    document.getElementById('transactionDetailsModal').classList.add('active');
                    return;
            }
            
            if (filteredTransactions.length === 0) {
                document.getElementById('transactionDetailsList').innerHTML = `
                    <div class="empty-state" style="padding: 40px 20px;">
                        <i class="fas fa-${type === 'revenue' ? 'money-bill-wave' : type === 'essential' ? 'home' : 'gamepad'}"></i>
                        <h3>Nenhuma transa√ß√£o</h3>
                        <p>N√£o h√° ${type === 'revenue' ? 'receitas' : type === 'essential' ? 'despesas essenciais' : 'despesas n√£o essenciais'} para o m√™s selecionado</p>
                    </div>
                `;
            } else {
                document.getElementById('transactionDetailsList').innerHTML = filteredTransactions.map(transaction => `
                    <div class="detail-item">
                        <div class="detail-info">
                            <div class="detail-description">${transaction.description}</div>
                            <div class="detail-category">${getCategoryName(transaction.category)} ‚Ä¢ ${formatDate(transaction.date)}</div>
                        </div>
                        <div class="detail-amount ${transaction.type === 'revenue' ? 'positive' : 'negative'}">
                            ${transaction.type === 'revenue' ? '+' : '-'} R$ ${transaction.amount.toLocaleString('pt-BR', { minimumFractionDigits: 2 })}
                        </div>
                        <div class="detail-actions">
                            <button class="btn btn-xs btn-outline" onclick="editTransaction('${transaction.id}'); closeTransactionDetailsModal();">
                                <i class="fas fa-edit"></i>
                            </button>
                        </div>
                    </div>
                `).join('');
            }
            
            document.getElementById('detailsModalTitle').textContent = modalTitle;
            document.getElementById('transactionDetailsModal').classList.add('active');
        }


        function closeTransactionDetailsModal() {
            document.getElementById('transactionDetailsModal').classList.remove('active');
        }


        function updateRecentActivity() {
            const activityList = document.getElementById('recentActivity');
            const recentTransactions = transactions
                .sort((a, b) => new Date(b.date) - new Date(a.date))
                .slice(0, 5);
            
            if (recentTransactions.length === 0) {
                activityList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-exchange-alt"></i>
                        <h3>Nenhuma transa√ß√£o</h3>
                        <p>Adicione sua primeira transa√ß√£o</p>
                    </div>
                `;
                return;
            }


            activityList.innerHTML = recentTransactions.map(transaction => {
                const typeClass = transaction.type === 'revenue' ? 'income' : 'expense';
                const typeIcon = transaction.type === 'revenue' ? 'arrow-down' : 'arrow-up';
                const amountSign = transaction.type === 'revenue' ? '+' : '-';
                
                return `
                    <div class="activity-item">
                        <div class="activity-icon ${typeClass}">
                            <i class="fas fa-${typeIcon}"></i>
                        </div>
                        <div class="activity-content">
                            <div class="activity-title">${transaction.description}</div>
                            <div class="activity-description">${formatDate(transaction.date)} ‚Ä¢ ${getCategoryName(transaction.category)}</div>
                        </div>
                        <div class="activity-amount ${typeClass}">
                            ${amountSign} R$ ${transaction.amount.toLocaleString('pt-BR', { minimumFractionDigits: 2 })}
                        </div>
                        <div class="activity-actions">
                            <button class="btn btn-xs btn-outline" onclick="editTransaction('${transaction.id}')">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-xs btn-danger" onclick="deleteTransactionPrompt('${transaction.id}')">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }


        function updateGoals() {
            const goalsList = document.getElementById('goalsList');
            if (goals.length === 0) {
                goalsList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-bullseye"></i>
                        <h3>Nenhuma meta</h3>
                        <p>Crie sua primeira meta financeira</p>
                    </div>
                `;
                return;
            }


            const activeGoals = goals.slice(0, 3);
            // Show only 3 goals in dashboard
            
            goalsList.innerHTML = activeGoals.map(goal => {
                const progress = (goal.current / goal.target) * 100;
                return `
                    <div class="goal-item">
                        <div class="goal-header">
                            <div class="goal-name">${goal.name}</div>
                            <div class="goal-amount">R$ ${goal.current.toLocaleString('pt-BR', { minimumFractionDigits: 0 })}</div>
                        </div>
                        <div class="goal-progress">
                            <div class="goal-progress-bar" style="width: ${Math.min(progress, 100)}%"></div>
                        </div>
                        <div class="goal-info">
                            <span>Progresso</span>
                            <span>${progress.toFixed(1)}%</span>
                        </div>
                    </div>
                `;
            }).join('');
        }


        function updateAllGoalsList() {
            const goalsList = document.getElementById('allGoalsList');
            if (goals.length === 0) {
                goalsList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-bullseye"></i>
                        <h3>Nenhuma meta cadastrada</h3>
                        <p>Comece criando suas metas financeiras</p>
                    </div>
                `;
                return;
            }


            goalsList.innerHTML = goals.map(goal => {
                const progress = (goal.current / goal.target) * 100;
                const remaining = goal.target - goal.current;
                const monthly = remaining / goal.deadline;
                
                return `
                    <div class="list-item">
                        <div class="list-item-icon" style="background: rgba(0, 102, 255, 0.2); color: var(--primary);">
                            <i class="fas fa-bullseye"></i>
                        </div>
                        <div class="list-item-content">
                            <div class="list-item-title">${goal.name}</div>
                            <div class="list-item-description">
                                R$ ${goal.current.toLocaleString('pt-BR', { minimumFractionDigits: 2 })} de R$ ${goal.target.toLocaleString('pt-BR', { minimumFractionDigits: 2 })} ‚Ä¢ 
                                ${progress.toFixed(1)}% conclu√≠do ‚Ä¢ 
                                R$ ${monthly.toLocaleString('pt-BR', { minimumFractionDigits: 2 })}/m√™s
                            </div>
                        </div>
                        <div class="list-item-amount positive">
                            ${progress.toFixed(1)}%
                        </div>
                        <div class="list-item-actions">
                            <button class="btn btn-xs btn-outline" onclick="editGoal('${goal.id}')">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-xs btn-danger" onclick="deleteGoalPrompt('${goal.id}')">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }


        // NEW: Improved transactions list with separate sections
        function updateTransactionsList() {
            updateRevenueTransactions();
            updateEssentialTransactions();
            updateNonEssentialTransactions();
        }


        function updateRevenueTransactions() {
            const revenueList = document.getElementById('revenueTransactionsList');
            const revenueTransactions = transactions
                .filter(t => t.type === 'revenue')
                .sort((a, b) => new Date(b.date) - new Date(a.date));
            const revenueTotal = revenueTransactions.reduce((sum, t) => sum + t.amount, 0);
            document.getElementById('revenueTotal').textContent = `R$ ${revenueTotal.toLocaleString('pt-BR', { minimumFractionDigits: 2 })}`;

            if (revenueTransactions.length === 0) {
                revenueList.innerHTML = `
                    <div class="empty-state" style="padding: 20px;">
                        <i class="fas fa-arrow-down"></i>
                        <h3>Nenhuma receita</h3>
                        <p>Adicione sua primeira receita</p>
                    </div>
                `;
                return;
            }


            revenueList.innerHTML = revenueTransactions.map(transaction => `
                <div class="list-item">
                    <div class="list-item-icon income">
                        <i class="fas fa-arrow-down"></i>
                    </div>
                    <div class="list-item-content">
                        <div class="list-item-title">${transaction.description}</div>
                        <div class="list-item-description">${formatDate(transaction.date)} ‚Ä¢ ${getCategoryName(transaction.category)}</div>
                    </div>
                    <div class="list-item-amount positive">
                        + R$ ${transaction.amount.toLocaleString('pt-BR', { minimumFractionDigits: 2 })}
                    </div>
                    <div class="list-item-actions">
                        <button class="btn btn-xs btn-outline" onclick="editTransaction('${transaction.id}')">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-xs btn-danger" onclick="deleteTransactionPrompt('${transaction.id}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            `).join('');
        }


        function updateEssentialTransactions() {
            const essentialList = document.getElementById('essentialTransactionsList');
            const essentialTransactions = transactions
                .filter(t => t.type === 'essential')
                .sort((a, b) => new Date(b.date) - new Date(a.date));
            const essentialTotal = essentialTransactions.reduce((sum, t) => sum + t.amount, 0);
            document.getElementById('essentialTotal').textContent = `R$ ${essentialTotal.toLocaleString('pt-BR', { minimumFractionDigits: 2 })}`;

            if (essentialTransactions.length === 0) {
                essentialList.innerHTML = `
                    <div class="empty-state" style="padding: 20px;">
                        <i class="fas fa-home"></i>
                        <h3>Nenhuma despesa essencial</h3>
                        <p>Adicione sua primeira despesa essencial</p>
                    </div>
                `;
                return;
            }


            essentialList.innerHTML = essentialTransactions.map(transaction => `
                <div class="list-item">
                    <div class="list-item-icon expense">
                        <i class="fas fa-arrow-up"></i>
                    </div>
                    <div class="list-item-content">
                        <div class="list-item-title">${transaction.description}</div>
                        <div class="list-item-description">${formatDate(transaction.date)} ‚Ä¢ ${getCategoryName(transaction.category)}</div>
                    </div>
                    <div class="list-item-amount negative">
                        - R$ ${transaction.amount.toLocaleString('pt-BR', { minimumFractionDigits: 2 })}
                    </div>
                    <div class="list-item-actions">
                        <button class="btn btn-xs btn-outline" onclick="editTransaction('${transaction.id}')">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-xs btn-danger" onclick="deleteTransactionPrompt('${transaction.id}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            `).join('');
        }


        function updateNonEssentialTransactions() {
            const nonEssentialList = document.getElementById('nonEssentialTransactionsList');
            const nonEssentialTransactions = transactions
                .filter(t => t.type === 'non-essential')
                .sort((a, b) => new Date(b.date) - new Date(a.date));
            const nonEssentialTotal = nonEssentialTransactions.reduce((sum, t) => sum + t.amount, 0);
            document.getElementById('nonEssentialTotal').textContent = `R$ ${nonEssentialTotal.toLocaleString('pt-BR', { minimumFractionDigits: 2 })}`;

            if (nonEssentialTransactions.length === 0) {
                nonEssentialList.innerHTML = `
                    <div class="empty-state" style="padding: 20px;">
                        <i class="fas fa-gamepad"></i>
                        <h3>Nenhuma despesa n√£o essencial</h3>
                        <p>Adicione sua primeira despesa n√£o essencial</p>
                    </div>
                `;
                return;
            }


            nonEssentialList.innerHTML = nonEssentialTransactions.map(transaction => `
                <div class="list-item">
                    <div class="list-item-icon expense">
                        <i class="fas fa-arrow-up"></i>
                    </div>
                    <div class="list-item-content">
                        <div class="list-item-title">${transaction.description}</div>
                        <div class="list-item-description">${formatDate(transaction.date)} ‚Ä¢ ${getCategoryName(transaction.category)}</div>
                    </div>
                    <div class="list-item-amount negative">
                        - R$ ${transaction.amount.toLocaleString('pt-BR', { minimumFractionDigits: 2 })}
                    </div>
                    <div class="list-item-actions">
                        <button class="btn btn-xs btn-outline" onclick="editTransaction('${transaction.id}')">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-xs btn-danger" onclick="deleteTransactionPrompt('${transaction.id}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            `).join('');
        }


        function updateAIInsights() {
            const insightsContent = document.getElementById('aiInsightsContent');
            const insights = generateInsights();
            
            insightsContent.innerHTML = insights.map(insight => `
                <div class="insight-item ${insight.type}">
                    <div class="insight-title">${insight.title}</div>
                    <div class="insight-content">${insight.content}</div>
                </div>
            `).join('');
        }


        function updateFullInsights() {
            const insightsContent = document.getElementById('fullInsightsContent');
            const insights = generateInsights();
            
            insightsContent.innerHTML = `
                <div class="ai-insights">
                    ${insights.map(insight => `
                        <div class="insight-item ${insight.type}">
                            <div class="insight-title">${insight.title}</div>
                            <div class="insight-content">${insight.content}</div>
                        </div>
                    `).join('')}
                </div>
            `;
        }


        function generateInsights() {
            const monthTransactions = getCurrentMonthTransactions();
            const revenue = monthTransactions.filter(t => t.type === 'revenue').reduce((sum, t) => sum + t.amount, 0);
            const essential = monthTransactions.filter(t => t.type === 'essential').reduce((sum, t) => sum + t.amount, 0);
            const nonEssential = monthTransactions.filter(t => t.type === 'non-essential').reduce((sum, t) => sum + t.amount, 0);
            const economy = revenue - essential - nonEssential;


            const insights = [];

            if (economy > 0) {
                insights.push({
                    title: "üí° Economia Saud√°vel",
                    content: `Voc√™ est√° economizando R$ ${economy.toLocaleString('pt-BR', { minimumFractionDigits: 2 })} este m√™s. Continue assim!`,
                    type: "success"
                });
            } else {
                insights.push({
                    title: "‚ö†Ô∏è Aten√ß√£o aos Gastos",
                    content: "Voc√™ est√° gastando mais do que ganha. Considere revisar seus gastos n√£o essenciais.",
                    type: "warning"
                });
            }


            const nonEssentialPercent = revenue > 0 ?
                (nonEssential / revenue) * 100 : 0;
            if (nonEssentialPercent > 30) {
                insights.push({
                    title: "üéØ Oportunidade de Economia",
                    content: `Voc√™ est√° gastando ${nonEssentialPercent.toFixed(1)}% da sua renda em itens n√£o essenciais. Reduzir para 20% liberaria R$ ${((nonEssentialPercent - 20) / 100 * revenue).toLocaleString('pt-BR', { minimumFractionDigits: 2 })} por m√™s.`,
                    type: "warning"
                });
            }


            if (goals.length > 0) {
                const totalGoalsProgress = goals.reduce((sum, goal) => sum + (goal.current / goal.target), 0) / goals.length * 100;
                if (totalGoalsProgress > 50) {
                    insights.push({
                        title: "üöÄ Metas em Bom Andamento",
                        content: `Suas metas est√£o ${totalGoalsProgress.toFixed(1)}% conclu√≠das. Continue com o bom trabalho!`,
                        type: "success"
                    });
                }
            }


            if (essential > revenue * 0.5) {
                insights.push({
                    title: "üè† Gastos Essenciais Elevados",
                    content: "Mais de 50% da sua renda est√° indo para gastos essenciais. Considere formas de reduzir custos fixos.",
                    type: "warning"
                });
            }


            if (insights.length === 0) {
                insights.push({
                    title: "üåü √ìtimo Trabalho!",
                    content: "Suas finan√ßas est√£o equilibradas. Continue mantendo esse controle!",
                    type: "success"
                });
            }


            return insights;
        }


        // Chart setup functions
        function setupCharts() {
            setupExpenseDistributionChart();
            setupIncomeTrendChart();
            setupGoalsProgressChart();
            setupSavingsProjectionChart();
            setupMonthlyComparisonChart();
        }


        function setupExpenseDistributionChart() {
            const ctx = document.getElementById('expenseDistributionChart').getContext('2d');
            if (distributionChart) distributionChart.destroy();
            
            const monthTransactions = getCurrentMonthTransactions();
            const essential = monthTransactions.filter(t => t.type === 'essential').reduce((sum, t) => sum + t.amount, 0);
            const nonEssential = monthTransactions.filter(t => t.type === 'non-essential').reduce((sum, t) => sum + t.amount, 0);

            distributionChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Essenciais', 'N√£o Essenciais'],
                    datasets: [{
                        data: [essential, nonEssential],
                        backgroundColor: ['#0066FF', '#FF6B35'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                color: '#F8FAFC',
                                padding: 20,
                                font: {
                                    size: 11
                                }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.raw || 0;
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = Math.round((value / total) * 100);
                                    return `${label}: R$ ${value.toLocaleString('pt-BR', { minimumFractionDigits: 2 })} (${percentage}%)`;
                                }
                            }
                        },
                        // CORRE√á√ÉO: Adicionar valores dentro da pizza
                        datalabels: {
                            color: '#FFFFFF',
                            font: {
                                weight: 'bold',
                                size: 14
                            },
                            formatter: (value, ctx) => {
                                const total = ctx.chart.data.datasets[0].data.reduce((a, b) => a + b, 0);
                                const percentage = Math.round((value / total) * 100);
                                return `R$ ${value.toLocaleString('pt-BR', { minimumFractionDigits: 0 })}\n${percentage}%`;
                            }
                        }
                    }
                },
                plugins: [ChartDataLabels] // Adicionar o plugin de datalabels
            });
        }


        function setupIncomeTrendChart() {
            const ctx = document.getElementById('incomeTrendChart').getContext('2d');
            if (trendChart) trendChart.destroy();


            // Generate last 6 months data
            const months = [];
            const revenueData = [];
            const expenseData = [];
            
            for (let i = 5; i >= 0; i--) {
                const date = new Date();
                date.setMonth(currentMonth - i);
                const month = date.getMonth();
                const year = date.getFullYear();

                const monthTransactions = transactions.filter(t => {
                    const transactionDate = new Date(t.date);
                    return transactionDate.getMonth() === month && transactionDate.getFullYear() === year;
                });

                const revenue = monthTransactions.filter(t => t.type === 'revenue').reduce((sum, t) => sum + t.amount, 0);
                const expenses = monthTransactions.filter(t => t.type === 'essential' || t.type === 'non-essential').reduce((sum, t) => sum + t.amount, 0);
                
                months.push(getMonthName(month));
                revenueData.push(revenue);
                expenseData.push(expenses);
            }


            trendChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: months,
                    datasets: [
                        {
                            label: 'Receitas',
                            data: revenueData,
                            borderColor: '#00D4AA',
                            backgroundColor: 'rgba(0, 212, 170, 0.1)',
                            tension: 0.4,
                            fill: true
                        },
                        {
                            label: 'Despesas',
                            data: expenseData,
                            borderColor: '#FF6B35',
                            backgroundColor: 'rgba(255, 107, 53, 0.1)',
                            tension: 0.4,
                            fill: true
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                color: '#F8FAFC'
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#F8FAFC',
                                callback: function(value) {
                                    return 'R$ ' + value.toLocaleString('pt-BR', { minimumFractionDigits: 0 });
                                }
                            }
                        },
                        x: {
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#F8FAFC'
                            }
                        }
                    }
                }
            });
        }


        function setupGoalsProgressChart() {
            const ctx = document.getElementById('goalsProgressChart').getContext('2d');
            if (goalsChart) goalsChart.destroy();


            const goalNames = goals.map(goal => goal.name);
            const currentAmounts = goals.map(goal => goal.current);
            const targetAmounts = goals.map(goal => goal.target);


            goalsChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: goalNames,
                    datasets: [
                        {
                            label: 'Valor Atual',
                            data: currentAmounts,
                            backgroundColor: 'rgba(0, 102, 255, 0.8)',
                            borderRadius: 4
                        },
                        {
                            label: 'Meta',
                            data: targetAmounts,
                            backgroundColor: 'rgba(0, 212, 170, 0.6)',
                            borderRadius: 4
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                color: '#F8FAFC'
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#F8FAFC',
                                callback: function(value) {
                                    return 'R$ ' + value.toLocaleString('pt-BR', { minimumFractionDigits: 0 });
                                }
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            },
                            ticks: {
                                color: '#F8FAFC',
                                maxRotation: 45
                            }
                        }
                    }
                }
            });
        }


        function setupSavingsProjectionChart() {
            const ctx = document.getElementById('savingsProjectionChart').getContext('2d');
            if (projectionChart) projectionChart.destroy();


            // Simple projection for next 12 months
            const months = ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun', 'Jul', 'Ago', 'Set', 'Out', 'Nov', 'Dez'];
            const currentSavings = transactions
                .filter(t => t.type === 'revenue')
                .reduce((sum, t) => sum + t.amount, 0) - 
                transactions.filter(t => t.type === 'essential' || t.type === 'non-essential')
                .reduce((sum, t) => sum + t.amount, 0);
            const projectionData = [];
            let current = Math.max(0, currentSavings);
            const monthlySavings = currentSavings / 12;

            for (let i = 0; i < 12; i++) {
                current += monthlySavings;
                projectionData.push(current);
            }


            projectionChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: months,
                    datasets: [{
                        label: 'Proje√ß√£o de Economia',
                        data: projectionData,
                        borderColor: '#9B59B6',
                        backgroundColor: 'rgba(155, 89, 182, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                color: '#F8FAFC'
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#F8FAFC',
                                callback: function(value) {
                                    return 'R$ ' + value.toLocaleString('pt-BR', { minimumFractionDigits: 0 });
                                }
                            }
                        },
                        x: {
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#F8FAFC'
                            }
                        }
                    }
                }
            });
        }


        function setupMonthlyComparisonChart() {
            const ctx = document.getElementById('monthlyComparisonChart').getContext('2d');
            if (comparisonChart) comparisonChart.destroy();


            const currentMonthData = getCurrentMonthTransactions();
            const lastMonthData = getLastMonthTransactions();

            const currentRevenue = currentMonthData.filter(t => t.type === 'revenue').reduce((sum, t) => sum + t.amount, 0);
            const currentExpenses = currentMonthData.filter(t => t.type === 'essential' || t.type === 'non-essential').reduce((sum, t) => sum + t.amount, 0);
            const lastRevenue = lastMonthData.filter(t => t.type === 'revenue').reduce((sum, t) => sum + t.amount, 0);
            const lastExpenses = lastMonthData.filter(t => t.type === 'essential' || t.type === 'non-essential').reduce((sum, t) => sum + t.amount, 0);

            comparisonChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Receitas', 'Despesas'],
                    datasets: [
                        {
                            label: 'M√™s Atual',
                            data: [currentRevenue, currentExpenses],
                            backgroundColor: 'rgba(0, 102, 255, 0.8)',
                            borderRadius: 4
                        },
                        {
                            label: 'M√™s Anterior',
                            data: [lastRevenue, lastExpenses],
                            backgroundColor: 'rgba(100, 100, 100, 0.6)',
                            borderRadius: 4
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                color: '#F8FAFC'
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#F8FAFC',
                                callback: function(value) {
                                    return 'R$ ' + value.toLocaleString('pt-BR', { minimumFractionDigits: 0 });
                                }
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            },
                            ticks: {
                                color: '#F8FAFC'
                            }
                        }
                    }
                }
            });
        }


        function updateCharts() {
            setupCharts();
        }


        function getMonthName(month) {
            const months = ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun', 'Jul', 'Ago', 'Set', 'Out', 'Nov', 'Dez'];
            return months[month];
        }


        // Transaction management functions
        // MODIFICADO: Fun√ß√£o addRevenue() SUBSTITU√çDA
        function addRevenue() {
            const description = document.getElementById('revenueDescription').value.trim();
            const amount = parseFloat(document.getElementById('revenueAmountInput').value);
            const category = document.getElementById('revenueCategory').value;

            if (!description || isNaN(amount) || amount <= 0 || !category) {
                showNotification('Preencha todos os campos corretamente', 'error');
                return;
            }

            // VERIFICA SE USU√ÅRIO EST√Å LOGADO
            const user = auth.currentUser;
            if (!user) {
                showNotification('Fa√ßa login para salvar transa√ß√µes', 'error');
                return;
            }

            const transactionData = {
                description,
                amount,
                type: 'revenue',
                category,
                date: new Date().toISOString().split('T')[0],
                createdAt: firebase.firestore.FieldValue.serverTimestamp()
            };

            // SALVA NO FIREBASE (NUVEM)
            db.collection('users').doc(user.uid).collection('transactions')
                .add(transactionData)
                .then(() => {
                    showNotification('Receita salva na nuvem! ‚úÖ', 'success');
                    // Limpar formul√°rio
                    document.getElementById('revenueDescription').value = '';
                    document.getElementById('revenueAmountInput').value = '';
                    document.getElementById('revenueCategory').value = '';
                    // Recarregar dados
                    loadUserData();
                })
                .catch((error) => {
                    showNotification('Erro ao salvar: ' + error.message, 'error');
                });
        }

        // MODIFICADO: Fun√ß√£o addEssentialExpense() SUBSTITU√çDA
        function addEssentialExpense() {
            const description = document.getElementById('essentialDescription').value.trim();
            const amount = parseFloat(document.getElementById('essentialAmountInput').value);
            const category = document.getElementById('essentialCategory').value;

            if (!description || isNaN(amount) || amount <= 0 || !category) {
                showNotification('Preencha todos os campos corretamente', 'error');
                return;
            }

            const user = auth.currentUser;
            if (!user) {
                showNotification('Fa√ßa login para salvar transa√ß√µes', 'error');
                return;
            }

            const transactionData = {
                description,
                amount,
                type: 'essential',
                category,
                date: new Date().toISOString().split('T')[0],
                createdAt: firebase.firestore.FieldValue.serverTimestamp()
            };

            db.collection('users').doc(user.uid).collection('transactions')
                .add(transactionData)
                .then(() => {
                    showNotification('Despesa essencial salva na nuvem! ‚úÖ', 'success');
                    document.getElementById('essentialDescription').value = '';
                    document.getElementById('essentialAmountInput').value = '';
                    document.getElementById('essentialCategory').value = '';
                    loadUserData();
                })
                .catch((error) => {
                    showNotification('Erro ao salvar: ' + error.message, 'error');
                });
        }

        // MODIFICADO: Fun√ß√£o addNonEssentialExpense() SUBSTITU√çDA
        function addNonEssentialExpense() {
            const description = document.getElementById('nonEssentialDescription').value.trim();
            const amount = parseFloat(document.getElementById('nonEssentialAmountInput').value);
            const category = document.getElementById('nonEssentialCategory').value;

            if (!description || isNaN(amount) || amount <= 0 || !category) {
                showNotification('Preencha todos os campos corretamente', 'error');
                return;
            }

            const user = auth.currentUser;
            if (!user) {
                showNotification('Fa√ßa login para salvar transa√ß√µes', 'error');
                return;
            }

            const transactionData = {
                description,
                amount,
                type: 'non-essential',
                category,
                date: new Date().toISOString().split('T')[0],
                createdAt: firebase.firestore.FieldValue.serverTimestamp()
            };

            db.collection('users').doc(user.uid).collection('transactions')
                .add(transactionData)
                .then(() => {
                    showNotification('Despesa n√£o essencial salva na nuvem! ‚úÖ', 'success');
                    document.getElementById('nonEssentialDescription').value = '';
                    document.getElementById('nonEssentialAmountInput').value = '';
                    document.getElementById('nonEssentialCategory').value = '';
                    loadUserData();
                })
                .catch((error) => {
                    showNotification('Erro ao salvar: ' + error.message, 'error');
                });
        }


        // Goal management functions
        function addGoal() {
            const name = document.getElementById('goalName').value.trim();
            const target = parseFloat(document.getElementById('goalTarget').value);
            const current = parseFloat(document.getElementById('goalCurrent').value);
            const deadline = parseInt(document.getElementById('goalDeadline').value);
            
            if (!name || isNaN(target) || target <= 0 || isNaN(current) || current < 0 || isNaN(deadline) || deadline <= 0) {
                showNotification('Preencha todos os campos corretamente', 'error');
                return;
            }


            if (current > target) {
                showNotification('O valor atual n√£o pode ser maior que a meta', 'error');
                return;
            }


            const newGoal = {
                id: Date.now(),
                name,
                target,
                current,
                deadline
            };


            goals.push(newGoal);
            saveData();
            updateDashboard();
            updateAllGoalsList();

            // Reset form
            document.getElementById('goalName').value = '';
            document.getElementById('goalTarget').value = '';
            document.getElementById('goalCurrent').value = '';
            document.getElementById('goalDeadline').value = '12';
            
            showNotification('Meta adicionada com sucesso!', 'success');
        }


        // Edit Transaction Management
        function editTransaction(id) {
            const transaction = transactions.find(t => t.id === id);
            if (!transaction) return;


            editingTransactionId = id;
            
            document.getElementById('editTransactionDescription').value = transaction.description;
            document.getElementById('editTransactionAmount').value = transaction.amount;
            document.getElementById('editTransactionDate').value = transaction.date;
            document.getElementById('editTransactionType').value = transaction.type;
            
            // Update categories based on type
            updateEditCategories(transaction.type);
            document.getElementById('editTransactionCategory').value = transaction.category;
            
            document.getElementById('editTransactionModal').classList.add('active');
        }


        function updateEditCategories(type) {
            const categorySelect = document.getElementById('editTransactionCategory');
            categorySelect.innerHTML = '';
            
            // Add default option
            const defaultOption = document.createElement('option');
            defaultOption.value = '';
            defaultOption.textContent = 'Selecione uma categoria';
            categorySelect.appendChild(defaultOption);
            
            if (type === 'revenue') {
                const revenueCategories = [
                    { value: 'salary', label: 'Sal√°rio' },
                    { value: 'freelance', label: 'Freelance' },
                    { value: 'investment', label: 'Investimento' },
                    { value: 'bonus', label: 'B√¥nus' },
                    { value: 'other-income', label: 'Outra Receita' }
                ];
                revenueCategories.forEach(cat => {
                    const option = document.createElement('option');
                    option.value = cat.value;
                    option.textContent = cat.label;
                    categorySelect.appendChild(option);
                });
            } else if (type === 'essential') {
                const essentialCategories = [
                    { value: 'rent', label: 'Aluguel' },
                    { value: 'food', label: 'Alimenta√ß√£o' },
                    { value: 'transport', label: 'Transporte' },
                    { value: 'health', label: 'Sa√∫de' },
                    { value: 'education', label: 'Educa√ß√£o' },
                    { value: 'utilities', label: 'Contas (Luz/√Ågua)' }
                ];
                essentialCategories.forEach(cat => {
                    const option = document.createElement('option');
                    option.value = cat.value;
                    option.textContent = cat.label;
                    categorySelect.appendChild(option);
                });
            } else {
                const nonEssentialCategories = [
                    { value: 'entertainment', label: 'Entretenimento' },
                    { value: 'shopping', label: 'Compras' },
                    { value: 'restaurant', label: 'Restaurante' },
                    { value: 'travel', label: 'Viagens' },
                    { value: 'hobbies', label: 'Hobbies' },
                    { value: 'other-non-essential', label: 'Outros' }
                ];
                nonEssentialCategories.forEach(cat => {
                    const option = document.createElement('option');
                    option.value = cat.value;
                    option.textContent = cat.label;
                    categorySelect.appendChild(option);
                });
            }
        }


        function closeEditTransactionModal() {
            document.getElementById('editTransactionModal').classList.remove('active');
            editingTransactionId = null;
        }


        function saveTransaction() {
            if (editingTransactionId === null) return;

            const description = document.getElementById('editTransactionDescription').value.trim();
            const amount = parseFloat(document.getElementById('editTransactionAmount').value);
            const date = document.getElementById('editTransactionDate').value;
            const type = document.getElementById('editTransactionType').value;
            const category = document.getElementById('editTransactionCategory').value;

            if (!description || isNaN(amount) || amount <= 0 || !date || !category) {
                showNotification('Preencha todos os campos corretamente', 'error');
                return;
            }


            const transactionIndex = transactions.findIndex(t => t.id === editingTransactionId);
            if (transactionIndex !== -1) {
                transactions[transactionIndex] = {
                    ...transactions[transactionIndex],
                    description,
                    amount,
                    date,
                    type,
                    category
                };
                saveData();
                updateDashboard();
                updateTransactionsList();
                closeEditTransactionModal();
                showNotification('Transa√ß√£o atualizada com sucesso!', 'success');
            }
        }


        function deleteTransactionPrompt(id) {
            if (confirm('Tem certeza que deseja excluir esta transa√ß√£o?')) {
                deleteTransaction(id);
            }
        }


        function deleteTransaction(id = null) {
            const transactionId = id || editingTransactionId;
            if (!transactionId) return;


            transactions = transactions.filter(t => t.id !== transactionId);
            saveData();
            updateDashboard();
            updateTransactionsList();
            
            if (id === null) {
                closeEditTransactionModal();
            }
            
            showNotification('Transa√ß√£o exclu√≠da com sucesso!', 'warning');
        }


        // Edit Goal Management
        function editGoal(id) {
            const goal = goals.find(g => g.id === id);
            if (!goal) return;


            editingGoalId = id;
            
            document.getElementById('editGoalName').value = goal.name;
            document.getElementById('editGoalTarget').value = goal.target;
            document.getElementById('editGoalCurrent').value = goal.current;
            document.getElementById('editGoalDeadline').value = goal.deadline;
            
            document.getElementById('editGoalModal').classList.add('active');
        }


        function closeEditGoalModal() {
            document.getElementById('editGoalModal').classList.remove('active');
            editingGoalId = null;
        }


        function saveGoal() {
            if (editingGoalId === null) return;

            const name = document.getElementById('editGoalName').value.trim();
            const target = parseFloat(document.getElementById('editGoalTarget').value);
            const current = parseFloat(document.getElementById('editGoalCurrent').value);
            const deadline = parseInt(document.getElementById('editGoalDeadline').value);

            if (!name || isNaN(target) || target <= 0 || isNaN(current) || current < 0 || isNaN(deadline) || deadline <= 0) {
                showNotification('Preencha todos os campos corretamente', 'error');
                return;
            }


            if (current > target) {
                showNotification('O valor atual n√£o pode ser maior que a meta', 'error');
                return;
            }


            const goalIndex = goals.findIndex(g => g.id === editingGoalId);
            if (goalIndex !== -1) {
                goals[goalIndex] = {
                    ...goals[goalIndex],
                    name,
                    target,
                    current,
                    deadline
                };
                saveData();
                updateDashboard();
                updateAllGoalsList();
                closeEditGoalModal();
                showNotification('Meta atualizada com sucesso!', 'success');
            }
        }


        function deleteGoalPrompt(id) {
            if (confirm('Tem certeza que deseja excluir esta meta?')) {
                deleteGoal(id);
            }
        }


        function deleteGoal(id = null) {
            const goalId = id || editingGoalId;
            if (!goalId) return;


            goals = goals.filter(g => g.id !== goalId);
            saveData();
            updateDashboard();
            updateAllGoalsList();
            
            if (id === null) {
                closeEditGoalModal();
            }
            
            showNotification('Meta exclu√≠da com sucesso!', 'warning');
        }


        // Utility functions
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('pt-BR');
        }


        function getCategoryName(category) {
            const categories = {
                'salary': 'Sal√°rio',
                'freelance': 'Freelance',
                'investment': 'Investimento',
                'bonus': 'B√¥nus',
                'other-income': 'Outra Receita',
                'rent': 'Aluguel',
                'food': 'Alimenta√ß√£o',
                'transport': 'Transporte',
                'health': 'Sa√∫de',
                'education': 'Educa√ß√£o',
                'utilities': 'Contas',
                'entertainment': 'Entretenimento',
                'shopping': 'Compras',
                'restaurant': 'Restaurante',
                'travel': 'Viagens',
                'hobbies': 'Hobbies',
                'other-non-essential': 'Outros'
            };
            return categories[category] || category;
        }


        function setupEventListeners() {
            document.getElementById('monthSelect').addEventListener('change', function() {
                currentMonth = parseInt(this.value);
                updateDashboard();
                updateSelectedMonthDisplay();
            });
            document.getElementById('yearSelect').addEventListener('change', function() {
                currentYear = parseInt(this.value);
                updateDashboard();
                updateSelectedMonthDisplay();
            });
        }


        function switchChartPeriod(period) {
            showNotification(`Per√≠odo alterado para: ${period === 'monthly' ? 'Mensal' : period === 'quarterly' ? 'Trimestral' : 'Anual'}`, 'info');
        }


        function generateReport() {
            showNotification('Relat√≥rio gerado com sucesso!', 'success');
        }


        function exportTransactions() {
            showNotification('Transa√ß√µes exportadas com sucesso!', 'success');
        }


        function exportGoals() {
            showNotification('Metas exportadas com sucesso!', 'success');
        }


        function refreshInsights() {
            showNotification('Insights atualizados!', 'info');
            updateAIInsights();
            updateFullInsights();
        }


        function logout() {
            if (confirm('Tem certeza que deseja sair?')) {
                showNotification('Logout realizado com sucesso!', 'info');
            }
        }


        function showAddInvestmentModal() {
            showNotification('Funcionalidade em desenvolvimento', 'info');
        }


        // Notification system
        function showNotification(message, type = 'info') {
            const container = document.querySelector('.notification-container') || createNotificationContainer();
            
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <div class="notification-icon">
                    <i class="fas fa-${getNotificationIcon(type)}"></i>
                </div>
                <div class="notification-content">${message}</div>
                <button class="notification-close" onclick="this.parentElement.remove()">
                    <i class="fas fa-times"></i>
                </button>
            `;
            container.appendChild(notification);
            
            setTimeout(() => {
                if (notification.parentElement) {
                    notification.remove();
                }
            }, 5000);
        }


        function createNotificationContainer() {
            const container = document.createElement('div');
            container.className = 'notification-container';
            document.body.appendChild(container);
            return container;
        }


        function getNotificationIcon(type) {
            const icons = {
                success: 'check-circle',
                error: 'exclamation-circle',
                warning: 'exclamation-triangle',
                info: 'info-circle'
            };
            return icons[type] || 'info-circle';
        }


        // Close modals when clicking outside
        document.addEventListener('click', function(event) {
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                if (event.target === modal) {
                    modal.classList.remove('active');
                }
            });
        });

        // Initialize the app when the page loads
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>