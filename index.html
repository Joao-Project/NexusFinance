<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nexus Finance | Dashboard Inteligente Premium</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- üî• ADICIONAR FIREBASE -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

    <!-- üî• ADICIONAR PDF LIBRARY -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>

    <style>
        /* ===== RESET E BASE ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', 'Segoe UI', system-ui, sans-serif;
        }

        :root {
            --primary: #2563eb;
            --primary-dark: #1d4ed8;
            --primary-light: #3b82f6;
            --secondary: #f59e0b;
            --accent: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --success: #10b981;
            --economy: #8b5cf6;
            --dark: #0f172a;
            --darker: #0a0f1c;
            --light: #f8fafc;
            --gray: #64748b;
            --gray-dark: #334155;
            --card-bg: rgba(255, 255, 255, 0.05);
            --glass: rgba(255, 255, 255, 0.08);
            --glass-border: rgba(255, 255, 255, 0.12);
            --border-radius: 16px;
            --shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.2);
            --shadow-hover: 0 20px 40px -10px rgba(0, 0, 0, 0.3);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Modo Claro */
        [data-theme="light"] {
            --primary: #3b82f6;
            --primary-dark: #2563eb;
            --primary-light: #60a5fa;
            --secondary: #f59e0b;
            --accent: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --success: #10b981;
            --economy: #8b5cf6;
            --dark: #f8fafc;
            --darker: #f1f5f9;
            --light: #0f172a;
            --gray: #64748b;
            --gray-dark: #334155;
            --card-bg: rgba(255, 255, 255, 0.9);
            --glass: rgba(255, 255, 255, 0.8);
            --glass-border: rgba(0, 0, 0, 0.1);
        }

        body {
            background: linear-gradient(135deg, var(--darker) 0%, var(--dark) 50%, #1e1b4b 100%);
            color: var(--light);
            min-height: 100vh;
            overflow-x: hidden;
            line-height: 1.6;
            transition: var(--transition);
        }

        [data-theme="light"] body {
            background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 50%, #cbd5e1 100%);
        }

        .app-container {
            display: flex;
            min-height: 100vh;
        }

        /* ===== TYPOGRAPHY IMPROVEMENTS ===== */
        h1, h2, h3, h4, h5, h6 {
            font-weight: 600;
            line-height: 1.3;
            margin-bottom: 0.5em;
        }

        h1 { font-size: 2.25rem; }
        h2 { font-size: 1.875rem; }
        h3 { font-size: 1.5rem; }
        h4 { font-size: 1.25rem; }

        p {
            margin-bottom: 1rem;
        }

        /* ===== SIDEBAR MELHORADO ===== */
        .sidebar {
            width: 280px;
            background: var(--card-bg);
            backdrop-filter: blur(20px);
            border-right: 1px solid var(--glass-border);
            padding: 25px 0;
            display: flex;
            flex-direction: column;
            transition: var(--transition);
            position: fixed;
            height: 100vh;
            left: 0;
            top: 0;
            z-index: 1000;
            overflow-y: auto;
        }

        .sidebar-header {
            padding: 0 25px 25px;
            border-bottom: 1px solid var(--glass-border);
            margin-bottom: 25px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 1.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary), var(--success));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .nav-menu {
            flex: 1;
            padding: 0 15px;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 15px 20px;
            border-radius: var(--border-radius);
            margin-bottom: 8px;
            cursor: pointer;
            transition: var(--transition);
            color: var(--gray);
            font-weight: 500;
            position: relative;
            overflow: hidden;
        }

        .nav-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transition: left 0.5s;
        }

        .nav-item:hover::before {
            left: 100%;
        }

        .nav-item.active {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            box-shadow: var(--shadow);
        }

        .nav-item:hover:not(.active) {
            background: rgba(255, 255, 255, 0.05);
            color: var(--light);
            transform: translateX(5px);
        }

        .sidebar-footer {
            padding: 20px 25px 0;
            border-top: 1px solid var(--glass-border);
            margin-top: auto;
        }

        .user-card {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: var(--border-radius);
            transition: var(--transition);
            cursor: pointer;
        }

        .user-card:hover {
            background: rgba(255, 255, 255, 0.08);
        }

        .user-avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--success));
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            font-size: 1rem;
            border: 2px solid var(--glass-border);
        }

        .user-info {
            flex: 1;
        }

        .user-name {
            font-weight: 600;
            font-size: 0.9rem;
        }

        .logout-btn {
            background: none;
            border: none;
            color: var(--danger);
            cursor: pointer;
            padding: 8px;
            border-radius: 8px;
            transition: var(--transition);
        }

        .logout-btn:hover {
            background: var(--danger);
            color: white;
            transform: scale(1.05);
        }

        /* ===== MAIN CONTENT ===== */
        .main-content {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
            padding-bottom: 100px;
            margin-left: 280px;
            width: calc(100% - 280px);
        }

        /* ===== HEADER ===== */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 20px;
        }

        .header-title {
            font-size: 1.8rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary), var(--success));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .header-actions {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .theme-toggle {
            background: var(--card-bg);
            border: 1px solid var(--glass-border);
            border-radius: 50%;
            width: 45px;
            height: 45px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            color: var(--light);
            font-size: 1.2rem;
        }

        .theme-toggle:hover {
            transform: rotate(15deg);
            border-color: var(--primary);
        }

        .date-filter-container {
            display: flex;
            align-items: center;
            gap: 10px;
            background: var(--card-bg);
            padding: 12px 20px;
            border-radius: var(--border-radius);
            border: 1px solid var(--glass-border);
            backdrop-filter: blur(10px);
            box-shadow: var(--shadow);
            transition: var(--transition);
        }

        .date-filter-container:hover {
            border-color: var(--primary);
            box-shadow: var(--shadow-hover);
            transform: translateY(-2px);
        }

        .date-select {
            background: var(--dark);
            border: 1px solid var(--glass-border);
            color: var(--light);
            font-weight: 500;
            font-size: 0.95rem;
            padding: 8px 12px;
            border-radius: 8px;
            cursor: pointer;
            outline: none;
            transition: var(--transition);
            min-width: 120px;
        }

        .date-select:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.2);
        }

        /* ===== DASHBOARD GRID ===== */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 25px;
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
            cursor: pointer;
            box-shadow: var(--shadow);
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
        }

        .stat-card.revenue::before { background: var(--success); }
        .stat-card.essential::before { background: var(--primary); }
        .stat-card.non-essential::before { background: var(--secondary); }
        .stat-card.economy::before { background: var(--economy); }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-hover);
            border-color: rgba(255, 255, 255, 0.2);
        }

        .stat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .stat-title {
            font-size: 0.9rem;
            color: var(--gray);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .stat-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }

        .stat-card.revenue .stat-icon { background: rgba(16, 185, 129, 0.2); color: var(--success); }
        .stat-card.essential .stat-icon { background: rgba(37, 99, 235, 0.2); color: var(--primary); }
        .stat-card.non-essential .stat-icon { background: rgba(245, 158, 11, 0.2); color: var(--secondary); }
        .stat-card.economy .stat-icon { background: rgba(139, 92, 246, 0.2); color: var(--economy); }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 8px;
            background: linear-gradient(135deg, var(--light), #cbd5e1);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .stat-change {
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            gap: 4px;
            font-weight: 500;
        }

        .stat-change.positive { color: var(--success); }
        .stat-change.negative { color: var(--danger); }

        /* ===== CHARTS GRID ===== */
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .chart-card {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 25px;
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            box-shadow: var(--shadow);
            transition: var(--transition);
        }

        .chart-card:hover {
            box-shadow: var(--shadow-hover);
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .chart-title {
            font-size: 1.1rem;
            font-weight: 600;
        }

        .chart-container {
            position: relative;
            height: 300px;
        }

        /* ===== INVESTMENT CARDS ===== */
        .investment-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .investment-card {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 25px;
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            transition: var(--transition);
            cursor: pointer;
            text-align: center;
            box-shadow: var(--shadow);
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .investment-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-hover);
            border-color: var(--primary);
        }

        .investment-icon {
            width: 70px;
            height: 70px;
            border-radius: 18px;
            background: linear-gradient(135deg, var(--primary), var(--success));
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 15px;
            font-size: 1.5rem;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }

        .investment-title {
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 1.1rem;
        }

        .investment-description {
            font-size: 0.85rem;
            color: var(--gray);
            line-height: 1.5;
        }

        /* ===== BUTTONS ===== */
        .btn {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            border: none;
            border-radius: 10px;
            padding: 12px 20px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
            text-decoration: none;
            justify-content: center;
            box-shadow: var(--shadow);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-hover);
        }

        .btn-success {
            background: linear-gradient(135deg, var(--success), #0d9668);
        }

        .btn-warning {
            background: linear-gradient(135deg, var(--warning), #d97706);
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--danger), #dc2626);
        }

        .btn-outline {
            background: transparent;
            border: 1px solid var(--glass-border);
            color: var(--light);
        }

        .btn-outline:hover {
            background: var(--glass);
            border-color: var(--primary);
        }

        .btn-sm {
            padding: 8px 15px;
            font-size: 0.8rem;
        }

        /* ===== TRANSACTIONS ===== */
        .transactions-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .transaction-form-card {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 25px;
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            box-shadow: var(--shadow);
            transition: var(--transition);
        }

        .transaction-form-card:hover {
            box-shadow: var(--shadow-hover);
        }

        .form-header-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.3rem;
            margin-bottom: 15px;
        }

        .revenue-form .form-header-icon {
            background: rgba(16, 185, 129, 0.2);
            color: var(--success);
        }

        .essential-form .form-header-icon {
            background: rgba(37, 99, 235, 0.2);
            color: var(--primary);
        }

        .non-essential-form .form-header-icon {
            background: rgba(245, 158, 11, 0.2);
            color: var(--secondary);
        }

        .form-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .form-subtitle {
            color: var(--gray);
            margin-bottom: 20px;
            font-size: 0.9rem;
        }

        .form-group {
            margin-bottom: 20px;
            text-align: left;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--gray);
            font-size: 0.9rem;
        }

        .form-input {
            width: 100%;
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid var(--glass-border);
            border-radius: 10px;
            padding: 12px 15px;
            color: var(--light);
            font-size: 0.9rem;
            transition: var(--transition);
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.2);
            background: rgba(255, 255, 255, 0.12);
        }

        .form-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 20px;
        }

        /* ===== TRANSACTION LIST ===== */
        .transaction-list-section {
            margin-top: 30px;
        }

        .transaction-list {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
            margin-top: 20px;
        }

        .transaction-item {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 20px;
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: var(--transition);
            box-shadow: var(--shadow);
        }

        .transaction-item:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-hover);
            border-color: rgba(255, 255, 255, 0.2);
        }

        .transaction-info {
            flex: 1;
        }

        .transaction-description {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .transaction-date {
            font-size: 0.8rem;
            color: var(--gray);
        }

        .transaction-amount {
            font-weight: 700;
            font-size: 1.1rem;
            margin-right: 15px;
        }

        .transaction-amount.revenue {
            color: var(--success);
        }

        .transaction-amount.essential {
            color: var(--primary);
        }

        .transaction-amount.non-essential {
            color: var(--secondary);
        }

        .transaction-actions {
            display: flex;
            gap: 8px;
        }

        /* ===== SECTION STYLES ===== */
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--glass-border);
        }

        .section-title {
            font-size: 1.3rem;
            font-weight: 600;
        }

        .simulator-section {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 25px;
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            margin-bottom: 25px;
            box-shadow: var(--shadow);
        }

        .simulator-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            align-items: start;
        }

        .simulator-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .simulator-results {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid var(--glass-border);
        }

        .result-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .result-item:last-child {
            border-bottom: none;
        }

        .result-label {
            color: var(--gray);
            font-weight: 500;
        }

        .result-value {
            font-weight: 600;
            font-size: 1.1rem;
        }

        .result-value.positive {
            color: var(--success);
        }

        .result-value.negative {
            color: var(--danger);
        }

        /* ===== INDICATORS ===== */
        .indicators-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .indicator-card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 20px;
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            transition: var(--transition);
            box-shadow: var(--shadow);
        }

        .indicator-card:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-hover);
        }

        .indicator-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .indicator-title {
            font-weight: 600;
            font-size: 0.9rem;
            color: var(--gray);
        }

        .indicator-value {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .indicator-change {
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .indicator-change.positive {
            color: var(--success);
        }

        .indicator-change.negative {
            color: var(--danger);
        }

        /* ===== GOALS ===== */
        .goals-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .goal-card {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 25px;
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            transition: var(--transition);
            cursor: pointer;
            box-shadow: var(--shadow);
        }

        .goal-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-hover);
        }

        .goal-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .goal-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .goal-description {
            font-size: 0.85rem;
            color: var(--gray);
            margin-bottom: 15px;
        }

        .goal-progress {
            margin-bottom: 15px;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 8px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--success));
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        .progress-info {
            display: flex;
            justify-content: space-between;
            font-size: 0.8rem;
            color: var(--gray);
        }

        .goal-amount {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .goal-target {
            font-size: 0.85rem;
            color: var(--gray);
        }

        .goal-monthly {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            padding: 10px 15px;
            margin: 10px 0;
            border-left: 3px solid var(--warning);
        }

        .goal-monthly-label {
            font-size: 0.8rem;
            color: var(--gray);
            margin-bottom: 4px;
        }

        .goal-monthly-value {
            font-size: 1rem;
            font-weight: 600;
            color: var(--warning);
        }

        .goal-actions {
            display: flex;
            gap: 8px;
            margin-top: 15px;
        }

        /* ===== PORTFOLIO ===== */
        .portfolio-section {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 25px;
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            margin-bottom: 25px;
            box-shadow: var(--shadow);
        }

        .portfolio-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            margin-top: 20px;
        }

        .portfolio-summary {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 25px;
            border: 1px solid var(--glass-border);
        }

        .portfolio-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .portfolio-stat-card {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            border: 1px solid var(--glass-border);
            transition: var(--transition);
            box-shadow: var(--shadow);
        }

        .portfolio-stat-card:hover {
            transform: translateY(-3px);
            border-color: var(--primary);
            box-shadow: var(--shadow-hover);
        }

        .portfolio-stat-value {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .portfolio-stat-label {
            font-size: 0.8rem;
            color: var(--gray);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .portfolio-stat-change {
            font-size: 0.75rem;
            margin-top: 5px;
        }

        .portfolio-stat-change.positive {
            color: var(--success);
        }

        .portfolio-stat-change.negative {
            color: var(--danger);
        }

        .portfolio-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .portfolio-item {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid var(--glass-border);
            transition: var(--transition);
            box-shadow: var(--shadow);
        }

        .portfolio-item:hover {
            transform: translateY(-2px);
            border-color: var(--primary);
            box-shadow: var(--shadow-hover);
        }

        .portfolio-item-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 15px;
        }

        .portfolio-item-info {
            flex: 1;
        }

        .portfolio-item-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 8px;
        }

        .portfolio-item-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }

        .portfolio-item-name {
            font-weight: 600;
            font-size: 1.1rem;
        }

        .portfolio-item-details {
            display: flex;
            gap: 15px;
            font-size: 0.85rem;
            color: var(--gray);
        }

        .portfolio-item-amount {
            font-size: 1.2rem;
            font-weight: 700;
            margin: 10px 0 5px 0;
        }

        .portfolio-item-profitability {
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .portfolio-item-profitability.positive {
            color: var(--success);
        }

        .portfolio-item-profitability.negative {
            color: var(--danger);
        }

        .portfolio-item-actions {
            display: flex;
            gap: 8px;
        }

        .portfolio-chart-container {
            height: 300px;
            margin-top: 20px;
        }

        /* ===== LOGIN SCREEN ===== */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        .login-card {
            background: var(--card-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            padding: 40px;
            width: 100%;
            max-width: 450px;
            text-align: center;
            box-shadow: var(--shadow-hover);
        }

        .login-logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            font-size: 2rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary), var(--success));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 30px;
        }

        .auth-tabs {
            display: flex;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 4px;
            margin-bottom: 25px;
        }

        .auth-tab {
            flex: 1;
            padding: 12px;
            text-align: center;
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 600;
            font-size: 0.9rem;
        }

        .auth-tab.active {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
        }

        .auth-tab:not(.active) {
            color: var(--gray);
        }

        .auth-form {
            display: none;
        }

        .auth-form.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .login-btn {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            border: none;
            border-radius: 10px;
            padding: 12px 20px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.9rem;
            width: 100%;
            margin-top: 10px;
            box-shadow: var(--shadow);
        }

        .login-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-hover);
        }

        /* ===== MOBILE NAVIGATION ===== */
        .mobile-bottom-nav {
            display: none;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--card-bg);
            backdrop-filter: blur(20px);
            border-top: 1px solid var(--glass-border);
            padding: 12px 0;
            z-index: 1000;
            box-shadow: 0 -5px 20px rgba(0, 0, 0, 0.2);
        }

        .mobile-nav-items {
            display: flex;
            justify-content: space-around;
            align-items: center;
        }

        .mobile-nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
            padding: 8px 12px;
            border-radius: 16px;
            cursor: pointer;
            transition: var(--transition);
            color: var(--gray);
            font-size: 0.75rem;
            min-width: 70px;
            flex: 1;
        }

        .mobile-nav-item.active {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            box-shadow: 0 4px 15px rgba(37, 99, 235, 0.3);
        }

        .mobile-nav-item:hover:not(.active) {
            background: rgba(255, 255, 255, 0.05);
            color: var(--light);
        }

        .mobile-nav-item i {
            font-size: 1.3rem;
        }

        /* ===== MODALS ===== */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 30px;
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-hover);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--glass-border);
        }

        .modal-title {
            font-size: 1.3rem;
            font-weight: 600;
        }

        .modal-close {
            background: none;
            border: none;
            color: var(--gray);
            font-size: 1.5rem;
            cursor: pointer;
            padding: 5px;
            transition: var(--transition);
        }

        .modal-close:hover {
            color: var(--light);
            transform: rotate(90deg);
        }

        /* ===== NOTIFICATIONS ===== */
        .notification-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 10000;
        }

        .notification {
            background: var(--card-bg);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            padding: 15px 20px;
            margin-bottom: 10px;
            backdrop-filter: blur(20px);
            animation: slideInRight 0.3s ease, fadeOut 0.3s ease 4.7s forwards;
            display: flex;
            align-items: center;
            gap: 12px;
            min-width: 300px;
            box-shadow: var(--shadow);
        }

        .notification.success {
            border-left: 4px solid var(--success);
        }

        .notification.error {
            border-left: 4px solid var(--danger);
        }

        .notification.info {
            border-left: 4px solid var(--primary);
        }

        .notification-icon {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            color: white;
        }

        .notification.success .notification-icon {
            background: var(--success);
        }

        .notification.error .notification-icon {
            background: var(--danger);
        }

        .notification.info .notification-icon {
            background: var(--primary);
        }

        .notification-close {
            background: none;
            border: none;
            color: var(--gray);
            cursor: pointer;
            padding: 5px;
            border-radius: 4px;
            transition: var(--transition);
        }

        .notification-close:hover {
            background: rgba(255, 255, 255, 0.1);
            color: var(--light);
        }

        @keyframes slideInRight {
            from { opacity: 0; transform: translateX(100%); }
            to { opacity: 1; transform: translateX(0); }
        }

        @keyframes fadeOut {
            from { opacity: 1; transform: translateX(0); }
            to { opacity: 0; transform: translateX(100%); }
        }

        /* ===== UTILITY CLASSES ===== */
        .selected-month-info {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 15px 20px;
            margin-bottom: 20px;
            border: 1px solid var(--glass-border);
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.9rem;
            box-shadow: var(--shadow);
        }

        .empty-state {
            grid-column: 1 / -1;
            padding: 40px 20px;
            text-align: center;
            color: var(--gray);
        }

        .empty-state i {
            font-size: 3rem;
            margin-bottom: 15px;
            opacity: 0.5;
        }

        .empty-state h3 {
            margin-bottom: 10px;
            color: var(--light);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        /* ===== NOVOS ESTILOS PARA AS MODIFICA√á√ïES ===== */

        /* Estilos para o modal de configura√ß√µes */
        .settings-modal .modal-content {
            max-width: 600px;
        }

        .settings-section {
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--glass-border);
        }

        .settings-section:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }

        .settings-section-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 15px;
            color: var(--light);
        }

        .avatar-upload {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 20px;
        }

        .avatar-preview {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--success));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
            font-weight: bold;
            border: 3px solid var(--glass-border);
        }

        .avatar-actions {
            flex: 1;
        }

        .avatar-actions .btn {
            margin-bottom: 10px;
        }

        /* Estilos melhorados para o modal de relat√≥rios */
        .report-period-options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .report-period-option {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--glass-border);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
        }

        .report-period-option:hover {
            background: rgba(255, 255, 255, 0.08);
            border-color: var(--primary);
        }

        .report-period-option.active {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            border-color: var(--primary);
        }

        .report-period-option i {
            font-size: 1.5rem;
            margin-bottom: 8px;
            display: block;
        }

        .date-range-inputs {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .report-summary {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            border: 1px solid var(--glass-border);
        }

        .report-summary-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .report-summary-item:last-child {
            border-bottom: none;
        }

        .report-summary-label {
            color: var(--gray);
            font-weight: 500;
        }

        .report-summary-value {
            font-weight: 600;
        }

        .report-summary-value.positive {
            color: var(--success);
        }

        .report-summary-value.negative {
            color: var(--danger);
        }

        /* Estilos para transa√ß√µes por categoria */
        .category-transactions-modal .modal-content {
            max-width: 600px;
        }

        .category-transaction-item {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 10px;
            border: 1px solid var(--glass-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .category-transaction-info {
            flex: 1;
        }

        .category-transaction-description {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .category-transaction-date {
            font-size: 0.8rem;
            color: var(--gray);
        }

        .category-transaction-amount {
            font-weight: 700;
            margin-right: 15px;
        }

        .category-transaction-amount.revenue {
            color: var(--success);
        }

        .category-transaction-amount.essential {
            color: var(--primary);
        }

        .category-transaction-amount.non-essential {
            color: var(--secondary);
        }

        .category-transaction-amount.economy {
            color: var(--economy);
        }

        .category-transaction-actions {
            display: flex;
            gap: 8px;
        }

        /* Loading spinner */
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: var(--primary);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Skeleton Loading */
        .skeleton-loading {
            background: linear-gradient(90deg, rgba(255,255,255,0.1) 25%, rgba(255,255,255,0.2) 50%, rgba(255,255,255,0.1) 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
            border-radius: 8px;
        }

        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        .skeleton-card {
            height: 120px;
            margin-bottom: 15px;
        }

        .skeleton-text {
            height: 16px;
            margin-bottom: 8px;
        }

        .skeleton-text.short {
            width: 60%;
        }

        /* Confirmation Modal Styles */
        .confirmation-modal .modal-content {
            max-width: 400px;
            text-align: center;
        }

        .confirmation-icon {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            margin: 0 auto 20px;
        }

        .confirmation-icon.warning {
            background: rgba(245, 158, 11, 0.2);
            color: var(--warning);
        }

        .confirmation-icon.danger {
            background: rgba(239, 68, 68, 0.2);
            color: var(--danger);
        }

        .confirmation-icon.success {
            background: rgba(16, 185, 129, 0.2);
            color: var(--success);
        }

        .confirmation-message {
            margin-bottom: 25px;
            line-height: 1.6;
        }

        .confirmation-actions {
            display: flex;
            gap: 12px;
            justify-content: center;
        }

        /* ===== NOVOS ESTILOS PARA INVESTIMENTOS ===== */
        .investment-type-select {
            background: var(--dark);
            border: 1px solid var(--glass-border);
            color: var(--light);
            border-radius: 10px;
            padding: 12px 15px;
            font-size: 0.9rem;
            width: 100%;
            cursor: pointer;
            transition: var(--transition);
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%23f8fafc'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 16px;
        }

        .investment-type-select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.2);
        }

        .investment-type-option {
            padding: 10px 15px;
            background: var(--dark);
            color: var(--light);
            border-bottom: 1px solid var(--glass-border);
        }

        .investment-type-option:hover {
            background: var(--primary);
        }

        /* ===== LEMBRETES ===== */
        .reminders-section {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 25px;
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            margin-bottom: 25px;
            box-shadow: var(--shadow);
        }

        .reminder-item {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            border: 1px solid var(--glass-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: var(--transition);
        }

        .reminder-item:hover {
            transform: translateY(-2px);
            border-color: var(--primary);
        }

        .reminder-item.overdue {
            border-left: 4px solid var(--danger);
        }

        .reminder-item.upcoming {
            border-left: 4px solid var(--warning);
        }

        .reminder-item.paid {
            border-left: 4px solid var(--success);
            opacity: 0.7;
        }

        .reminder-info {
            flex: 1;
        }

        .reminder-title {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .reminder-date {
            font-size: 0.8rem;
            color: var(--gray);
        }

        .reminder-amount {
            font-weight: 700;
            margin-right: 15px;
        }

        .reminder-actions {
            display: flex;
            gap: 8px;
        }

        /* ===== CATEGORIAS PERSONALIZADAS ===== */
        .categories-section {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 25px;
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            margin-bottom: 25px;
            box-shadow: var(--shadow);
        }

        .categories-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .category-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            border: 1px solid var(--glass-border);
            transition: var(--transition);
            cursor: pointer;
        }

        .category-card:hover {
            transform: translateY(-3px);
            border-color: var(--primary);
        }

        .category-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 10px;
            font-size: 1.3rem;
        }

        .category-name {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .category-amount {
            font-size: 0.9rem;
            color: var(--gray);
        }

        /* ===== RESPONSIVE DESIGN ===== */
        /* Desktop */
        @media (min-width: 1025px) {
            .mobile-bottom-nav {
                display: none !important;
            }
            
            .sidebar {
                display: flex !important;
            }
        }

        /* Tablets */
        @media (max-width: 1024px) and (min-width: 769px) {
            .dashboard-grid {
                grid-template-columns: repeat(2, 1fr) !important;
            }
            
            .investment-cards {
                grid-template-columns: repeat(2, 1fr) !important;
            }
            
            .charts-grid {
                grid-template-columns: 1fr !important;
            }
            
            .transactions-container {
                grid-template-columns: repeat(2, 1fr) !important;
            }
            
            .transaction-list {
                grid-template-columns: 1fr !important;
            }
            
            .portfolio-grid {
                grid-template-columns: 1fr !important;
            }
        }

        /* Mobile Devices */
        @media (max-width: 768px) {
            .app-container {
                flex-direction: column;
            }
            
            .sidebar {
                display: none !important;
            }
            
            .main-content {
                padding: 20px 15px;
                padding-bottom: 90px;
                margin-left: 0 !important;
                width: 100% !important;
            }
            
            .mobile-bottom-nav {
                display: block;
            }
            
            /* Dashboard Grid Mobile */
            .dashboard-grid {
                grid-template-columns: 1fr !important;
                gap: 15px !important;
            }
            
            .stat-card {
                padding: 20px !important;
                margin: 0 !important;
            }
            
            .stat-value {
                font-size: 1.8rem !important;
            }
            
            /* Investment Cards Mobile */
            .investment-cards {
                grid-template-columns: 1fr !important;
                gap: 15px !important;
            }
            
            .investment-card {
                padding: 25px 20px !important;
                text-align: center !important;
            }
            
            .investment-icon {
                width: 70px !important;
                height: 70px !important;
                margin: 0 auto 15px !important;
            }
            
            /* Charts Mobile */
            .charts-grid {
                grid-template-columns: 1fr !important;
                gap: 15px !important;
            }
            
            .chart-container {
                height: 280px !important;
            }
            
            .chart-card {
                padding: 20px !important;
            }
            
            /* Header Mobile */
            .header {
                flex-direction: column;
                gap: 15px;
                align-items: stretch !important;
                margin-bottom: 20px !important;
            }
            
            .header-title {
                font-size: 1.6rem !important;
                text-align: center;
            }
            
            .header-actions {
                justify-content: center !important;
            }
            
            .date-filter-container {
                justify-content: center !important;
                padding: 15px !important;
                width: 100% !important;
            }
            
            /* Transactions Mobile */
            .transactions-container {
                grid-template-columns: 1fr !important;
                gap: 15px !important;
            }
            
            .transaction-form-card {
                padding: 20px !important;
            }
            
            /* Simulator Mobile */
            .simulator-container {
                grid-template-columns: 1fr !important;
                gap: 20px !important;
            }
            
            .simulator-section {
                padding: 20px !important;
            }
            
            /* Form Rows Mobile */
            .form-row {
                grid-template-columns: 1fr !important;
                gap: 15px !important;
            }
            
            /* Transaction List Mobile */
            .transaction-list {
                grid-template-columns: 1fr !important;
                gap: 12px !important;
            }
            
            .transaction-item {
                padding: 15px !important;
            }
            
            .transaction-actions {
                flex-direction: column !important;
                gap: 8px !important;
            }
            
            .transaction-actions .btn {
                width: 100% !important;
                justify-content: center !important;
            }
            
            /* Goals Grid Mobile */
            .goals-grid {
                grid-template-columns: 1fr !important;
                gap: 15px !important;
            }
            
            .goal-card {
                padding: 20px !important;
            }
            
            .goal-actions {
                flex-direction: column !important;
            }
            
            .goal-actions .btn {
                width: 100% !important;
                justify-content: center !important;
            }
            
            /* Portfolio Mobile */
            .portfolio-grid {
                grid-template-columns: 1fr !important;
                gap: 20px !important;
            }
            
            .portfolio-stats {
                grid-template-columns: 1fr !important;
                gap: 15px !important;
            }
            
            .portfolio-item {
                padding: 15px !important;
            }
            
            .portfolio-item-content {
                flex-direction: column !important;
                gap: 10px !important;
            }
            
            .portfolio-item-info {
                text-align: center !important;
            }
            
            .portfolio-item-actions {
                flex-direction: row !important;
                justify-content: center !important;
                width: 100% !important;
            }
            
            .portfolio-summary {
                padding: 20px !important;
            }
            
            .portfolio-chart-container {
                height: 250px !important;
            }

            /* Indicadores de Mercado Mobile */
            .indicators-grid {
                grid-template-columns: repeat(2, 1fr) !important;
                gap: 12px !important;
            }
            
            .indicator-card {
                padding: 15px !important;
                text-align: center !important;
            }
            
            .indicator-header {
                flex-direction: column !important;
                gap: 8px !important;
                margin-bottom: 10px !important;
            }
            
            .indicator-value {
                font-size: 1.3rem !important;
            }

            /* Report Period Options Mobile */
            .report-period-options {
                grid-template-columns: 1fr !important;
            }

            .date-range-inputs {
                grid-template-columns: 1fr !important;
            }
        }

        /* Small Mobile Devices */
        @media (max-width: 480px) {
            .main-content {
                padding: 15px 12px;
                padding-bottom: 85px;
            }
            
            .stat-card {
                padding: 18px !important;
            }
            
            .investment-card {
                padding: 20px 15px !important;
            }
            
            .chart-card {
                padding: 18px !important;
            }
            
            .mobile-nav-item {
                padding: 6px 8px;
                font-size: 0.7rem;
                min-width: 65px;
            }
            
            .mobile-nav-item i {
                font-size: 1.2rem;
            }
            
            .header-title {
                font-size: 1.4rem !important;
            }
            
            .date-filter-container {
                padding: 10px 15px !important;
            }
            
            .date-select {
                font-size: 0.85rem !important;
                padding: 4px 8px !important;
            }
            
            .transaction-item {
                padding: 12px !important;
            }
            
            .goal-card {
                padding: 15px !important;
            }
            
            .portfolio-item {
                padding: 12px !important;
            }
            
            .portfolio-summary {
                padding: 15px !important;
            }

            /* Indicadores Mobile Pequeno */
            .indicators-grid {
                grid-template-columns: 1fr !important;
                gap: 10px !important;
            }
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div id="loginScreen" class="login-container">
        <div class="login-card">
            <div class="login-logo">
                <i class="fas fa-brain-circuit"></i>
                <span>NexusFinance</span>
            </div>
            
            <div class="auth-tabs">
                <div class="auth-tab active" onclick="switchAuthTab('login', event)">Entrar</div>
                <div class="auth-tab" onclick="switchAuthTab('register', event)">Cadastrar</div>
            </div>

            <!-- Login Form -->
            <div id="loginForm" class="auth-form active">
                <h2 class="login-title">Bem-vindo de volta</h2>
                <p class="login-subtitle">Fa√ßa login para acessar seu dashboard</p>
                
                <form class="login-form" onsubmit="handleLogin(event)">
                    <div class="form-group">
                        <label class="form-label">E-mail</label>
                        <input type="email" class="form-input" id="loginEmail" placeholder="seu@email.com" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Senha</label>
                        <input type="password" class="form-input" id="loginPassword" placeholder="Sua senha" required>
                    </div>
                    
                    <button type="submit" class="login-btn">
                        <i class="fas fa-sign-in-alt"></i> Entrar
                    </button>
                </form>
            </div>

            <!-- Register Form -->
            <div id="registerForm" class="auth-form">
                <h2 class="login-title">Criar conta</h2>
                <p class="login-subtitle">Cadastre-se para come√ßar a usar o NexusFinance</p>
                
                <form class="login-form" onsubmit="handleRegister(event)">
                    <div class="form-group">
                        <label class="form-label">Nome completo</label>
                        <input type="text" class="form-input" id="registerName" placeholder="Seu nome completo" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">E-mail</label>
                        <input type="email" class="form-input" id="registerEmail" placeholder="seu@email.com" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Senha</label>
                        <input type="password" class="form-input" id="registerPassword" placeholder="M√≠nimo 6 caracteres" minlength="6" required>
                    </div>
                    
                    <button type="submit" class="login-btn">
                        <i class="fas fa-user-plus"></i> Criar conta
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Main App -->
    <div id="appContainer" class="app-container" style="display: none;">
        <!-- Sidebar (Desktop) - MELHORADO -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <i class="fas fa-brain-circuit"></i>
                    <span>NexusFinance</span>
                </div>
            </div>
            
            <div class="nav-menu">
                <div class="nav-item active" onclick="switchTab('dashboard')">
                    <i class="fas fa-chart-pie"></i>
                    <span>Dashboard</span>
                </div>
                <div class="nav-item" onclick="switchTab('transactions')">
                    <i class="fas fa-exchange-alt"></i>
                    <span>Transa√ß√µes</span>
                </div>
                <div class="nav-item" onclick="switchTab('goals')">
                    <i class="fas fa-bullseye"></i>
                    <span>Metas</span>
                </div>
                <div class="nav-item" onclick="switchTab('investments')">
                    <i class="fas fa-chart-line"></i>
                    <span>Investimentos</span>
                </div>
                <div class="nav-item" onclick="showSettingsModal()">
                    <i class="fas fa-cog"></i>
                    <span>Configura√ß√µes</span>
                </div>
            </div>
            
            <div class="sidebar-footer">
                <div class="user-card" onclick="showSettingsModal()">
                    <div class="user-avatar" id="userAvatar">U</div>
                    <div class="user-info">
                        <div class="user-name" id="userName">Usu√°rio</div>
                    </div>
                    <button class="logout-btn" onclick="showConfirmationModal('logout')">
                        <i class="fas fa-sign-out-alt"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content" id="mainContent">
            <!-- Header -->
            <div class="header">
                <h1 class="header-title" id="pageTitle">Dashboard Financeiro</h1>
                <div class="header-actions">
                    <button class="theme-toggle" id="themeToggle" onclick="toggleTheme()">
                        <i class="fas fa-moon"></i>
                    </button>
                    <div class="date-filter-container">
                        <i class="fas fa-calendar-alt"></i>
                        <select id="monthSelect" class="date-select" onchange="handleDateChange(); updateDashboardStats(); loadTransactions();">
                            <option value="0">Janeiro</option>
                            <option value="1">Fevereiro</option>
                            <option value="2">Mar√ßo</option>
                            <option value="3">Abril</option>
                            <option value="4">Maio</option>
                            <option value="5">Junho</option>
                            <option value="6">Julho</option>
                            <option value="7">Agosto</option>
                            <option value="8">Setembro</option>
                            <option value="9">Outubro</option>
                            <option value="10">Novembro</option>
                            <option value="11">Dezembro</option>
                        </select>
                        <select id="yearSelect" class="date-select" onchange="handleDateChange(); loadTransactions();">
                            <option value="2024" selected>2024</option>
                            <option value="2025">2025</option>
                            <option value="2026">2026</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Dashboard Tab -->
            <div id="dashboard" class="tab-content active">
                <!-- Stats Cards -->
                <div class="dashboard-grid">
                    <div class="stat-card revenue" onclick="showCategoryTransactions('revenue')">
                        <div class="stat-header">
                            <div class="stat-title">Receita Total</div>
                            <div class="stat-icon">
                                <i class="fas fa-money-bill-wave"></i>
                            </div>
                        </div>
                        <div class="stat-value" id="revenueAmount">R$ 0,00</div>
                        <div class="stat-change positive">
                            <i class="fas fa-arrow-up"></i>
                            <span id="revenueChange">+0% vs √∫ltimo m√™s</span>
                        </div>
                    </div>
                    
                    <div class="stat-card essential" onclick="showCategoryTransactions('essential')">
                        <div class="stat-header">
                            <div class="stat-title">Gastos Essenciais</div>
                            <div class="stat-icon">
                                <i class="fas fa-home"></i>
                            </div>
                        </div>
                        <div class="stat-value" id="essentialAmount">R$ 0,00</div>
                        <div class="stat-change negative">
                            <i class="fas fa-arrow-down"></i>
                            <span id="essentialChange">+0% vs √∫ltimo m√™s</span>
                        </div>
                    </div>
                    
                    <div class="stat-card non-essential" onclick="showCategoryTransactions('non-essential')">
                        <div class="stat-header">
                            <div class="stat-title">Gastos N√£o Essenciais</div>
                            <div class="stat-icon">
                                <i class="fas fa-gamepad"></i>
                            </div>
                        </div>
                        <div class="stat-value" id="nonEssentialAmount">R$ 0,00</div>
                        <div class="stat-change positive">
                            <i class="fas fa-arrow-up"></i>
                            <span id="nonEssentialChange">+0% vs √∫ltimo m√™s</span>
                        </div>
                    </div>
                    
                    <div class="stat-card economy" onclick="showCategoryTransactions('economy')">
                        <div class="stat-header">
                            <div class="stat-title">Economia</div>
                            <div class="stat-icon">
                                <i class="fas fa-piggy-bank"></i>
                            </div>
                        </div>
                        <div class="stat-value" id="economyAmount">R$ 0,00</div>
                        <div class="stat-change positive">
                            <i class="fas fa-arrow-up"></i>
                            <span id="economyChange">+0% vs √∫ltimo m√™s</span>
                        </div>
                    </div>
                </div>

                <!-- Charts Section - MODIFICADO -->
                <div class="charts-grid">
                    <div class="chart-section">
                        <div class="chart-card">
                            <div class="chart-header">
                                <h3 class="chart-title">Distribui√ß√£o de Gastos</h3>
                            </div>
                            <div class="chart-container">
                                <canvas id="expenseDistributionChart"></canvas>
                            </div>
                        </div>
                    </div>
                    
                    <div class="chart-section">
                        <div class="chart-card">
                            <div class="chart-header">
                                <h3 class="chart-title">Economia Mensal</h3>
                            </div>
                            <div class="chart-container">
                                <canvas id="monthlyEconomyChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="investment-cards">
                    <div class="investment-card" onclick="showSimulator('juros-compostos')">
                        <div class="investment-icon">
                            <i class="fas fa-calculator"></i>
                        </div>
                        <div class="investment-title">Simulador</div>
                        <div class="investment-description">Calcule proje√ß√µes de investimentos e planeje seu futuro</div>
                    </div>
                    
                    <div class="investment-card" onclick="switchTab('investments')">
                        <div class="investment-icon">
                            <i class="fas fa-plus-circle"></i>
                        </div>
                        <div class="investment-title">Lan√ßar Investimento</div>
                        <div class="investment-description">Adicione novos investimentos ao seu portf√≥lio</div>
                    </div>
                    
                    <div class="investment-card" onclick="switchTab('goals')">
                        <div class="investment-icon">
                            <i class="fas fa-bullseye"></i>
                        </div>
                        <div class="investment-title">Metas</div>
                        <div class="investment-description">Defina e acompanhe suas metas financeiras</div>
                    </div>
                    
                    <div class="investment-card" onclick="showReportModal()">
                        <div class="investment-icon">
                            <i class="fas fa-file-pdf"></i>
                        </div>
                        <div class="investment-title">Relat√≥rios</div>
                        <div class="investment-description">Gerar relat√≥rios detalhados dos seus investimentos</div>
                    </div>
                </div>

                <!-- Lembretes Section -->
                <div class="reminders-section">
                    <div class="section-header">
                        <h2 class="section-title">Lembretes de Pagamento</h2>
                        <button class="btn" onclick="showAddReminderModal()">
                            <i class="fas fa-plus"></i> Novo Lembrete
                        </button>
                    </div>
                    <div class="reminders-list" id="remindersList">
                        <!-- Lembretes ser√£o preenchidos aqui -->
                    </div>
                </div>

                <!-- Categorias Personalizadas -->
                <div class="categories-section">
                    <div class="section-header">
                        <h2 class="section-title">Categorias Personalizadas</h2>
                        <button class="btn" onclick="showAddCategoryModal()">
                            <i class="fas fa-plus"></i> Nova Categoria
                        </button>
                    </div>
                    <div class="categories-grid" id="categoriesGrid">
                        <!-- Categorias ser√£o preenchidas aqui -->
                    </div>
                </div>
            </div>

            <!-- Transactions Tab -->
            <div id="transactions" class="tab-content">
                <div class="selected-month-info">
                    <i class="fas fa-info-circle"></i>
                    Transa√ß√µes ser√£o registradas para: <strong id="selectedMonthDisplay"></strong>
                </div>
                
                <div class="transactions-container">
                    <!-- Revenue Form -->
                    <div class="transaction-form-card revenue-form">
                        <div class="form-header-icon">
                            <i class="fas fa-arrow-down"></i>
                        </div>
                        <h3 class="form-title">Adicionar Receita</h3>
                        <p class="form-subtitle">Registre suas entradas de dinheiro</p>
                        
                        <div class="form-group">
                            <label class="form-label">Descri√ß√£o</label>
                            <input type="text" class="form-input" id="revenueDescription" placeholder="Ex: Sal√°rio, Freelance, Investimento...">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Valor (R$)</label>
                            <input type="number" class="form-input" id="revenueAmountInput" placeholder="0,00" step="0.01" min="0">
                        </div>

                        <div class="form-group">
                            <label class="form-label">Categoria</label>
                            <select class="form-input" id="revenueCategory">
    <!-- Op√ß√µes padr√£o -->
    <option value="salario">Sal√°rio</option>
    <option value="freelance">Freelance</option>
    <option value="investimentos">Investimentos</option>
    <option value="outros">Outros</option>
    <!-- Categorias personalizadas ser√£o adicionadas aqui -->
</select>
                        </div>
                        
                        <div class="form-actions">
                            <button class="btn btn-success" onclick="addTransaction('revenue')">
                                <i class="fas fa-plus"></i> Adicionar Receita
                            </button>
                        </div>
                    </div>

                    <!-- Essential Expense Form -->
                    <div class="transaction-form-card essential-form">
                        <div class="form-header-icon">
                            <i class="fas fa-home"></i>
                        </div>
                        <h3 class="form-title">Despesas Essenciais</h3>
                        <p class="form-subtitle">Gastos fixos e necess√°rios</p>
                        
                        <div class="form-group">
                            <label class="form-label">Descri√ß√£o</label>
                            <input type="text" class="form-input" id="essentialDescription" placeholder="Ex: Aluguel, Mercado, Transporte...">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Valor (R$)</label>
                            <input type="number" class="form-input" id="essentialAmountInput" placeholder="0,00" step="0.01" min="0">
                        </div>

                        <div class="form-group">
                            <label class="form-label">Categoria</label>
                            <select class="form-input" id="essentialCategory">
                                <option value="moradia">Moradia</option>
                                <option value="alimentacao">Alimenta√ß√£o</option>
                                <option value="transporte">Transporte</option>
                                <option value="saude">Sa√∫de</option>
                                <option value="educacao">Educa√ß√£o</option>
                            </select>
                        </div>
                        
                        <div class="form-actions">
                            <button class="btn" onclick="addTransaction('essential')">
                                <i class="fas fa-plus"></i> Adicionar Despesa
                            </button>
                        </div>
                    </div>

                    <!-- Non-Essential Expense Form -->
                    <div class="transaction-form-card non-essential-form">
                        <div class="form-header-icon">
                            <i class="fas fa-gamepad"></i>
                        </div>
                        <h3 class="form-title">Despesas N√£o Essenciais</h3>
                        <p class="form-subtitle">Gastos vari√°veis e opcionais</p>
                        
                        <div class="form-group">
                            <label class="form-label">Descri√ß√£o</label>
                            <input type="text" class="form-input" id="nonEssentialDescription" placeholder="Ex: Restaurante, Cinema, Compras...">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Valor (R$)</label>
                            <input type="number" class="form-input" id="nonEssentialAmountInput" placeholder="0,00" step="0.01" min="0">
                        </div>

                        <div class="form-group">
                            <label class="form-label">Categoria</label>
                            <select class="form-input" id="nonEssentialCategory">
                                <option value="lazer">Lazer</option>
                                <option value="compras">Compras</option>
                                <option value="viagens">Viagens</option>
                                <option value="restaurante">Restaurante</option>
                            </select>
                        </div>
                        
                        <div class="form-actions">
                            <button class="btn" onclick="addTransaction('non-essential')">
                                <i class="fas fa-plus"></i> Adicionar Despesa
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Transaction List -->
                <div class="transaction-list-section">
                    <div class="section-header">
                        <h2 class="section-title">Transa√ß√µes do M√™s</h2>
                        <button class="btn btn-outline" onclick="loadTransactions()">
                            <i class="fas fa-sync-alt"></i> Atualizar
                        </button>
                    </div>
                    <div class="transaction-list" id="transactionList">
                        <!-- Transactions will be populated here -->
                    </div>
                </div>
            </div>

            <!-- Goals Tab - CORRIGIDA -->
            <div id="goals" class="tab-content">
                <div class="simulator-section">
                    <div class="section-header">
                        <h2 class="section-title">Metas Financeiras</h2>
                        <button class="btn" onclick="showAddGoalModal()">
                            <i class="fas fa-plus"></i> Nova Meta
                        </button>
                    </div>
                    
                    <!-- Indicadores de Progresso -->
                    <div class="indicators-grid">
                        <div class="indicator-card">
                            <div class="indicator-header">
                                <div class="indicator-title">Metas Ativas</div>
                                <div class="indicator-icon">
                                    <i class="fas fa-bullseye"></i>
                                </div>
                            </div>
                            <div class="indicator-value" id="activeGoalsCount">0</div>
                            <div class="indicator-change positive">
                                <i class="fas fa-arrow-up"></i>
                                <span>Total de metas</span>
                            </div>
                        </div>
                        
                        <div class="indicator-card">
                            <div class="indicator-header">
                                <div class="indicator-title">Conclu√≠das</div>
                                <div class="indicator-icon">
                                    <i class="fas fa-check-circle"></i>
                                </div>
                            </div>
                            <div class="indicator-value" id="completedGoalsCount">0</div>
                            <div class="indicator-change positive">
                                <i class="fas fa-check"></i>
                                <span>Metas finalizadas</span>
                            </div>
                        </div>
                        
                        <div class="indicator-card">
                            <div class="indicator-header">
                                <div class="indicator-title">Progresso M√©dio</div>
                                <div class="indicator-icon">
                                    <i class="fas fa-chart-line"></i>
                                </div>
                            </div>
                            <div class="indicator-value" id="averageProgress">0%</div>
                            <div class="indicator-change positive">
                                <i class="fas fa-trend-up"></i>
                                <span>Das metas ativas</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="goals-grid" id="goalsList">
                        <!-- Goals will be populated here -->
                    </div>
                </div>
            </div>

            <!-- Investments Tab - CORRIGIDA -->
            <div id="investments" class="tab-content">
                <div class="investment-dashboard">
                    <!-- Investment Cards -->
                    <div class="investment-cards">
                        <div class="investment-card" onclick="showSimulator('juros-compostos')">
                            <div class="investment-icon">
                                <i class="fas fa-chart-line"></i>
                            </div>
                            <div class="investment-title">Juros Compostos</div>
                            <div class="investment-description">Simule o poder dos juros compostos no longo prazo</div>
                        </div>
                        
                        <div class="investment-card" onclick="showAddInvestmentModal()">
                            <div class="investment-icon">
                                <i class="fas fa-plus-circle"></i>
                            </div>
                            <div class="investment-title">Lan√ßar Investimento</div>
                            <div class="investment-description">Adicione novos investimentos ao seu portf√≥lio</div>
                        </div>
                        
                        <div class="investment-card" onclick="showReportModal()">
                            <div class="investment-icon">
                                <i class="fas fa-file-pdf"></i>
                            </div>
                            <div class="investment-title">Relat√≥rios</div>
                            <div class="investment-description">Gerar relat√≥rios detalhados dos seus investimentos</div>
                        </div>
                        
                        <div class="investment-card" onclick="switchTab('goals')">
                            <div class="investment-icon">
                                <i class="fas fa-bullseye"></i>
                            </div>
                            <div class="investment-title">Metas</div>
                            <div class="investment-description">Acompanhe suas metas de investimento</div>
                        </div>
                    </div>

                    <!-- Market Indicators - CORRIGIDO -->
                    <div class="simulator-section">
                        <div class="section-header">
                            <h2 class="section-title">Indicadores de Mercado</h2>
                            <button class="btn btn-outline" onclick="refreshIndicators()">
                                <i class="fas fa-sync-alt"></i> Atualizar
                            </button>
                        </div>
                        <div class="indicators-grid" id="marketIndicators">
                            <!-- Indicators will be populated by JavaScript -->
                        </div>
                    </div>

                    <!-- Juros Compostos Simulator -->
                    <div class="simulator-section" id="juros-compostos-simulator">
                        <div class="section-header">
                            <h2 class="section-title">Simulador de Juros Compostos</h2>
                        </div>
                        <div class="simulator-container">
                            <div class="simulator-form">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label class="form-label">Valor Inicial (R$)</label>
                                        <input type="number" class="form-input" id="initialAmount" value="1000" min="0">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Aporte Mensal (R$)</label>
                                        <input type="number" class="form-input" id="monthlyInvestment" value="500" min="0">
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label class="form-label">Taxa Anual (%)</label>
                                        <input type="number" class="form-input" id="annualRate" value="8" step="0.1" min="0">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Per√≠odo (anos)</label>
                                        <input type="number" class="form-input" id="investmentPeriod" value="10" min="1" max="50">
                                    </div>
                                </div>
                                <div class="form-actions">
                                    <button class="btn btn-success" onclick="calculateCompoundInterest()">
                                        <i class="fas fa-calculator"></i> Calcular
                                    </button>
                                </div>
                            </div>
                            <div class="simulator-results">
                                <div class="result-item">
                                    <span class="result-label">Total Investido</span>
                                    <span class="result-value" id="totalInvested">R$ 0,00</span>
                                </div>
                                <div class="result-item">
                                    <span class="result-label">Juros Acumulados</span>
                                    <span class="result-value positive" id="totalInterest">R$ 0,00</span>
                                </div>
                                <div class="result-item">
                                    <span class="result-label">Valor Final</span>
                                    <span class="result-value positive" id="finalAmount">R$ 0,00</span>
                                </div>
                                <div class="result-item">
                                    <span class="result-label">Rentabilidade</span>
                                    <span class="result-value positive" id="profitability">0%</span>
                                </div>
                            </div>
                        </div>
                        <div class="chart-container">
                            <canvas id="compoundInterestChart"></canvas>
                        </div>
                    </div>

                    <!-- Portfolio Section - CORRIGIDA -->
                    <div class="portfolio-section">
                        <div class="section-header">
                            <h2 class="section-title">Meu Portf√≥lio de Investimentos</h2>
                            <div class="header-actions">
                                <button class="btn btn-outline" onclick="refreshPortfolio()">
                                    <i class="fas fa-sync-alt"></i> Atualizar
                                </button>
                                <button class="btn" onclick="showAddInvestmentModal()">
                                    <i class="fas fa-plus"></i> Novo Investimento
                                </button>
                            </div>
                        </div>

                        <!-- Portfolio Stats -->
                        <div class="portfolio-stats">
                            <div class="portfolio-stat-card">
                                <div class="portfolio-stat-value" id="portfolioTotal">R$ 0,00</div>
                                <div class="portfolio-stat-label">Valor Total</div>
                                <div class="portfolio-stat-change positive">
                                    <i class="fas fa-arrow-up"></i> Carregando...
                                </div>
                            </div>
                            <div class="portfolio-stat-card">
                                <div class="portfolio-stat-value" id="portfolioReturn">+0%</div>
                                <div class="portfolio-stat-label">Rentabilidade</div>
                                <div class="portfolio-stat-change positive">
                                    <i class="fas fa-arrow-up"></i> Carregando...
                                </div>
                            </div>
                            <div class="portfolio-stat-card">
                                <div class="portfolio-stat-value" id="portfolioDividends">R$ 0,00</div>
                                <div class="portfolio-stat-label">Dividendos</div>
                                <div class="portfolio-stat-change positive">
                                    <i class="fas fa-arrow-up"></i> Carregando...
                                </div>
                            </div>
                        </div>

                        <div class="portfolio-grid">
                            <!-- Portfolio List -->
                            <div class="portfolio-list" id="investmentPortfolio">
                                <!-- Portfolio items will be populated by JavaScript -->
                            </div>

                            <!-- Portfolio Chart -->
                            <div class="portfolio-summary">
                                <h3 class="chart-title">Distribui√ß√£o do Portf√≥lio</h3>
                                <div class="portfolio-chart-container">
                                    <canvas id="portfolioChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Mobile Bottom Navigation -->
        <div class="mobile-bottom-nav">
            <div class="mobile-nav-items">
                <div class="mobile-nav-item active" onclick="switchTab('dashboard')">
                    <i class="fas fa-chart-pie"></i>
                    <span>Dashboard</span>
                </div>
                <div class="mobile-nav-item" onclick="switchTab('transactions')">
                    <i class="fas fa-exchange-alt"></i>
                    <span>Transa√ß√µes</span>
                </div>
                <div class="mobile-nav-item" onclick="switchTab('goals')">
                    <i class="fas fa-bullseye"></i>
                    <span>Metas</span>
                </div>
                <div class="mobile-nav-item" onclick="switchTab('investments')">
                    <i class="fas fa-chart-line"></i>
                    <span>Investimentos</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <!-- Add Goal Modal -->
    <div id="addGoalModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Nova Meta Financeira</h3>
                <button class="modal-close" onclick="closeAddGoalModal()">&times;</button>
            </div>
            <div class="form-group">
                <label class="form-label">Nome da Meta</label>
                <input type="text" class="form-input" id="goalName" placeholder="Ex: Reserva de Emerg√™ncia">
            </div>
            <div class="form-group">
                <label class="form-label">Descri√ß√£o</label>
                <textarea class="form-input" id="goalDescription" placeholder="Descreva sua meta..." rows="3"></textarea>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">Valor Atual (R$)</label>
                    <input type="number" class="form-input" id="goalCurrentAmount" step="0.01" min="0" value="0">
                </div>
                <div class="form-group">
                    <label class="form-label">Valor da Meta (R$)</label>
                    <input type="number" class="form-input" id="goalTargetAmount" step="0.01" min="0">
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">Tempo para alcan√ßar (meses)</label>
                    <input type="number" class="form-input" id="goalTimeframe" min="1" max="120" value="12">
                </div>
            </div>
            <div class="form-actions">
                <button class="btn btn-outline" onclick="closeAddGoalModal()">Cancelar</button>
                <button class="btn btn-success" onclick="addGoal()">
                    <i class="fas fa-plus"></i> Adicionar Meta
                </button>
            </div>
        </div>
    </div>

    <!-- Edit Goal Modal -->
    <div id="editGoalModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Editar Meta Financeira</h3>
                <button class="modal-close" onclick="closeEditGoalModal()">&times;</button>
            </div>
            <input type="hidden" id="editGoalId">
            <div class="form-group">
                <label class="form-label">Nome da Meta</label>
                <input type="text" class="form-input" id="editGoalName" placeholder="Ex: Reserva de Emerg√™ncia">
            </div>
            <div class="form-group">
                <label class="form-label">Descri√ß√£o</label>
                <textarea class="form-input" id="editGoalDescription" placeholder="Descreva sua meta..." rows="3"></textarea>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">Valor Atual (R$)</label>
                    <input type="number" class="form-input" id="editGoalCurrentAmount" step="0.01" min="0" value="0">
                </div>
                <div class="form-group">
                    <label class="form-label">Valor da Meta (R$)</label>
                    <input type="number" class="form-input" id="editGoalTargetAmount" step="0.01" min="0">
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">Tempo para alcan√ßar (meses)</label>
                    <input type="number" class="form-input" id="editGoalTimeframe" min="1" max="120" value="12">
                </div>
            </div>
            <div class="form-actions">
                <button class="btn btn-outline" onclick="closeEditGoalModal()">Cancelar</button>
                <button class="btn btn-warning" onclick="updateGoal()">
                    <i class="fas fa-save"></i> Atualizar Meta
                </button>
                <button class="btn btn-danger" onclick="showConfirmationModal('deleteGoal')">
                    <i class="fas fa-trash"></i> Excluir Meta
                </button>
            </div>
        </div>
    </div>

    <!-- Edit Transaction Modal -->
    <div id="editTransactionModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Editar Transa√ß√£o</h3>
                <button class="modal-close" onclick="closeEditTransactionModal()">&times;</button>
            </div>
            <input type="hidden" id="editTransactionId">
            <input type="hidden" id="editTransactionType">
            <div class="form-group">
                <label class="form-label">Descri√ß√£o</label>
                <input type="text" class="form-input" id="editTransactionDescription" placeholder="Descri√ß√£o da transa√ß√£o">
            </div>
            <div class="form-group">
                <label class="form-label">Valor (R$)</label>
                <input type="number" class="form-input" id="editTransactionAmount" step="0.01" min="0">
            </div>
            <div class="form-group">
                <label class="form-label">Tipo</label>
                <select class="form-input" id="editTransactionTypeSelect">
                    <option value="revenue">Receita</option>
                    <option value="essential">Despesa Essencial</option>
                    <option value="non-essential">Despesa N√£o Essencial</option>
                </select>
            </div>
            <div class="form-actions">
                <button class="btn btn-outline" onclick="closeEditTransactionModal()">Cancelar</button>
                <button class="btn btn-warning" onclick="updateTransaction()">
                    <i class="fas fa-save"></i> Atualizar
                </button>
                <button class="btn btn-danger" onclick="showConfirmationModal('deleteTransaction')">
                    <i class="fas fa-trash"></i> Excluir
                </button>
            </div>
        </div>
    </div>

    <!-- Add Investment Modal -->
    <div id="addInvestmentModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Novo Investimento</h3>
                <button class="modal-close" onclick="closeAddInvestmentModal()">&times;</button>
            </div>
            <div class="form-group">
                <label class="form-label">Nome do Investimento</label>
                <input type="text" class="form-input" id="investmentName" placeholder="Ex: PETR4, Tesouro IPCA+...">
            </div>
            <div class="form-group">
                <label class="form-label">Tipo</label>
                <select class="investment-type-select" id="investmentType">
                    <option value="A√ß√µes" data-icon="fas fa-chart-line" data-color="#2563eb">A√ß√µes</option>
                    <option value="FII" data-icon="fas fa-building" data-color="#f59e0b">Fundos Imobili√°rios</option>
                    <option value="Tesouro" data-icon="fas fa-landmark" data-color="#10b981">Tesouro Direto</option>
                    <option value="CDB" data-icon="fas fa-piggy-bank" data-color="#8b5cf6">CDB</option>
                    <option value="Criptomoedas" data-icon="fas fa-coins" data-color="#ef4444">Criptomoedas</option>
                    <option value="Outros" data-icon="fas fa-wallet" data-color="#64748b">Outros</option>
                </select>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">Valor Investido (R$)</label>
                    <input type="number" class="form-input" id="investmentAmount" step="0.01" min="0">
                </div>
                <div class="form-group">
                    <label class="form-label">Rentabilidade (%)</label>
                    <input type="number" class="form-input" id="investmentProfitability" step="0.1" value="0">
                </div>
            </div>
            <div class="form-actions">
                <button class="btn btn-outline" onclick="closeAddInvestmentModal()">Cancelar</button>
                <button class="btn btn-success" onclick="addInvestment()">
                    <i class="fas fa-plus"></i> Adicionar Investimento
                </button>
            </div>
        </div>
    </div>

    <!-- Edit Investment Modal -->
    <div id="editInvestmentModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Editar Investimento</h3>
                <button class="modal-close" onclick="closeEditInvestmentModal()">&times;</button>
            </div>
            <input type="hidden" id="editInvestmentId">
            <div class="form-group">
                <label class="form-label">Nome do Investimento</label>
                <input type="text" class="form-input" id="editInvestmentName" placeholder="Ex: PETR4, Tesouro IPCA+...">
            </div>
            <div class="form-group">
                <label class="form-label">Tipo</label>
                <select class="investment-type-select" id="editInvestmentType">
                    <option value="A√ß√µes" data-icon="fas fa-chart-line" data-color="#2563eb">A√ß√µes</option>
                    <option value="FII" data-icon="fas fa-building" data-color="#f59e0b">Fundos Imobili√°rios</option>
                    <option value="Tesouro" data-icon="fas fa-landmark" data-color="#10b981">Tesouro Direto</option>
                    <option value="CDB" data-icon="fas fa-piggy-bank" data-color="#8b5cf6">CDB</option>
                    <option value="Criptomoedas" data-icon="fas fa-coins" data-color="#ef4444">Criptomoedas</option>
                    <option value="Outros" data-icon="fas fa-wallet" data-color="#64748b">Outros</option>
                </select>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">Valor Investido (R$)</label>
                    <input type="number" class="form-input" id="editInvestmentAmount" step="0.01" min="0">
                </div>
                <div class="form-group">
                    <label class="form-label">Rentabilidade (%)</label>
                    <input type="number" class="form-input" id="editInvestmentProfitability" step="0.1" value="0">
                </div>
            </div>
            <div class="form-actions">
                <button class="btn btn-outline" onclick="closeEditInvestmentModal()">Cancelar</button>
                <button class="btn btn-warning" onclick="updateInvestment()">
                    <i class="fas fa-save"></i> Atualizar
                </button>
                <button class="btn btn-danger" onclick="showConfirmationModal('deleteInvestment')">
                    <i class="fas fa-trash"></i> Excluir
                </button>
            </div>
        </div>
    </div>

    <!-- Add Reminder Modal -->
    <div id="addReminderModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Novo Lembrete</h3>
                <button class="modal-close" onclick="closeAddReminderModal()">&times;</button>
            </div>
            <div class="form-group">
                <label class="form-label">T√≠tulo</label>
                <input type="text" class="form-input" id="reminderTitle" placeholder="Ex: Pagamento do Aluguel">
            </div>
            <div class="form-group">
                <label class="form-label">Descri√ß√£o</label>
                <textarea class="form-input" id="reminderDescription" placeholder="Descri√ß√£o do lembrete..." rows="3"></textarea>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">Valor (R$)</label>
                    <input type="number" class="form-input" id="reminderAmount" step="0.01" min="0">
                </div>
                <div class="form-group">
                    <label class="form-label">Data de Vencimento</label>
                    <input type="date" class="form-input" id="reminderDueDate">
                </div>
            </div>
            <div class="form-group">
                <label class="form-label">Categoria</label>
                <select class="form-input" id="reminderCategory">
                    <option value="moradia">Moradia</option>
                    <option value="alimentacao">Alimenta√ß√£o</option>
                    <option value="transporte">Transporte</option>
                    <option value="saude">Sa√∫de</option>
                    <option value="educacao">Educa√ß√£o</option>
                    <option value="lazer">Lazer</option>
                </select>
            </div>
            <div class="form-actions">
                <button class="btn btn-outline" onclick="closeAddReminderModal()">Cancelar</button>
                <button class="btn btn-success" onclick="addReminder()">
                    <i class="fas fa-plus"></i> Adicionar Lembrete
                </button>
            </div>
        </div>
    </div>

    <!-- Add Category Modal -->
    <div id="addCategoryModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Nova Categoria</h3>
                <button class="modal-close" onclick="closeAddCategoryModal()">&times;</button>
            </div>
            <div class="form-group">
                <label class="form-label">Nome da Categoria</label>
                <input type="text" class="form-input" id="categoryName" placeholder="Ex: Viagens, Educa√ß√£o...">
            </div>
            <div class="form-group">
                <label class="form-label">√çcone</label>
                <select class="form-input" id="categoryIcon">
                    <option value="fas fa-plane">Viagem</option>
                    <option value="fas fa-graduation-cap">Educa√ß√£o</option>
                    <option value="fas fa-heart">Sa√∫de</option>
                    <option value="fas fa-car">Transporte</option>
                    <option value="fas fa-home">Moradia</option>
                    <option value="fas fa-utensils">Alimenta√ß√£o</option>
                    <option value="fas fa-shopping-cart">Compras</option>
                    <option value="fas fa-film">Entretenimento</option>
                </select>
            </div>
            <div class="form-group">
                <label class="form-label">Cor</label>
                <input type="color" class="form-input" id="categoryColor" value="#2563eb">
            </div>
            <div class="form-actions">
                <button class="btn btn-outline" onclick="closeAddCategoryModal()">Cancelar</button>
                <button class="btn btn-success" onclick="addCategory()">
                    <i class="fas fa-plus"></i> Adicionar Categoria
                </button>
            </div>
        </div>
    </div>

    <!-- üî• NOVO MODAL: Configura√ß√µes -->
    <div id="settingsModal" class="modal settings-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Configura√ß√µes da Conta</h3>
                <button class="modal-close" onclick="closeSettingsModal()">&times;</button>
            </div>
            
            <div class="settings-section">
                <h4 class="settings-section-title">Foto de Perfil</h4>
                <div class="avatar-upload">
                    <div class="avatar-preview" id="settingsAvatarPreview">U</div>
                    <div class="avatar-actions">
                        <button class="btn btn-outline" onclick="changeAvatar()">
                            <i class="fas fa-camera"></i> Alterar Foto
                        </button>
                        <p class="form-subtitle">Clique para alterar sua foto de perfil</p>
                    </div>
                </div>
            </div>

            <div class="settings-section">
                <h4 class="settings-section-title">Informa√ß√µes Pessoais</h4>
                <div class="form-group">
                    <label class="form-label">Nome Completo</label>
                    <input type="text" class="form-input" id="settingsUserName" placeholder="Seu nome completo">
                </div>
                <div class="form-group">
                    <label class="form-label">E-mail</label>
                    <input type="email" class="form-input" id="settingsUserEmail" placeholder="seu@email.com">
                </div>
            </div>

            <div class="settings-section">
                <h4 class="settings-section-title">Seguran√ßa</h4>
                <div class="form-group">
                    <label class="form-label">Nova Senha</label>
                    <input type="password" class="form-input" id="settingsNewPassword" placeholder="Deixe em branco para n√£o alterar">
                </div>
                <div class="form-group">
                    <label class="form-label">Confirmar Nova Senha</label>
                    <input type="password" class="form-input" id="settingsConfirmPassword" placeholder="Confirme a nova senha">
                </div>
            </div>

            <div class="form-actions">
                <button class="btn btn-outline" onclick="closeSettingsModal()">Cancelar</button>
                <button class="btn btn-success" onclick="saveSettings()">
                    <i class="fas fa-save"></i> Salvar Altera√ß√µes
                </button>
            </div>
        </div>
    </div>

    <!-- Modal: Transa√ß√µes por Categoria -->
    <div id="categoryTransactionsModal" class="modal category-transactions-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="categoryModalTitle">Transa√ß√µes</h3>
                <button class="modal-close" onclick="closeCategoryTransactionsModal()">&times;</button>
            </div>
            <div class="category-transactions-list" id="categoryTransactionsList">
                <!-- Transa√ß√µes ser√£o preenchidas aqui -->
            </div>
            <div class="form-actions">
                <button class="btn btn-outline" onclick="closeCategoryTransactionsModal()">Fechar</button>
            </div>
        </div>
    </div>

    <!-- üî• MODAL MELHORADO: Relat√≥rio PDF -->
    <div id="reportModal" class="modal report-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Gerar Relat√≥rio PDF</h3>
                <button class="modal-close" onclick="closeReportModal()">&times;</button>
            </div>
            
            <div class="form-group">
                <label class="form-label">Per√≠odo do Relat√≥rio</label>
                <div class="report-period-options">
                    <div class="report-period-option active" onclick="selectReportPeriod('current-month', event)">
                        <i class="fas fa-calendar-alt"></i>
                        <div>M√™s Atual</div>
                    </div>
                    <div class="report-period-option" onclick="selectReportPeriod('last-3-months', event)">
                        <i class="fas fa-calendar-week"></i>
                        <div>√öltimos 3 Meses</div>
                    </div>
                    <div class="report-period-option" onclick="selectReportPeriod('last-6-months', event)">
                        <i class="fas fa-calendar-day"></i>
                        <div>√öltimos 6 Meses</div>
                    </div>
                    <div class="report-period-option" onclick="selectReportPeriod('custom', event)">
                        <i class="fas fa-calendar-plus"></i>
                        <div>Personalizado</div>
                    </div>
                </div>
            </div>

            <div class="custom-date-range" id="customDateRange" style="display: none;">
                <div class="form-group">
                    <label class="form-label">Per√≠odo Personalizado</label>
                    <div class="date-range-inputs">
                        <div class="form-group">
                            <label class="form-label">Data Inicial</label>
                            <input type="date" class="form-input" id="reportStartDate">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Data Final</label>
                            <input type="date" class="form-input" id="reportEndDate">
                        </div>
                    </div>
                </div>
            </div>

            <div class="report-summary" id="reportSummary">
                <!-- Resumo ser√° preenchido aqui -->
            </div>

            <div class="form-actions">
                <button class="btn btn-outline" onclick="closeReportModal()">Cancelar</button>
                <button class="btn btn-success" onclick="generatePDFReport()" id="generateReportBtn">
                    <i class="fas fa-file-pdf"></i> Gerar Relat√≥rio PDF
                </button>
            </div>
        </div>
    </div>

    <!-- üî• NOVO MODAL: Confirma√ß√£o -->
    <div id="confirmationModal" class="modal confirmation-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="confirmationTitle">Confirmar A√ß√£o</h3>
                <button class="modal-close" onclick="closeConfirmationModal()">&times;</button>
            </div>
            <div class="confirmation-icon" id="confirmationIcon">
                <i class="fas fa-exclamation-triangle"></i>
            </div>
            <div class="confirmation-message" id="confirmationMessage">
                Tem certeza que deseja realizar esta a√ß√£o?
            </div>
            <div class="confirmation-actions">
                <button class="btn btn-outline" onclick="closeConfirmationModal()">Cancelar</button>
                <button class="btn" id="confirmationActionBtn" onclick="executeConfirmedAction()">
                    <i class="fas fa-check"></i> Confirmar
                </button>
            </div>
        </div>
    </div>

    <script>
        // ===== VARI√ÅVEIS GLOBAIS =====
        let currentUser = null;
        let auth;
        let db;
        let transactions = [];
        let goals = [];
        let investments = [];
        let reminders = [];
        let categories = [];
        let compoundInterestChart = null;
        let portfolioChart = null;
        let expenseDistributionChart = null;
        let monthlyEconomyChart = null;
        let selectedReportPeriod = 'current-month';
        let pendingConfirmation = null;
        let currentTheme = 'dark';

        // ===== SISTEMA DE CACHE =====
        const cache = {
            set: (key, data, ttl = 300000) => { // 5 minutos default
                try {
                    const item = {
                        data,
                        expiry: Date.now() + ttl
                    };
                    localStorage.setItem(`nexus_${key}`, JSON.stringify(item));
                } catch (e) {
                    console.warn('Erro ao salvar no cache:', e);
                }
            },
            get: (key) => {
                try {
                    const itemStr = localStorage.getItem(`nexus_${key}`);
                    if (!itemStr) return null;
                    
                    const item = JSON.parse(itemStr);
                    if (Date.now() > item.expiry) {
                        localStorage.removeItem(`nexus_${key}`);
                        return null;
                    }
                    
                    return item.data;
                } catch (e) {
                    console.warn('Erro ao ler do cache:', e);
                    return null;
                }
            },
            remove: (key) => {
                try {
                    localStorage.removeItem(`nexus_${key}`);
                } catch (e) {
                    console.warn('Erro ao remover do cache:', e);
                }
            }
        };

        // ===== DEBOUNCE PARA PERFORMANCE =====
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // ===== VALIDA√á√ïES =====
        function validateTransaction(description, amount, type) {
            const errors = [];
            
            if (!description || description.trim().length < 2) {
                errors.push('Descri√ß√£o deve ter pelo menos 2 caracteres');
            }
            
            if (!amount || amount <= 0) {
                errors.push('Valor deve ser maior que zero');
            }
            
            if (amount > 1000000) {
                errors.push('Valor muito alto. Verifique o valor digitado.');
            }
            
            if (!['revenue', 'essential', 'non-essential'].includes(type)) {
                errors.push('Tipo de transa√ß√£o inv√°lido');
            }
            
            return errors;
        }

        function validateGoal(name, targetAmount, timeframe) {
            const errors = [];
            
            if (!name || name.trim().length < 2) {
                errors.push('Nome da meta deve ter pelo menos 2 caracteres');
            }
            
            if (!targetAmount || targetAmount <= 0) {
                errors.push('Valor da meta deve ser maior que zero');
            }
            
            if (!timeframe || timeframe <= 0) {
                errors.push('Prazo deve ser maior que zero');
            }
            
            if (timeframe > 120) {
                errors.push('Prazo m√°ximo √© de 120 meses');
            }
            
            return errors;
        }

        // ===== RATE LIMITING =====
        const transactionLimits = {};
        function checkRateLimit(userId, type) {
            const now = Date.now();
            const key = `${userId}_${type}`;
            
            if (!transactionLimits[key]) {
                transactionLimits[key] = [];
            }
            
            // Limitar para 10 transa√ß√µes por minuto por tipo
            transactionLimits[key] = transactionLimits[key].filter(time => now - time < 60000);
            
            if (transactionLimits[key].length >= 10) {
                throw new Error('Muitas transa√ß√µes r√°pidas. Aguarde um momento.');
            }
            
            transactionLimits[key].push(now);
            return true;
        }

        // ===== SISTEMA OFFLINE =====
        const pendingOperations = JSON.parse(localStorage.getItem('pending_operations') || '[]');

        function addToQueue(operation) {
            pendingOperations.push({
                ...operation,
                timestamp: Date.now(),
                id: Date.now().toString()
            });
            localStorage.setItem('pending_operations', JSON.stringify(pendingOperations));
        }

        function checkOnlineStatus() {
            if (!navigator.onLine) {
                showNotification('Voc√™ est√° offline. Algumas funcionalidades podem n√£o estar dispon√≠veis.', 'warning');
                return false;
            }
            return true;
        }

        // ===== LOADING STATES =====
        function showLoading(message = 'Carregando...') {
            const loadingId = 'loading-' + Date.now();
            const loadingDiv = document.createElement('div');
            loadingDiv.id = loadingId;
            loadingDiv.className = 'notification info';
            loadingDiv.innerHTML = `
                <div class="notification-icon">
                    <i class="fas fa-spinner fa-spin"></i>
                </div>
                <div class="notification-content">${message}</div>
            `;
            
            let container = document.querySelector('.notification-container');
            if (!container) {
                container = document.createElement('div');
                container.className = 'notification-container';
                document.body.appendChild(container);
            }
            
            container.appendChild(loadingDiv);
            return loadingId;
        }

        function hideLoading(loadingId) {
            const loadingElement = document.getElementById(loadingId);
            if (loadingElement) {
                loadingElement.remove();
            }
        }

        function withLoading(fn, message = 'Carregando...') {
            return async function(...args) {
                const loadingId = showLoading(message);
                try {
                    const result = await fn(...args);
                    hideLoading(loadingId);
                    return result;
                } catch (error) {
                    hideLoading(loadingId);
                    throw error;
                }
            };
        }

        // ===== CONFIRMA√á√ÉO MODAL =====
        function showConfirmationModal(action, data = null) {
            const modal = document.getElementById('confirmationModal');
            const title = document.getElementById('confirmationTitle');
            const message = document.getElementById('confirmationMessage');
            const icon = document.getElementById('confirmationIcon');
            const actionBtn = document.getElementById('confirmationActionBtn');
            
            pendingConfirmation = { action, data };
            
            switch(action) {
                case 'logout':
                    title.textContent = 'Confirmar Logout';
                    message.textContent = 'Tem certeza que deseja sair da sua conta?';
                    icon.className = 'confirmation-icon warning';
                    icon.innerHTML = '<i class="fas fa-sign-out-alt"></i>';
                    actionBtn.className = 'btn btn-warning';
                    actionBtn.innerHTML = '<i class="fas fa-sign-out-alt"></i> Sair';
                    break;
                    
                case 'deleteTransaction':
                    title.textContent = 'Excluir Transa√ß√£o';
                    message.textContent = 'Tem certeza que deseja excluir esta transa√ß√£o? Esta a√ß√£o n√£o pode ser desfeita.';
                    icon.className = 'confirmation-icon danger';
                    icon.innerHTML = '<i class="fas fa-trash"></i>';
                    actionBtn.className = 'btn btn-danger';
                    actionBtn.innerHTML = '<i class="fas fa-trash"></i> Excluir';
                    break;
                    
                case 'deleteGoal':
                    title.textContent = 'Excluir Meta';
                    message.textContent = 'Tem certeza que deseja excluir esta meta? Todos os progressos ser√£o perdidos.';
                    icon.className = 'confirmation-icon danger';
                    icon.innerHTML = '<i class="fas fa-trash"></i>';
                    actionBtn.className = 'btn btn-danger';
                    actionBtn.innerHTML = '<i class="fas fa-trash"></i> Excluir';
                    break;
                    
                case 'deleteInvestment':
                    title.textContent = 'Excluir Investimento';
                    message.textContent = 'Tem certeza que deseja excluir este investimento?';
                    icon.className = 'confirmation-icon danger';
                    icon.innerHTML = '<i class="fas fa-trash"></i>';
                    actionBtn.className = 'btn btn-danger';
                    actionBtn.innerHTML = '<i class="fas fa-trash"></i> Excluir';
                    break;
            }
            
            modal.classList.add('active');
        }

        function closeConfirmationModal() {
            document.getElementById('confirmationModal').classList.remove('active');
            pendingConfirmation = null;
        }

        function executeConfirmedAction() {
    if (!pendingConfirmation) return;
    
    const { action, data } = pendingConfirmation;
    
    switch(action) {
        case 'logout':
            handleLogout();
            break;
        case 'deleteTransaction':
            // Passar o ID da transa√ß√£o
            deleteTransaction(data);
            break;
        case 'deleteGoal':
            // Passar o ID da meta
            deleteGoal(data);
            break;
        case 'deleteInvestment':
            // Passar o ID do investimento
            deleteInvestment(data);
            break;
    }
    
    closeConfirmationModal();
}

        // ===== INICIALIZA√á√ÉO DO FIREBASE =====
        function initializeFirebase() {
            try {
                const firebaseConfig = {
                    apiKey: "AIzaSyCfymo5Fn9skpk03PmGZ0KjDt8ONbwD1rs",
                    authDomain: "nexusfinance-bab8e.firebaseapp.com",
                    projectId: "nexusfinance-bab8e",
                    storageBucket: "nexusfinance-bab8e.firebasestorage.app",
                    messagingSenderId: "751159627519",
                    appId: "1:751159627519:web:88b4dd9b395bc4229606ca",
                    measurementId: "G-Q134TR8RGD"
                };
                
                firebase.initializeApp(firebaseConfig);
                auth = firebase.auth();
                db = firebase.firestore();
                
                console.log("‚úÖ Firebase inicializado com sucesso!");
                return true;
            } catch (error) {
                console.error("‚ùå Erro ao inicializar Firebase:", error);
                return false;
            }
        }

        // ===== FUN√á√ïES DE AUTENTICA√á√ÉO =====
        function checkLoggedInUser() {
            if (!initializeFirebase()) {
                console.log('‚ùå Firebase n√£o inicializado');
                return;
            }
            
            auth.onAuthStateChanged((user) => {
                if (user) {
                    db.collection('users').doc(user.uid).get()
                        .then((doc) => {
                            if (doc.exists) {
                                const userData = doc.data();
                                currentUser = {
                                    uid: user.uid,
                                    name: userData.name,
                                    email: userData.email,
                                    avatar: userData.avatar
                                };
                                showApp();
                            }
                        })
                        .catch((error) => {
                            console.error('‚ùå Erro ao carregar dados do usu√°rio:', error);
                        });
                } else {
                    hideApp();
                }
            });
        }

        function handleLogin(event) {
            event.preventDefault();
            
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;

            const btn = event.target.querySelector('button[type="submit"]') || event.target;
            const originalText = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Entrando...';
            btn.disabled = true;

            auth.signInWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    const user = userCredential.user;
                    return db.collection('users').doc(user.uid).get();
                })
                .then((doc) => {
                    if (doc.exists) {
                        const userData = doc.data();
                        currentUser = {
                            uid: auth.currentUser.uid,
                            name: userData.name,
                            email: userData.email,
                            avatar: userData.avatar
                        };
                        showApp();
                        showNotification(`Bem-vindo de volta, ${userData.name}!`, 'success');
                    }
                })
                .catch((error) => {
                    showNotification('E-mail ou senha incorretos', 'error');
                })
                .finally(() => {
                    btn.innerHTML = originalText;
                    btn.disabled = false;
                });
        }

        function handleRegister(event) {
            event.preventDefault();
            
            const name = document.getElementById('registerName').value.trim();
            const email = document.getElementById('registerEmail').value.trim();
            const password = document.getElementById('registerPassword').value;

            const btn = event.target.querySelector('button[type="submit"]') || event.target;
            const originalText = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Criando conta...';
            btn.disabled = true;

            auth.createUserWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    const user = userCredential.user;
                    return db.collection('users').doc(user.uid).set({
                        name: name,
                        email: email,
                        avatar: getInitials(name),
                        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                        lastLogin: firebase.firestore.FieldValue.serverTimestamp()
                    });
                })
                .then(() => {
                    return db.collection('users').doc(auth.currentUser.uid).get();
                })
                .then((doc) => {
                    if (doc.exists) {
                        const userData = doc.data();
                        currentUser = {
                            uid: auth.currentUser.uid,
                            name: userData.name,
                            email: userData.email,
                            avatar: userData.avatar
                        };
                        showApp();
                        showNotification(`Conta criada com sucesso! Bem-vindo, ${name}!`, 'success');
                    }
                })
                .catch((error) => {
                    showNotification('Erro ao criar conta: ' + error.message, 'error');
                })
                .finally(() => {
                    btn.innerHTML = originalText;
                    btn.disabled = false;
                });
        }

        function handleLogout() {
            auth.signOut()
                .then(() => {
                    currentUser = null;
                    hideApp();
                    showNotification('Logout realizado com sucesso!', 'info');
                })
                .catch((error) => {
                    showNotification('Erro ao fazer logout', 'error');
                });
        }

        // ===== FUN√á√ïES DE INTERFACE =====
        function switchAuthTab(tab, event) {
            if (event) event.preventDefault();
            
            document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.auth-form').forEach(f => f.classList.remove('active'));
            
            document.querySelector(`.auth-tab:nth-child(${tab === 'login' ? '1' : '2'})`).classList.add('active');
            document.getElementById(`${tab}Form`).classList.add('active');
        }

        function switchTab(tabName) {
            // Update desktop navigation
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // Update mobile navigation
            document.querySelectorAll('.mobile-nav-item').forEach(item => {
                item.classList.remove('active');
            });

            // Find and activate the clicked nav item
            const navItems = document.querySelectorAll('.nav-item');
            for (let i = 0; i < navItems.length; i++) {
                if (navItems[i].textContent.includes(getTabName(tabName))) {
                    navItems[i].classList.add('active');
                    break;
                }
            }

            // Activate mobile nav item
            const mobileNavItems = document.querySelectorAll('.mobile-nav-item');
            for (let i = 0; i < mobileNavItems.length; i++) {
                if (mobileNavItems[i].textContent.includes(getTabName(tabName))) {
                    mobileNavItems[i].classList.add('active');
                    break;
                }
            }

            // Update content
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.getElementById(tabName).classList.add('active');

            // Update page title
            const titles = {
                'dashboard': 'Dashboard Financeiro',
                'transactions': 'Transa√ß√µes',
                'goals': 'Metas Financeiras',
                'investments': 'Investimentos'
            };
            document.getElementById('pageTitle').textContent = titles[tabName] || 'Dashboard Financeiro';

            // Load data when switching tabs
            if (tabName === 'transactions') {
                loadTransactions();
            } else if (tabName === 'goals') {
                loadGoals();
            } else if (tabName === 'investments') {
                loadInvestments();
                setTimeout(() => {
                    showSimulator('juros-compostos');
                    calculateCompoundInterest();
                }, 100);
            } else if (tabName === 'dashboard') {
                loadReminders();
                loadCategories();
            }

            // Refresh charts when switching to investments tab
            if (tabName === 'investments') {
                setTimeout(() => {
                    if (compoundInterestChart) compoundInterestChart.update();
                    if (portfolioChart) portfolioChart.update();
                }, 100);
            }
        }

        function getTabName(tabId) {
            const tabNames = {
                'dashboard': 'Dashboard',
                'transactions': 'Transa√ß√µes',
                'goals': 'Metas',
                'investments': 'Investimentos'
            };
            return tabNames[tabId] || '';
        }

        function showApp() {
            document.getElementById('loginScreen').style.display = 'none'; 
            document.getElementById('appContainer').style.display = 'flex';
            document.getElementById('userName').textContent = currentUser.name; 
            document.getElementById('userAvatar').textContent = currentUser.avatar; 
            initApp();
        }

        function hideApp() {
            document.getElementById('loginScreen').style.display = 'flex';
            document.getElementById('appContainer').style.display = 'none';
            switchAuthTab('login');
        }

        // ===== FUN√á√ïES UTILIT√ÅRIAS =====
        function getInitials(name) {
            return name.split(' ').map(n => n[0]).join('').toUpperCase().substring(0, 2);
        }

        function showNotification(message, type = 'info') {
            let container = document.querySelector('.notification-container');
            if (!container) {
                container = document.createElement('div');
                container.className = 'notification-container';
                document.body.appendChild(container);
            }
            
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            
            notification.innerHTML = `
                <div class="notification-icon">
                    <i class="fas fa-${getNotificationIcon(type)}"></i>
                </div>
                <div class="notification-content">${message}</div>
                <button class="notification-close" onclick="this.parentElement.remove()">
                    <i class="fas fa-times"></i>
                </button>
            `;
            
            container.appendChild(notification);
            
            // Auto remove after 5 seconds
            setTimeout(() => {
                if (notification.parentElement) {
                    notification.remove();
                }
            }, 5000);
        }

        function getNotificationIcon(type) {
            const icons = {
                success: 'check-circle',
                error: 'exclamation-circle',
                warning: 'exclamation-triangle',
                info: 'info-circle'
            };
            return icons[type] || 'info-circle';
        }

        // ===== TEMA ESCURO/CLARO =====
        function toggleTheme() {
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            setTheme(newTheme);
        }

        function setTheme(theme) {
            currentTheme = theme;
            document.documentElement.setAttribute('data-theme', theme);
            localStorage.setItem('nexus_theme', theme);
            
            const themeIcon = document.getElementById('themeToggle');
            if (theme === 'dark') {
                themeIcon.innerHTML = '<i class="fas fa-moon"></i>';
            } else {
                themeIcon.innerHTML = '<i class="fas fa-sun"></i>';
            }
            
            // Atualizar gr√°ficos quando o tema mudar
            setTimeout(() => {
                if (compoundInterestChart) compoundInterestChart.update();
                if (portfolioChart) portfolioChart.update();
                if (expenseDistributionChart) expenseDistributionChart.update();
                if (monthlyEconomyChart) monthlyEconomyChart.update();
            }, 100);
        }

        function loadTheme() {
            const savedTheme = localStorage.getItem('nexus_theme') || 'dark';
            setTheme(savedTheme);
        }

        // ===== INICIALIZA√á√ÉO DO APP =====
        function initApp() {
            loadTheme();
            setupDateFilters();
            setupDashboardCharts();
            updateSelectedMonthDisplay();
            updateDashboardStats();
            loadMarketIndicators();
            loadInvestments();
            loadReminders();
            loadCategories();
            setTimeout(() => {
                calculateCompoundInterest();
            }, 500);
            loadTransactions();
            loadGoals();
        }

        function setupDateFilters() {
            const now = new Date();
            const monthSelect = document.getElementById('monthSelect');
            const yearSelect = document.getElementById('yearSelect');
            
            monthSelect.value = now.getMonth();
            yearSelect.value = now.getFullYear();
        }

        function handleDateChange() { 
            updateSelectedMonthDisplay(); 
            updateDashboardStats(); 
            loadTransactions();
        }

        function updateSelectedMonthDisplay() {
            const monthSelect = document.getElementById('monthSelect');
            const yearSelect = document.getElementById('yearSelect');
            const selectedMonthDisplay = document.getElementById('selectedMonthDisplay');
            
            const monthNames = [
                'Janeiro', 'Fevereiro', 'Mar√ßo', 'Abril', 'Maio', 'Junho',
                'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'
            ];
            
            const selectedMonth = monthNames[parseInt(monthSelect.value)];
            const selectedYear = yearSelect.value;
            
            selectedMonthDisplay.textContent = `${selectedMonth} de ${selectedYear}`;
        }

        // ===== GR√ÅFICOS DO DASHBOARD - MODIFICADOS =====
        function setupDashboardCharts() {
            setupExpenseDistributionChart();
            setupMonthlyEconomyChart();
        }

        function setupExpenseDistributionChart() {
            const ctx = document.getElementById('expenseDistributionChart').getContext('2d');
            
            if (expenseDistributionChart) {
                expenseDistributionChart.destroy();
            }

            expenseDistributionChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Essenciais', 'N√£o Essenciais', 'Economia'],
                    datasets: [{
                        data: [0, 0, 0], // Iniciar com zeros
                        backgroundColor: ['#2563eb', '#f59e0b', '#10b981'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                color: '#F8FAFC',
                                padding: 20
                            }
                        }
                    }
                }
            });
        }

        function setupMonthlyEconomyChart() {
            const ctx = document.getElementById('monthlyEconomyChart').getContext('2d');
            
            if (monthlyEconomyChart) {
                monthlyEconomyChart.destroy();
            }

            // Iniciar com dados zerados para novos usu√°rios
            const monthlyData = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
            const months = ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun', 'Jul', 'Ago', 'Set', 'Out', 'Nov', 'Dez'];

            monthlyEconomyChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: months,
                    datasets: [{
                        label: 'Economia Mensal (R$)',
                        data: monthlyData,
                        backgroundColor: 'rgba(139, 92, 246, 0.8)',
                        borderColor: '#8b5cf6',
                        borderWidth: 2,
                        borderRadius: 8,
                        borderSkipped: false,
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                color: '#F8FAFC'
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#F8FAFC',
                                callback: function(value) {
                                    return 'R$ ' + value.toLocaleString('pt-BR');
                                }
                            }
                        },
                        x: {
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#F8FAFC'
                            }
                        }
                    }
                }
            });
        }

        // ===== ATUALIZA√á√ÉO DAS ESTAT√çSTICAS =====
        const debouncedUpdateStats = debounce(updateDashboardStats, 300);

        async function updateDashboardStats() {
            if (!currentUser) return;

            try {
                const userId = currentUser.uid;
                const monthSelect = document.getElementById('monthSelect');
                const yearSelect = document.getElementById('yearSelect');
                const selectedMonth = parseInt(monthSelect.value);
                const selectedYear = parseInt(yearSelect.value);

                // Verificar cache primeiro
                const cacheKey = `stats_${userId}_${selectedMonth}_${selectedYear}`;
                const cachedStats = cache.get(cacheKey);
                
                if (cachedStats && !document.hidden) {
                    updateStatsUI(cachedStats);
                    return;
                }

                // Carregar todas as transa√ß√µes e filtrar localmente
                const snapshot = await db.collection('users').doc(userId)
                    .collection('transactions')
                    .orderBy('createdAt', 'desc')
                    .get();

                let totalRevenue = 0;
                let totalEssential = 0;
                let totalNonEssential = 0;

                snapshot.forEach(doc => {
                    const data = doc.data();
                    // Filtrar localmente por m√™s e ano
                    if (data.month === selectedMonth && data.year === selectedYear) {
                        if (data.type === 'revenue') {
                            totalRevenue += data.amount;
                        } else if (data.type === 'essential') {
                            totalEssential += data.amount;
                        } else if (data.type === 'non-essential') {
                            totalNonEssential += data.amount;
                        }
                    }
                });

                const economy = totalRevenue - totalEssential - totalNonEssential;

                const stats = {
                    revenue: totalRevenue,
                    essential: totalEssential,
                    nonEssential: totalNonEssential,
                    economy: economy
                };

                // Salvar no cache
                cache.set(cacheKey, stats);

                updateStatsUI(stats);

            } catch (error) {
                console.error("‚ùå Erro ao atualizar estat√≠sticas:", error);
                // Valores padr√£o em caso de erro
                updateStatsUI({
                    revenue: 0,
                    essential: 0,
                    nonEssential: 0,
                    economy: 0
                });
            }
        }

        function updateStatsUI(stats) {
            document.getElementById('revenueAmount').textContent = `R$ ${stats.revenue.toLocaleString('pt-BR', {minimumFractionDigits: 2})}`;
            document.getElementById('essentialAmount').textContent = `R$ ${stats.essential.toLocaleString('pt-BR', {minimumFractionDigits: 2})}`;
            document.getElementById('nonEssentialAmount').textContent = `R$ ${stats.nonEssential.toLocaleString('pt-BR', {minimumFractionDigits: 2})}`;
            document.getElementById('economyAmount').textContent = `R$ ${stats.economy.toLocaleString('pt-BR', {minimumFractionDigits: 2})}`;

            // Atualizar gr√°fico de distribui√ß√£o com dados reais
            if (expenseDistributionChart) {
                expenseDistributionChart.data.datasets[0].data = [
                    stats.essential,
                    stats.nonEssential,
                    stats.economy > 0 ? stats.economy : 0
                ];
                expenseDistributionChart.update();
            }
        }

        // ===== FUN√á√ïES DE TRANSA√á√ïES =====
        const safeAddTransaction = withLoading(addTransaction, 'Salvando transa√ß√£o...');

        async function addTransaction(type) {
            let descriptionElement, amountElement, categoryElement;
            
            switch(type) {
                case 'revenue':
                    descriptionElement = document.getElementById('revenueDescription');
                    amountElement = document.getElementById('revenueAmountInput');
                    categoryElement = document.getElementById('revenueCategory');
                    break;
                case 'essential':
                    descriptionElement = document.getElementById('essentialDescription');
                    amountElement = document.getElementById('essentialAmountInput');
                    categoryElement = document.getElementById('essentialCategory');
                    break;
                case 'non-essential':
                    descriptionElement = document.getElementById('nonEssentialDescription');
                    amountElement = document.getElementById('nonEssentialAmountInput');
                    categoryElement = document.getElementById('nonEssentialCategory');
                    break;
                default:
                    showNotification('Tipo de transa√ß√£o inv√°lido', 'error');
                    return;
            }
            
            const description = descriptionElement.value.trim();
            const amount = parseFloat(amountElement.value);
            const category = categoryElement.value;
            
            // Valida√ß√£o
            const errors = validateTransaction(description, amount, type);
            if (errors.length > 0) {
                errors.forEach(error => showNotification(error, 'warning'));
                return;
            }
            
            if (!currentUser) {
                showNotification('Voc√™ precisa estar logado', 'error');
                return;
            }
            
            // Rate limiting
            try {
                checkRateLimit(currentUser.uid, type);
            } catch (error) {
                showNotification(error.message, 'warning');
                return;
            }
            
            const userId = currentUser.uid;
            const monthSelect = document.getElementById('monthSelect');
            const yearSelect = document.getElementById('yearSelect');
            const selectedMonth = parseInt(monthSelect.value);
            const selectedYear = parseInt(yearSelect.value);
            
            const transactionDate = new Date(selectedYear, selectedMonth, 1);
            
            const newTransactionData = { 
                description: description,
                amount: amount,
                type: type,
                category: category,
                date: transactionDate.toISOString(),
                month: selectedMonth,
                year: selectedYear,
                createdAt: firebase.firestore.FieldValue.serverTimestamp() 
            };

            try {
                // Verificar se est√° online
                if (!checkOnlineStatus()) {
                    addToQueue({
                        type: 'transaction',
                        action: 'add',
                        data: newTransactionData
                    });
                    showNotification('Transa√ß√£o salva localmente. Ser√° sincronizada quando online.', 'info');
                } else {
                    const docRef = await db.collection('users').doc(userId).collection('transactions').add(newTransactionData);
                }

                // Clear form fields
                descriptionElement.value = '';
                amountElement.value = '';
                
                // Invalidar cache
                cache.remove(`stats_${userId}_${selectedMonth}_${selectedYear}`);
                cache.remove(`transactions_${userId}_${selectedMonth}_${selectedYear}`);
                
                // Reload transactions to show the new one
                loadTransactions();
                
                // Atualizar os cards imediatamente
                setTimeout(() => updateDashboardStats(), 500);
                
                showNotification(
                    `${type === 'revenue' ? 'Receita' : 'Despesa'} adicionada com sucesso!`, 
                    'success'
                );

            } catch (error) {
                console.error("‚ùå Erro ao salvar transa√ß√£o:", error);
                showNotification("Erro ao salvar: " + error.message, "error");
            }
        }

        async function loadTransactions() {
            if (!currentUser) return;

            const userId = currentUser.uid;
            const monthSelect = document.getElementById('monthSelect');
            const yearSelect = document.getElementById('yearSelect');
            const selectedMonth = parseInt(monthSelect.value);
            const selectedYear = parseInt(yearSelect.value);

            // Mostrar skeleton loading
            const transactionList = document.getElementById('transactionList');
            transactionList.innerHTML = `
                <div class="skeleton-loading skeleton-card"></div>
                <div class="skeleton-loading skeleton-card"></div>
                <div class="skeleton-loading skeleton-card"></div>
            `;

            try {
                // Verificar cache primeiro
                const cacheKey = `transactions_${userId}_${selectedMonth}_${selectedYear}`;
                const cachedTransactions = cache.get(cacheKey);
                
                if (cachedTransactions) {
                    transactions = cachedTransactions;
                    updateTransactionList();
                    return;
                }

                // Carregar todas as transa√ß√µes e filtrar localmente
                const snapshot = await db.collection('users').doc(userId)
                    .collection('transactions')
                    .orderBy('createdAt', 'desc')
                    .get();

                transactions = [];
                snapshot.forEach(doc => {
                    const data = doc.data();
                    // Filtrar localmente por m√™s e ano
                    if (data.month === selectedMonth && data.year === selectedYear) {
                        transactions.push({
                            id: doc.id,
                            ...data
                        });
                    }
                });

                // Salvar no cache
                cache.set(cacheKey, transactions);

                updateTransactionList();
                updateDashboardStats(); // Atualizar os cards ap√≥s carregar transa√ß√µes
                
            } catch (error) {
                console.error("‚ùå Erro ao carregar transa√ß√µes:", error);
                showNotification("Erro ao carregar transa√ß√µes. Os √≠ndices podem estar sendo criados.", "warning");
                
                // Mostrar estado vazio
                updateTransactionList();
            }
        }

        function updateTransactionList() {
            const transactionList = document.getElementById('transactionList');
            
            if (transactions.length === 0) {
                transactionList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-exchange-alt"></i>
                        <h3>Nenhuma transa√ß√£o este m√™s</h3>
                        <p>Adicione sua primeira transa√ß√£o para come√ßar</p>
                    </div>
                `;
            } else {
                transactionList.innerHTML = transactions.map(transaction => {
                    const date = new Date(transaction.date);
                    const typeLabels = {
                        'revenue': 'Receita',
                        'essential': 'Despesa Essencial',
                        'non-essential': 'Despesa N√£o Essencial'
                    };
                    
                    return `
                        <div class="transaction-item">
                            <div class="transaction-info">
                                <div class="transaction-description">${transaction.description}</div>
                                <div class="transaction-date">
                                    ${typeLabels[transaction.type]} ‚Ä¢ ${date.toLocaleDateString('pt-BR')}
                                    ${transaction.category ? `‚Ä¢ ${transaction.category}` : ''}
                                </div>
                            </div>
                            <div class="transaction-amount ${transaction.type}">
                                R$ ${transaction.amount.toLocaleString('pt-BR', {minimumFractionDigits: 2})}
                            </div>
                            <div class="transaction-actions">
                                <button class="btn btn-warning btn-sm" onclick="openEditTransactionModal('${transaction.id}')">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-danger btn-sm" onclick="showConfirmationModal('deleteTransaction', '${transaction.id}')">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    `;
                }).join('');
            }
        }

        // ===== FUN√á√ïES DE METAS - CORRIGIDAS =====
        function showAddGoalModal() {
            document.getElementById('addGoalModal').classList.add('active');
        }

        function closeAddGoalModal() {
            document.getElementById('addGoalModal').classList.remove('active');
        }

        const safeAddGoal = withLoading(addGoal, 'Criando meta...');

        async function addGoal() {
            const name = document.getElementById('goalName').value.trim();
            const description = document.getElementById('goalDescription').value.trim();
            const currentAmount = parseFloat(document.getElementById('goalCurrentAmount').value) || 0;
            const targetAmount = parseFloat(document.getElementById('goalTargetAmount').value);
            const timeframe = parseInt(document.getElementById('goalTimeframe').value);

            // Valida√ß√£o
            const errors = validateGoal(name, targetAmount, timeframe);
            if (errors.length > 0) {
                errors.forEach(error => showNotification(error, 'warning'));
                return;
            }

            if (!currentUser) {
                showNotification('Voc√™ precisa estar logado', 'error');
                return;
            }

            const userId = currentUser.uid;
            const monthlyAmount = (targetAmount - currentAmount) / timeframe;

            const newGoalData = {
                name: name,
                description: description,
                currentAmount: currentAmount,
                targetAmount: targetAmount,
                timeframe: timeframe,
                monthlyAmount: monthlyAmount,
                createdAt: firebase.firestore.FieldValue.serverTimestamp()
            };

            try {
                await db.collection('users').doc(userId).collection('goals').add(newGoalData);
                
                // Limpar formul√°rio
                document.getElementById('goalName').value = '';
                document.getElementById('goalDescription').value = '';
                document.getElementById('goalCurrentAmount').value = '0';
                document.getElementById('goalTargetAmount').value = '';
                document.getElementById('goalTimeframe').value = '12';
                
                // Invalidar cache
                cache.remove(`goals_${userId}`);
                
                closeAddGoalModal();
                loadGoals();
                showNotification('Meta criada com sucesso!', 'success');
                
            } catch (error) {
                console.error("‚ùå Erro ao salvar meta:", error);
                showNotification("Erro ao salvar meta: " + error.message, "error");
            }
        }

        async function loadGoals() {
            if (currentUser) {
        cache.remove(`goals_${currentUser.uid}`);
    }

            // Mostrar skeleton loading
            const goalsList = document.getElementById('goalsList');
            goalsList.innerHTML = `
                <div class="skeleton-loading skeleton-card" style="height: 200px;"></div>
                <div class="skeleton-loading skeleton-card" style="height: 200px;"></div>
            `;

            try {
                // Verificar cache primeiro
                const cacheKey = `goals_${userId}`;
                const cachedGoals = cache.get(cacheKey);
                
                if (cachedGoals) {
                    goals = cachedGoals;
                    updateGoalsList();
                    return;
                }

                const snapshot = await db.collection('users').doc(userId)
                    .collection('goals')
                    .orderBy('createdAt', 'desc')
                    .get();

                goals = [];
                snapshot.forEach(doc => {
                    goals.push({
                        id: doc.id,
                        ...doc.data()
                    });
                });

                // Salvar no cache
                cache.set(cacheKey, goals);

                updateGoalsList();
                
            } catch (error) {
                console.error("‚ùå Erro ao carregar metas:", error);
                showNotification("Erro ao carregar metas", "error");
                updateGoalsList();
            }
        }

        function updateGoalsList() {
            const goalsList = document.getElementById('goalsList');
            
            if (goals.length === 0) {
                goalsList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-bullseye"></i>
                        <h3>Nenhuma meta definida</h3>
                        <p>Crie sua primeira meta financeira para come√ßar</p>
                        <button class="btn" onclick="showAddGoalModal()" style="margin-top: 15px;">
                            <i class="fas fa-plus"></i> Criar Primeira Meta
                        </button>
                    </div>
                `;
            } else {
                // Calcular estat√≠sticas
                const activeGoals = goals.filter(goal => goal.currentAmount < goal.targetAmount);
                const completedGoals = goals.filter(goal => goal.currentAmount >= goal.targetAmount);
                const averageProgress = goals.length > 0 
                    ? (goals.reduce((sum, goal) => sum + (goal.currentAmount / goal.targetAmount), 0) / goals.length * 100).toFixed(1)
                    : 0;

                // Atualizar indicadores
                document.getElementById('activeGoalsCount').textContent = activeGoals.length;
                document.getElementById('completedGoalsCount').textContent = completedGoals.length;
                document.getElementById('averageProgress').textContent = `${averageProgress}%`;

                goalsList.innerHTML = goals.map(goal => {
                    const progress = (goal.currentAmount / goal.targetAmount) * 100;
                    const progressPercent = Math.min(progress, 100);
                    const remainingAmount = goal.targetAmount - goal.currentAmount;
                    const monthlyAmount = goal.monthlyAmount || (remainingAmount / goal.timeframe);
                    const isCompleted = goal.currentAmount >= goal.targetAmount;
                    
                    
                    return `
                        <div class="goal-card" onclick="openEditGoalModal('${goal.id}')">
                            <div class="goal-header">
                                <div>
                                    <div class="goal-title">${goal.name} ${isCompleted ? '‚úÖ' : ''}</div>
                                    <div class="goal-description">${goal.description}</div>
                                </div>
                                <div class="goal-amount">
                                    R$ ${goal.currentAmount.toLocaleString('pt-BR', {minimumFractionDigits: 2})}
                                </div>
                            </div>
                            
                            <div class="goal-progress">
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: ${progressPercent}%"></div>
                                </div>
                                <div class="progress-info">
                                    <span>${progressPercent.toFixed(1)}% conclu√≠do</span>
                                    <span>R$ ${goal.currentAmount.toLocaleString('pt-BR', {minimumFractionDigits: 2})} / R$ ${goal.targetAmount.toLocaleString('pt-BR', {minimumFractionDigits: 2})}</span>
                                </div>
                            </div>
                            
                                           ${!isCompleted ? `
                <div class="goal-monthly">
                    <div class="goal-monthly-label">Valor mensal necess√°rio: R$ ${monthlyAmount.toLocaleString('pt-BR', {minimumFractionDigits: 2})}</div>
                    <div class="goal-monthly-value">
                        <button class="btn btn-success btn-sm" onclick="event.stopPropagation(); addProgressToGoal('${goal.id}', ${monthlyAmount})">
                            <i class="fas fa-plus"></i> Adicionar ${monthlyAmount.toLocaleString('pt-BR', {minimumFractionDigits: 2})}
                        </button>
                        <button class="btn btn-outline btn-sm" onclick="event.stopPropagation(); addProgressToGoal('${goal.id}')" style="margin-left: 8px;">
                            <i class="fas fa-edit"></i> Outro valor
                        </button>
                    </div>
                </div>
                ` : `
                <div class="goal-monthly" style="border-left-color: var(--success);">
                    <div class="goal-monthly-label">Meta conclu√≠da!</div>
                    <div class="goal-monthly-value" style="color: var(--success);">Parab√©ns! üéâ</div>
                </div>
                `}
                            
                            <div class="goal-actions">
                                <button class="btn btn-warning btn-sm" onclick="event.stopPropagation(); openEditGoalModal('${goal.id}')">
                                    <i class="fas fa-edit"></i> Editar
                                </button>
                                ${!isCompleted ? `
                                <button class="btn btn-success btn-sm" onclick="event.stopPropagation(); addProgressToGoal('${goal.id}')">
                                    <i class="fas fa-plus"></i> Adicionar
                                </button>
                                ` : ''}
                            </div>
                        </div>
                    `;
                }).join('');
            }
        }

        async function openEditGoalModal(goalId) {
            const goal = goals.find(g => g.id === goalId);
            if (!goal) return;

            document.getElementById('editGoalId').value = goal.id;
            document.getElementById('editGoalName').value = goal.name;
            document.getElementById('editGoalDescription').value = goal.description;
            document.getElementById('editGoalCurrentAmount').value = goal.currentAmount;
            document.getElementById('editGoalTargetAmount').value = goal.targetAmount;
            document.getElementById('editGoalTimeframe').value = goal.timeframe;

            document.getElementById('editGoalModal').classList.add('active');
        }

        function closeEditGoalModal() {
            document.getElementById('editGoalModal').classList.remove('active');
        }

        const safeUpdateGoal = withLoading(updateGoal, 'Atualizando meta...');

        async function updateGoal() {
            const goalId = document.getElementById('editGoalId').value;
            const name = document.getElementById('editGoalName').value.trim();
            const description = document.getElementById('editGoalDescription').value.trim();
            const currentAmount = parseFloat(document.getElementById('editGoalCurrentAmount').value) || 0;
            const targetAmount = parseFloat(document.getElementById('editGoalTargetAmount').value);
            const timeframe = parseInt(document.getElementById('editGoalTimeframe').value);

            // Valida√ß√£o
            const errors = validateGoal(name, targetAmount, timeframe);
            if (errors.length > 0) {
                errors.forEach(error => showNotification(error, 'warning'));
                return;
            }

            const userId = currentUser.uid;
            const monthlyAmount = (targetAmount - currentAmount) / timeframe;

            try {
                await db.collection('users').doc(userId).collection('goals').doc(goalId).update({
                    name: name,
                    description: description,
                    currentAmount: currentAmount,
                    targetAmount: targetAmount,
                    timeframe: timeframe,
                    monthlyAmount: monthlyAmount,
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                });

                // Invalidar cache
                cache.remove(`goals_${userId}`);

                closeEditGoalModal();
                loadGoals();
                showNotification('Meta atualizada com sucesso!', 'success');
                
            } catch (error) {
                console.error("‚ùå Erro ao atualizar meta:", error);
                showNotification("Erro ao atualizar meta: " + error.message, "error");
            }
        }

        async function deleteGoal() {
            const goalId = document.getElementById('editGoalId').value;
            const userId = currentUser.uid;

            try {
                await db.collection('users').doc(userId).collection('goals').doc(goalId).delete();
                
                // Invalidar cache
                cache.remove(`goals_${userId}`);
                
                closeEditGoalModal();
                loadGoals();
                showNotification('Meta exclu√≠da com sucesso!', 'success');
            } catch (error) {
                console.error("‚ùå Erro ao excluir meta:", error);
                showNotification("Erro ao excluir meta: " + error.message, "error");
            }
        }

       async function addProgressToGoal(goalId, suggestedAmount = 0) {
    const goal = goals.find(g => g.id === goalId);
    if (!goal) return;

    const amountToAdd = suggestedAmount > 0 
        ? suggestedAmount 
        : parseFloat(prompt(`Quanto deseja adicionar √† meta "${goal.name}"?`, suggestedAmount.toString()));
    
    if (isNaN(amountToAdd) || amountToAdd <= 0) {
        showNotification('Valor inv√°lido', 'warning');
        return;
    }

    const newAmount = goal.currentAmount + amountToAdd;
    const userId = currentUser.uid;

    try {
        await db.collection('users').doc(userId).collection('goals').doc(goalId).update({
            currentAmount: newAmount,
            updatedAt: firebase.firestore.FieldValue.serverTimestamp()
        });

        // Invalidar cache
        cache.remove(`goals_${userId}`);

        loadGoals();
        showNotification(`R$ ${amountToAdd.toLocaleString('pt-BR', {minimumFractionDigits: 2})} adicionado √† meta "${goal.name}"!`, 'success');
        
    } catch (error) {
        console.error("‚ùå Erro ao adicionar progresso:", error);
        showNotification("Erro ao adicionar progresso: " + error.message, "error");
    }
}

        // ===== FUN√á√ïES DE INVESTIMENTOS - CORRIGIDAS =====
        function showSimulator(simulatorType) {
            // Esconder todos os simuladores
            document.querySelectorAll('.simulator-section').forEach(section => {
                if (section.id !== 'marketIndicators') {
                    section.style.display = 'none';
                }
            });

            // Mostrar o simulador selecionado
            if (simulatorType === 'juros-compostos') {
                document.getElementById('juros-compostos-simulator').style.display = 'block';
                calculateCompoundInterest();
            }
        }

        function calculateCompoundInterest() {
            const initialAmount = parseFloat(document.getElementById('initialAmount').value) || 0;
            const monthlyInvestment = parseFloat(document.getElementById('monthlyInvestment').value) || 0;
            const annualRate = parseFloat(document.getElementById('annualRate').value) || 0;
            const investmentPeriod = parseInt(document.getElementById('investmentPeriod').value) || 1;

            const monthlyRate = annualRate / 100 / 12;
            const totalMonths = investmentPeriod * 12;

            let totalValue = initialAmount;
            const monthlyData = [initialAmount];

            for (let i = 1; i <= totalMonths; i++) {
                totalValue = totalValue * (1 + monthlyRate) + monthlyInvestment;
                if (i % 12 === 0) {
                    monthlyData.push(totalValue);
                }
            }

            const totalInvested = initialAmount + (monthlyInvestment * totalMonths);
            const totalInterest = totalValue - totalInvested;
            const profitability = ((totalValue - totalInvested) / totalInvested) * 100;

            // Atualizar resultados
            document.getElementById('totalInvested').textContent = `R$ ${totalInvested.toLocaleString('pt-BR', {minimumFractionDigits: 2})}`;
            document.getElementById('totalInterest').textContent = `R$ ${totalInterest.toLocaleString('pt-BR', {minimumFractionDigits: 2})}`;
            document.getElementById('finalAmount').textContent = `R$ ${totalValue.toLocaleString('pt-BR', {minimumFractionDigits: 2})}`;
            document.getElementById('profitability').textContent = `${profitability.toFixed(2)}%`;

            // Atualizar gr√°fico
            updateCompoundInterestChart(monthlyData, investmentPeriod);
        }

        function updateCompoundInterestChart(data, years) {
            const ctx = document.getElementById('compoundInterestChart').getContext('2d');
            
            if (compoundInterestChart) {
                compoundInterestChart.destroy();
            }

            const labels = Array.from({length: years + 1}, (_, i) => `Ano ${i}`);

            compoundInterestChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Valor Acumulado (R$)',
                        data: data,
                        borderColor: '#10b981',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                color: '#F8FAFC'
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#F8FAFC',
                                callback: function(value) {
                                    return 'R$ ' + value.toLocaleString('pt-BR');
                                }
                            }
                        },
                        x: {
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#F8FAFC'
                            }
                        }
                    }
                }
            });
        }

        async function loadInvestments() {
            if (!currentUser) return;

            const userId = currentUser.uid;

            // Mostrar skeleton loading
            const portfolioList = document.getElementById('investmentPortfolio');
            portfolioList.innerHTML = `
                <div class="skeleton-loading skeleton-card" style="height: 120px;"></div>
                <div class="skeleton-loading skeleton-card" style="height: 120px;"></div>
            `;

            try {
                // Verificar cache primeiro
                const cacheKey = `investments_${userId}`;
                const cachedInvestments = cache.get(cacheKey);
                
                if (cachedInvestments) {
                    investments = cachedInvestments;
                    updateInvestmentPortfolio();
                    return;
                }

                const snapshot = await db.collection('users').doc(userId)
                    .collection('investments')
                    .orderBy('createdAt', 'desc')
                    .get();

                investments = [];
                snapshot.forEach(doc => {
                    investments.push({
                        id: doc.id,
                        ...doc.data()
                    });
                });

                // Salvar no cache
                cache.set(cacheKey, investments);

                updateInvestmentPortfolio();
                
            } catch (error) {
                console.error("‚ùå Erro ao carregar investimentos:", error);
                // Se n√£o houver investimentos, criar alguns de exemplo
                createSampleInvestments();
            }
        }

        function createSampleInvestments() {
            investments = [
                {
                    id: '1',
                    name: 'PETR4',
                    type: 'A√ß√µes',
                    amount: 3500,
                    profitability: 12.5,
                    icon: 'fas fa-chart-line',
                    iconColor: '#2563eb'
                },
                {
                    id: '2',
                    name: 'BCFF11',
                    type: 'FII',
                    amount: 2500,
                    profitability: 8.2,
                    icon: 'fas fa-building',
                    iconColor: '#f59e0b'
                },
                {
                    id: '3',
                    name: 'Tesouro IPCA+',
                    type: 'Tesouro Direto',
                    amount: 2000,
                    profitability: 6.8,
                    icon: 'fas fa-landmark',
                    iconColor: '#10b981'
                },
                {
                    id: '4',
                    name: 'CDB Banco XYZ',
                    type: 'CDB',
                    amount: 1500,
                    profitability: 5.5,
                    icon: 'fas fa-piggy-bank',
                    iconColor: '#8b5cf6'
                }
            ];
            updateInvestmentPortfolio();
        }

        function updateInvestmentPortfolio() {
            // Atualizar gr√°fico de portf√≥lio
            const ctx = document.getElementById('portfolioChart').getContext('2d');
            
            if (portfolioChart) {
                portfolioChart.destroy();
            }

            const portfolioData = {
                labels: investments.map(inv => inv.name),
                data: investments.map(inv => inv.amount),
                backgroundColor: investments.map(inv => inv.iconColor)
            };

            portfolioChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: portfolioData.labels,
                    datasets: [{
                        data: portfolioData.data,
                        backgroundColor: portfolioData.backgroundColor,
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                color: '#F8FAFC',
                                padding: 20
                            }
                        }
                    }
                }
            });

            // Atualizar lista de investimentos
            updateInvestmentPortfolioList();
        }

        function updateInvestmentPortfolioList() {
            const portfolioList = document.getElementById('investmentPortfolio');
            
            if (investments.length === 0) {
                portfolioList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-chart-line"></i>
                        <h3>Nenhum investimento cadastrado</h3>
                        <p>Adicione seu primeiro investimento para come√ßar</p>
                        <button class="btn" onclick="showAddInvestmentModal()" style="margin-top: 15px;">
                            <i class="fas fa-plus"></i> Adicionar Investimento
                        </button>
                    </div>
                `;
                return;
            }

            // Calcular totais
            const totalPortfolio = investments.reduce((sum, inv) => sum + inv.amount, 0);
            const totalReturn = investments.reduce((sum, inv) => sum + (inv.amount * inv.profitability / 100), 0);
            const totalDividends = investments.reduce((sum, inv) => sum + (inv.amount * 0.02), 0); // 2% de dividendos

            // Atualizar estat√≠sticas
            document.getElementById('portfolioTotal').textContent = `R$ ${totalPortfolio.toLocaleString('pt-BR', {minimumFractionDigits: 2})}`;
            document.getElementById('portfolioReturn').textContent = `${totalReturn >= 0 ? '+' : ''}${((totalReturn / totalPortfolio) * 100).toFixed(1)}%`;
            document.getElementById('portfolioDividends').textContent = `R$ ${totalDividends.toLocaleString('pt-BR', {minimumFractionDigits: 2})}`;

            portfolioList.innerHTML = investments.map(investment => {
                const isPositive = investment.profitability >= 0;
                
                return `
                    <div class="portfolio-item">
                        <div class="portfolio-item-content">
                            <div class="portfolio-item-info">
                                <div class="portfolio-item-header">
                                    <div class="portfolio-item-icon" style="background: ${investment.iconColor}20; color: ${investment.iconColor}">
                                        <i class="${investment.icon}"></i>
                                    </div>
                                    <div class="portfolio-item-name">${investment.name}</div>
                                </div>
                                <div class="portfolio-item-details">
                                    <span>${investment.type}</span>
                                    <span>${((investment.amount / totalPortfolio) * 100).toFixed(1)}% do portf√≥lio</span>
                                </div>
                                <div class="portfolio-item-amount">
                                    R$ ${investment.amount.toLocaleString('pt-BR', {minimumFractionDigits: 2})}
                                </div>
                                <div class="portfolio-item-profitability ${isPositive ? 'positive' : 'negative'}">
                                    <i class="fas fa-${isPositive ? 'arrow-up' : 'arrow-down'}"></i>
                                    ${investment.profitability}%
                                </div>
                            </div>
                            <div class="portfolio-item-actions">
                                <button class="btn btn-warning btn-sm" onclick="openEditInvestmentModal('${investment.id}')">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-danger btn-sm" onclick="showConfirmationModal('deleteInvestment', '${investment.id}')">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function showAddInvestmentModal() {
            document.getElementById('addInvestmentModal').classList.add('active');
        }

        function closeAddInvestmentModal() {
            document.getElementById('addInvestmentModal').classList.remove('active');
        }

        function openEditInvestmentModal(investmentId) {
            const investment = investments.find(inv => inv.id === investmentId);
            if (!investment) return;

            document.getElementById('editInvestmentId').value = investment.id;
            document.getElementById('editInvestmentName').value = investment.name;
            document.getElementById('editInvestmentType').value = investment.type;
            document.getElementById('editInvestmentAmount').value = investment.amount;
            document.getElementById('editInvestmentProfitability').value = investment.profitability;

            document.getElementById('editInvestmentModal').classList.add('active');
        }

        function closeEditInvestmentModal() {
            document.getElementById('editInvestmentModal').classList.remove('active');
        }

        const safeAddInvestment = withLoading(addInvestment, 'Adicionando investimento...');

        async function addInvestment() {
            const name = document.getElementById('investmentName').value.trim();
            const type = document.getElementById('investmentType').value;
            const amount = parseFloat(document.getElementById('investmentAmount').value);
            const profitability = parseFloat(document.getElementById('investmentProfitability').value);

            if (!name) {
                showNotification('Digite um nome para o investimento', 'warning');
                return;
            }

            if (isNaN(amount) || amount <= 0) {
                showNotification('Digite um valor v√°lido maior que zero', 'warning');
                return;
            }

            if (!currentUser) {
                showNotification('Voc√™ precisa estar logado', 'error');
                return;
            }

            const userId = currentUser.uid;
            const selectedOption = document.getElementById('investmentType').selectedOptions[0];
            const icon = selectedOption.getAttribute('data-icon');
            const iconColor = selectedOption.getAttribute('data-color');

            const newInvestmentData = {
                name: name,
                type: type,
                amount: amount,
                profitability: profitability,
                icon: icon,
                iconColor: iconColor,
                createdAt: firebase.firestore.FieldValue.serverTimestamp()
            };

            try {
                await db.collection('users').doc(userId).collection('investments').add(newInvestmentData);
                
                // Limpar formul√°rio
                document.getElementById('investmentName').value = '';
                document.getElementById('investmentAmount').value = '';
                document.getElementById('investmentProfitability').value = '0';
                
                // Invalidar cache
                cache.remove(`investments_${userId}`);
                
                closeAddInvestmentModal();
                loadInvestments();
                showNotification('Investimento adicionado com sucesso!', 'success');
                
            } catch (error) {
                console.error("‚ùå Erro ao salvar investimento:", error);
                showNotification("Erro ao salvar investimento: " + error.message, "error");
            }
        }

        const safeUpdateInvestment = withLoading(updateInvestment, 'Atualizando investimento...');

        async function updateInvestment() {
            const investmentId = document.getElementById('editInvestmentId').value;
            const name = document.getElementById('editInvestmentName').value.trim();
            const type = document.getElementById('editInvestmentType').value;
            const amount = parseFloat(document.getElementById('editInvestmentAmount').value);
            const profitability = parseFloat(document.getElementById('editInvestmentProfitability').value);

            if (!name) {
                showNotification('Digite um nome para o investimento', 'warning');
                return;
            }

            if (isNaN(amount) || amount <= 0) {
                showNotification('Digite um valor v√°lido maior que zero', 'warning');
                return;
            }

            const userId = currentUser.uid;
            const selectedOption = document.getElementById('editInvestmentType').selectedOptions[0];
            const icon = selectedOption.getAttribute('data-icon');
            const iconColor = selectedOption.getAttribute('data-color');

            try {
                await db.collection('users').doc(userId).collection('investments').doc(investmentId).update({
                    name: name,
                    type: type,
                    amount: amount,
                    profitability: profitability,
                    icon: icon,
                    iconColor: iconColor,
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                });

                // Invalidar cache
                cache.remove(`investments_${userId}`);

                closeEditInvestmentModal();
                loadInvestments();
                showNotification('Investimento atualizado com sucesso!', 'success');
                
            } catch (error) {
                console.error("‚ùå Erro ao atualizar investimento:", error);
                showNotification("Erro ao atualizar investimento: " + error.message, "error");
            }
        }

       async function deleteInvestment(investmentId = null) {
    // Se n√£o veio por par√¢metro, pega do input
    const id = investmentId || document.getElementById('editInvestmentId').value;
    if (!id) {
        showNotification('ID do investimento n√£o encontrado', 'error');
        return;
    }
    
    const userId = currentUser.uid;

    try {
        await db.collection('users').doc(userId).collection('investments').doc(id).delete();
        
        // Invalidar cache
        cache.remove(`investments_${userId}`);
        
        closeEditInvestmentModal();
        loadInvestments();
        showNotification('Investimento exclu√≠do com sucesso!', 'success');
    } catch (error) {
        console.error("‚ùå Erro ao excluir investimento:", error);
        showNotification("Erro ao excluir investimento: " + error.message, "error");
    }
}

        function refreshPortfolio() {
            // Invalidar cache
            if (currentUser) {
                cache.remove(`investments_${currentUser.uid}`);
            }
            loadInvestments();
            showNotification('Portf√≥lio atualizado!', 'success');
        }

        function loadMarketIndicators() {
            const indicatorsContainer = document.getElementById('marketIndicators');
            
            // Dados de exemplo para indicadores (agora funcionais)
            const indicators = [
                { name: 'IBOVESPA', value: '128.456', change: 1.2, icon: 'fas fa-chart-line' },
                { name: 'USD/BRL', value: '5.25', change: -0.5, icon: 'fas fa-dollar-sign' },
                { name: 'EUR/BRL', value: '5.65', change: 0.3, icon: 'fas fa-euro-sign' },
                { name: 'BTC/BRL', value: '325.000', change: 3.8, icon: 'fas fa-bitcoin' },
                { name: 'SELIC', value: '10.75%', change: 0, icon: 'fas fa-percentage' },
                { name: 'IPCA', value: '4.5%', change: -0.2, icon: 'fas fa-chart-bar' }
            ];

            indicatorsContainer.innerHTML = indicators.map(indicator => {
                const isPositive = indicator.change >= 0;
                
                return `
                    <div class="indicator-card">
                        <div class="indicator-header">
                            <div class="indicator-title">${indicator.name}</div>
                            <div class="indicator-icon">
                                <i class="${indicator.icon}"></i>
                            </div>
                        </div>
                        <div class="indicator-value">${indicator.value}</div>
                        <div class="indicator-change ${isPositive ? 'positive' : 'negative'}">
                            <i class="fas fa-${isPositive ? 'arrow-up' : 'arrow-down'}"></i>
                            ${Math.abs(indicator.change)}%
                        </div>
                    </div>
                `;
            }).join('');
        }

        function refreshIndicators() {
            showNotification('Indicadores atualizados!', 'success');
            loadMarketIndicators();
        }

        // ===== FUN√á√ïES DE LEMBRETES =====
        function showAddReminderModal() {
            document.getElementById('addReminderModal').classList.add('active');
        }

        function closeAddReminderModal() {
            document.getElementById('addReminderModal').classList.remove('active');
        }

        async function addReminder() {
            const title = document.getElementById('reminderTitle').value.trim();
            const description = document.getElementById('reminderDescription').value.trim();
            const amount = parseFloat(document.getElementById('reminderAmount').value) || 0;
            const dueDate = document.getElementById('reminderDueDate').value;
            const category = document.getElementById('reminderCategory').value;

            if (!title) {
                showNotification('Digite um t√≠tulo para o lembrete', 'warning');
                return;
            }

            if (!dueDate) {
                showNotification('Selecione uma data de vencimento', 'warning');
                return;
            }

            if (!currentUser) {
                showNotification('Voc√™ precisa estar logado', 'error');
                return;
            }

            const userId = currentUser.uid;

            const newReminderData = {
                title: title,
                description: description,
                amount: amount,
                dueDate: dueDate,
                category: category,
                status: 'pending',
                createdAt: firebase.firestore.FieldValue.serverTimestamp()
            };

            try {
                await db.collection('users').doc(userId).collection('reminders').add(newReminderData);
                
                // Limpar formul√°rio
                document.getElementById('reminderTitle').value = '';
                document.getElementById('reminderDescription').value = '';
                document.getElementById('reminderAmount').value = '';
                document.getElementById('reminderDueDate').value = '';
                
                // Invalidar cache
                cache.remove(`reminders_${userId}`);
                
                closeAddReminderModal();
                loadReminders();
                showNotification('Lembrete adicionado com sucesso!', 'success');
                
            } catch (error) {
                console.error("‚ùå Erro ao salvar lembrete:", error);
                showNotification("Erro ao salvar lembrete: " + error.message, "error");
            }
        }

        async function loadReminders() {
            if (!currentUser) return;

            const userId = currentUser.uid;

            try {
                // Verificar cache primeiro
                const cacheKey = `reminders_${userId}`;
                const cachedReminders = cache.get(cacheKey);
                
                if (cachedReminders) {
                    reminders = cachedReminders;
                    updateRemindersList();
                    return;
                }

                const snapshot = await db.collection('users').doc(userId)
                    .collection('reminders')
                    .orderBy('dueDate', 'asc')
                    .get();

                reminders = [];
                snapshot.forEach(doc => {
                    reminders.push({
                        id: doc.id,
                        ...doc.data()
                    });
                });

                // Salvar no cache
                cache.set(cacheKey, reminders);

                updateRemindersList();
                
            } catch (error) {
                console.error("‚ùå Erro ao carregar lembretes:", error);
                updateRemindersList();
            }
        }

        function updateRemindersList() {
            const remindersList = document.getElementById('remindersList');
            
            if (reminders.length === 0) {
                remindersList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-bell"></i>
                        <h3>Nenhum lembrete cadastrado</h3>
                        <p>Adicione seu primeiro lembrete de pagamento</p>
                    </div>
                `;
                return;
            }

            const now = new Date();
            remindersList.innerHTML = reminders.map(reminder => {
                const dueDate = new Date(reminder.dueDate);
                const daysDiff = Math.ceil((dueDate - now) / (1000 * 60 * 60 * 24));
                
                let statusClass = 'upcoming';
                let statusText = 'Pr√≥ximo';
                
                if (daysDiff < 0) {
                    statusClass = 'overdue';
                    statusText = 'Atrasado';
                } else if (daysDiff === 0) {
                    statusClass = 'overdue';
                    statusText = 'Hoje';
                } else if (daysDiff <= 3) {
                    statusClass = 'overdue';
                    statusText = 'Em breve';
                }
                
                if (reminder.status === 'paid') {
                    statusClass = 'paid';
                    statusText = 'Pago';
                }
                
                return `
                    <div class="reminder-item ${statusClass}">
                        <div class="reminder-info">
                            <div class="reminder-title">${reminder.title}</div>
                            <div class="reminder-date">
                                Vence em: ${dueDate.toLocaleDateString('pt-BR')} ‚Ä¢ ${statusText}
                            </div>
                            ${reminder.description ? `<div class="reminder-description">${reminder.description}</div>` : ''}
                        </div>
                        <div class="reminder-amount">
                            R$ ${reminder.amount.toLocaleString('pt-BR', {minimumFractionDigits: 2})}
                        </div>
                        <div class="reminder-actions">
                            <button class="btn btn-success btn-sm" onclick="markReminderAsPaid('${reminder.id}')">
                                <i class="fas fa-check"></i>
                            </button>
                            <button class="btn btn-danger btn-sm" onclick="deleteReminder('${reminder.id}')">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        async function markReminderAsPaid(reminderId) {
            const userId = currentUser.uid;

            try {
                await db.collection('users').doc(userId).collection('reminders').doc(reminderId).update({
                    status: 'paid',
                    paidAt: firebase.firestore.FieldValue.serverTimestamp()
                });

                // Invalidar cache
                cache.remove(`reminders_${userId}`);

                loadReminders();
                showNotification('Lembrete marcado como pago!', 'success');
                
            } catch (error) {
                console.error("‚ùå Erro ao atualizar lembrete:", error);
                showNotification("Erro ao atualizar lembrete: " + error.message, "error");
            }
        }

        async function deleteReminder(reminderId) {
            const userId = currentUser.uid;

            try {
                await db.collection('users').doc(userId).collection('reminders').doc(reminderId).delete();
                
                // Invalidar cache
                cache.remove(`reminders_${userId}`);
                
                loadReminders();
                showNotification('Lembrete exclu√≠do com sucesso!', 'success');
            } catch (error) {
                console.error("‚ùå Erro ao excluir lembrete:", error);
                showNotification("Erro ao excluir lembrete: " + error.message, "error");
            }
        }

        // ===== FUN√á√ïES DE CATEGORIAS =====
        function showAddCategoryModal() {
            document.getElementById('addCategoryModal').classList.add('active');
        }

        function closeAddCategoryModal() {
            document.getElementById('addCategoryModal').classList.remove('active');
        }

        async function addCategory() {
            const name = document.getElementById('categoryName').value.trim();
            const icon = document.getElementById('categoryIcon').value;
            const color = document.getElementById('categoryColor').value;

            if (!name) {
                showNotification('Digite um nome para a categoria', 'warning');
                return;
            }

            if (!currentUser) {
                showNotification('Voc√™ precisa estar logado', 'error');
                return;
            }

            const userId = currentUser.uid;

            const newCategoryData = {
                name: name,
                icon: icon,
                color: color,
                createdAt: firebase.firestore.FieldValue.serverTimestamp()
            };

            try {
                await db.collection('users').doc(userId).collection('categories').add(newCategoryData);
                
                // Limpar formul√°rio
                document.getElementById('categoryName').value = '';
                document.getElementById('categoryColor').value = '#2563eb';
                
                // Invalidar cache
                cache.remove(`categories_${userId}`);
                
                closeAddCategoryModal();
                loadCategories();
                showNotification('Categoria adicionada com sucesso!', 'success');
                
            } catch (error) {
                console.error("‚ùå Erro ao salvar categoria:", error);
                showNotification("Erro ao salvar categoria: " + error.message, "error");
            }
        }

        async function loadCategories() {
            if (!currentUser) return;

            const userId = currentUser.uid;

            try {
                // Verificar cache primeiro
                const cacheKey = `categories_${userId}`;
                const cachedCategories = cache.get(cacheKey);
                
                if (cachedCategories) {
                    categories = cachedCategories;
                    updateCategoriesGrid();
                    return;
                }

                const snapshot = await db.collection('users').doc(userId)
                    .collection('categories')
                    .orderBy('createdAt', 'desc')
                    .get();

                categories = [];
                snapshot.forEach(doc => {
                    categories.push({
                        id: doc.id,
                        ...doc.data()
                    });
                });

                // Salvar no cache
                cache.set(cacheKey, categories);

                updateCategoriesGrid();
                
            } catch (error) {
                console.error("‚ùå Erro ao carregar categorias:", error);
                createSampleCategories();
                loadCategoriesIntoSelects();
            }
        }

    // ADICIONE ESTE C√ìDIGO DEPOIS DA FUN√á√ÉO loadCategories()

function loadCategoriesIntoSelects() {
    if (!currentUser || categories.length === 0) return;
    
    // Para receitas
    const revenueSelect = document.getElementById('revenueCategory');
    // Para despesas essenciais
    const essentialSelect = document.getElementById('essentialCategory');
    // Para despesas n√£o essenciais
    const nonEssentialSelect = document.getElementById('nonEssentialCategory');
    
    // Limpar op√ß√µes personalizadas (mantendo as padr√£o)
    removeCustomOptions(revenueSelect);
    removeCustomOptions(essentialSelect);
    removeCustomOptions(nonEssentialSelect);
    
    // Adicionar categorias personalizadas
    categories.forEach(category => {
        // Para receitas
        const revenueOption = document.createElement('option');
        revenueOption.value = category.name.toLowerCase();
        revenueOption.textContent = category.name;
        revenueSelect.appendChild(revenueOption);
        
        // Para despesas essenciais
        const essentialOption = document.createElement('option');
        essentialOption.value = category.name.toLowerCase();
        essentialOption.textContent = category.name;
        essentialSelect.appendChild(essentialOption);
        
        // Para despesas n√£o essenciais
        const nonEssentialOption = document.createElement('option');
        nonEssentialOption.value = category.name.toLowerCase();
        nonEssentialOption.textContent = category.name;
        nonEssentialSelect.appendChild(nonEssentialOption);
    });
}

function removeCustomOptions(select) {
    // Remove apenas as op√ß√µes personalizadas (mantendo as 4 primeiras)
    const options = select.options;
    for (let i = options.length - 1; i >= 4; i--) {
        select.remove(i);
    }
}

        function createSampleCategories() {
            categories = [
                {
                    id: '1',
                    name: 'Alimenta√ß√£o',
                    icon: 'fas fa-utensils',
                    color: '#10b981'
                },
                {
                    id: '2',
                    name: 'Transporte',
                    icon: 'fas fa-car',
                    color: '#2563eb'
                },
                {
                    id: '3',
                    name: 'Lazer',
                    icon: 'fas fa-film',
                    color: '#f59e0b'
                },
                {
                    id: '4',
                    name: 'Sa√∫de',
                    icon: 'fas fa-heart',
                    color: '#ef4444'
                }
            ];
            updateCategoriesGrid();
            loadCategoriesIntoSelects();
        }

        function updateCategoriesGrid() {
            const categoriesGrid = document.getElementById('categoriesGrid');
            
            if (categories.length === 0) {
                categoriesGrid.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-tags"></i>
                        <h3>Nenhuma categoria personalizada</h3>
                        <p>Crie suas categorias para organizar melhor seus gastos</p>
                    </div>
                `;
                return;
            }

            categoriesGrid.innerHTML = categories.map(category => {
                return `
                    <div class="category-card">
                        <div class="category-icon" style="background: ${category.color}20; color: ${category.color}">
                            <i class="${category.icon}"></i>
                        </div>
                        <div class="category-name">${category.name}</div>
                        <div class="category-amount">R$ 0,00</div>
                    </div>
                `;
            }).join('');
        }

        // ===== FUN√á√ïES DE RELAT√ìRIOS PDF =====
        function showReportModal() {
            document.getElementById('reportModal').classList.add('active');
            updateReportSummary();
        }

        function closeReportModal() {
            document.getElementById('reportModal').classList.remove('active');
        }

        function selectReportPeriod(period, event) {
            selectedReportPeriod = period;
            
            // Atualizar UI
            document.querySelectorAll('.report-period-option').forEach(option => {
                option.classList.remove('active');
            });
            event.target.closest('.report-period-option').classList.add('active');
            
            // Mostrar/ocultar se√ß√£o de datas personalizadas
            const customDateRange = document.getElementById('customDateRange');
            if (period === 'custom') {
                customDateRange.style.display = 'block';
            } else {
                customDateRange.style.display = 'none';
            }
            
            updateReportSummary();
        }

        function updateReportSummary() {
            const summaryContainer = document.getElementById('reportSummary');
            
            // Dados de exemplo para o resumo
            const summaryData = {
                totalRevenue: 12500,
                totalExpenses: 8900,
                economy: 3600,
                essentialExpenses: 6500,
                nonEssentialExpenses: 2400
            };

            summaryContainer.innerHTML = `
                <div class="report-summary-item">
                    <span class="report-summary-label">Receita Total</span>
                    <span class="report-summary-value">R$ ${summaryData.totalRevenue.toLocaleString('pt-BR', {minimumFractionDigits: 2})}</span>
                </div>
                <div class="report-summary-item">
                    <span class="report-summary-label">Despesas Totais</span>
                    <span class="report-summary-value negative">R$ ${summaryData.totalExpenses.toLocaleString('pt-BR', {minimumFractionDigits: 2})}</span>
                </div>
                <div class="report-summary-item">
                    <span class="report-summary-label">Economia</span>
                    <span class="report-summary-value positive">R$ ${summaryData.economy.toLocaleString('pt-BR', {minimumFractionDigits: 2})}</span>
                </div>
                <div class="report-summary-item">
                    <span class="report-summary-label">Despesas Essenciais</span>
                    <span class="report-summary-value">R$ ${summaryData.essentialExpenses.toLocaleString('pt-BR', {minimumFractionDigits: 2})}</span>
                </div>
                <div class="report-summary-item">
                    <span class="report-summary-label">Despesas N√£o Essenciais</span>
                    <span class="report-summary-value">R$ ${summaryData.nonEssentialExpenses.toLocaleString('pt-BR', {minimumFractionDigits: 2})}</span>
                </div>
            `;
        }

        function generatePDFReport() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            // Configura√ß√µes do documento
            doc.setFont('helvetica');
            doc.setFontSize(20);
            doc.setTextColor(37, 99, 235);
            doc.text('Relat√≥rio Financeiro - NexusFinance', 20, 30);

            // Informa√ß√µes do per√≠odo
            doc.setFontSize(12);
            doc.setTextColor(100, 100, 100);
            const periodText = getPeriodText();
            doc.text(`Per√≠odo: ${periodText}`, 20, 45);

            // Data de emiss√£o
            const today = new Date().toLocaleDateString('pt-BR');
            doc.text(`Emitido em: ${today}`, 20, 55);

            // Resumo financeiro
            doc.setFontSize(16);
            doc.setTextColor(0, 0, 0);
            doc.text('Resumo Financeiro', 20, 75);

            doc.setFontSize(12);
            doc.setTextColor(100, 100, 100);
            doc.text('Receita Total:', 20, 90);
            doc.text('Despesas Totais:', 20, 100);
            doc.text('Economia:', 20, 110);
            doc.text('Despesas Essenciais:', 20, 120);
            doc.text('Despesas N√£o Essenciais:', 20, 130);

            doc.setTextColor(0, 0, 0);
            doc.text('R$ 12.500,00', 80, 90);
            doc.text('R$ 8.900,00', 80, 100);
            doc.setTextColor(0, 150, 0);
            doc.text('R$ 3.600,00', 80, 110);
            doc.setTextColor(0, 0, 0);
            doc.text('R$ 6.500,00', 80, 120);
            doc.text('R$ 2.400,00', 80, 130);

            // Adicionar uma nova p√°gina para transa√ß√µes
            doc.addPage();
            doc.setFontSize(16);
            doc.setTextColor(0, 0, 0);
            doc.text('Transa√ß√µes Recentes', 20, 30);

            // Tabela de transa√ß√µes (exemplo)
            const transactionsData = [
                { date: '01/01/2024', description: 'Sal√°rio', amount: 'R$ 5.000,00', type: 'Receita' },
                { date: '05/01/2024', description: 'Aluguel', amount: 'R$ 1.200,00', type: 'Despesa' },
                { date: '10/01/2024', description: 'Mercado', amount: 'R$ 450,00', type: 'Despesa' },
                { date: '15/01/2024', description: 'Freelance', amount: 'R$ 800,00', type: 'Receita' }
            ];

            doc.autoTable({
                startY: 45,
                head: [['Data', 'Descri√ß√£o', 'Valor', 'Tipo']],
                body: transactionsData.map(t => [t.date, t.description, t.amount, t.type]),
                theme: 'grid',
                headStyles: { fillColor: [37, 99, 235] },
                styles: { fontSize: 10 }
            });

            // Salvar o PDF
            doc.save(`relatorio-nexusfinance-${today.replace(/\//g, '-')}.pdf`);
            
            showNotification('Relat√≥rio PDF gerado com sucesso!', 'success');
            closeReportModal();
        }

        function getPeriodText() {
            switch(selectedReportPeriod) {
                case 'current-month':
                    return 'M√™s Atual';
                case 'last-3-months':
                    return '√öltimos 3 Meses';
                case 'last-6-months':
                    return '√öltimos 6 Meses';
                case 'custom':
                    const startDate = document.getElementById('reportStartDate').value;
                    const endDate = document.getElementById('reportEndDate').value;
                    if (startDate && endDate) {
                        return `${formatDate(startDate)} a ${formatDate(endDate)}`;
                    }
                    return 'Per√≠odo Personalizado';
                default:
                    return 'M√™s Atual';
            }
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('pt-BR');
        }

        // ===== FUN√á√ïES DE CONFIGURA√á√ïES =====
        function showSettingsModal() {
            if (!currentUser) return;
            
            // Preencher dados atuais
            document.getElementById('settingsUserName').value = currentUser.name;
            document.getElementById('settingsUserEmail').value = currentUser.email;
            document.getElementById('settingsAvatarPreview').textContent = currentUser.avatar;
            
            document.getElementById('settingsModal').classList.add('active');
        }

        function closeSettingsModal() {
            document.getElementById('settingsModal').classList.remove('active');
        }

        function changeAvatar() {
            showNotification('Funcionalidade de upload de foto em desenvolvimento', 'info');
        }

        const safeSaveSettings = withLoading(saveSettings, 'Salvando configura√ß√µes...');

        async function saveSettings() {
            const name = document.getElementById('settingsUserName').value.trim();
            const email = document.getElementById('settingsUserEmail').value.trim();
            const newPassword = document.getElementById('settingsNewPassword').value;
            const confirmPassword = document.getElementById('settingsConfirmPassword').value;

            if (!name) {
                showNotification('Nome √© obrigat√≥rio', 'error');
                return;
            }

            try {
                // Atualizar nome
                await db.collection('users').doc(currentUser.uid).update({
                    name: name,
                    avatar: getInitials(name)
                });

                // Atualizar e-mail se foi alterado
                if (email !== currentUser.email) {
                    await auth.currentUser.updateEmail(email);
                    await db.collection('users').doc(currentUser.uid).update({
                        email: email
                    });
                }

                // Atualizar senha se foi fornecida
                if (newPassword) {
                    if (newPassword !== confirmPassword) {
                        showNotification('As senhas n√£o coincidem', 'error');
                        return;
                    }
                    if (newPassword.length < 6) {
                        showNotification('A senha deve ter pelo menos 6 caracteres', 'error');
                        return;
                    }
                    await auth.currentUser.updatePassword(newPassword);
                }

                // Atualizar dados locais
                currentUser.name = name;
                currentUser.email = email;
                currentUser.avatar = getInitials(name);

                // Invalidar todos os caches
                clearAllCaches();

                // Atualizar interface
                document.getElementById('userName').textContent = name;
                document.getElementById('userAvatar').textContent = getInitials(name);

                closeSettingsModal();
                showNotification('Configura√ß√µes salvas com sucesso!', 'success');

            } catch (error) {
                console.error("‚ùå Erro ao salvar configura√ß√µes:", error);
                showNotification("Erro ao salvar: " + error.message, "error");
            }
        }

        function clearAllCaches() {
            if (!currentUser) return;
            
            const userId = currentUser.uid;
            const keys = Object.keys(localStorage);
            
            keys.forEach(key => {
                if (key.startsWith(`nexus_`) && key.includes(userId)) {
                    cache.remove(key.replace('nexus_', ''));
                }
            });
        }

        // ===== FUN√á√ïES DE TRANSA√á√ïES POR CATEGORIA =====
        async function showCategoryTransactions(category) {
            if (!currentUser) return;

            const categoryNames = {
                'revenue': 'Receitas',
                'essential': 'Despesas Essenciais',
                'non-essential': 'Despesas N√£o Essenciais',
                'economy': 'Economias'
            };

            document.getElementById('categoryModalTitle').textContent = categoryNames[category];
            
            // Carregar transa√ß√µes da categoria selecionada
            const userId = currentUser.uid;
            const monthSelect = document.getElementById('monthSelect');
            const yearSelect = document.getElementById('yearSelect');
            const selectedMonth = parseInt(monthSelect.value);
            const selectedYear = parseInt(yearSelect.value);

            try {
                let categoryTransactions = [];
                
                if (category === 'economy') {
                    // Para economia, calculamos a diferen√ßa entre receitas e despesas
                    const revenueSnapshot = await db.collection('users').doc(userId)
                        .collection('transactions')
                        .orderBy('createdAt', 'desc')
                        .get();

                    const essentialSnapshot = await db.collection('users').doc(userId)
                        .collection('transactions')
                        .orderBy('createdAt', 'desc')
                        .get();

                    const nonEssentialSnapshot = await db.collection('users').doc(userId)
                        .collection('transactions')
                        .orderBy('createdAt', 'desc')
                        .get();

                    let totalRevenue = 0;
                    let totalEssential = 0;
                    let totalNonEssential = 0;

                    revenueSnapshot.forEach(doc => {
                        const data = doc.data();
                        if (data.month === selectedMonth && data.year === selectedYear && data.type === 'revenue') {
                            totalRevenue += data.amount;
                        }
                    });

                    essentialSnapshot.forEach(doc => {
                        const data = doc.data();
                        if (data.month === selectedMonth && data.year === selectedYear && data.type === 'essential') {
                            totalEssential += data.amount;
                        }
                    });

                    nonEssentialSnapshot.forEach(doc => {
                        const data = doc.data();
                        if (data.month === selectedMonth && data.year === selectedYear && data.type === 'non-essential') {
                            totalNonEssential += data.amount;
                        }
                    });

                    const economyAmount = totalRevenue - totalEssential - totalNonEssential;

                    categoryTransactions = [{
                        id: 'economy-summary',
                        description: 'Saldo do M√™s (Receitas - Despesas)',
                        amount: economyAmount,
                        type: 'economy',
                        date: new Date().toISOString()
                    }];
                } else {
                    const snapshot = await db.collection('users').doc(userId)
                        .collection('transactions')
                        .orderBy('createdAt', 'desc')
                        .get();

                    snapshot.forEach(doc => {
                        const data = doc.data();
                        if (data.month === selectedMonth && data.year === selectedYear && data.type === category) {
                            categoryTransactions.push({
                                id: doc.id,
                                ...data
                            });
                        }
                    });
                }

                updateCategoryTransactionsList(categoryTransactions, category);
                document.getElementById('categoryTransactionsModal').classList.add('active');
            } catch (error) {
                console.error("‚ùå Erro ao carregar transa√ß√µes da categoria:", error);
                showNotification("Erro ao carregar transa√ß√µes", "error");
            }
        }

        function updateCategoryTransactionsList(transactions, category) {
            const container = document.getElementById('categoryTransactionsList');
            
            if (transactions.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-exchange-alt"></i>
                        <h3>Nenhuma transa√ß√£o nesta categoria</h3>
                        <p>Adicione transa√ß√µes para v√™-las aqui</p>
                    </div>
                `;
            } else {
                container.innerHTML = transactions.map(transaction => {
                    const date = new Date(transaction.date);
                    const typeLabels = {
                        'revenue': 'Receita',
                        'essential': 'Despesa Essencial',
                        'non-essential': 'Despesa N√£o Essencial',
                        'economy': 'Economia'
                    };
                    
                    return `
                        <div class="category-transaction-item">
                            <div class="category-transaction-info">
                                <div class="category-transaction-description">${transaction.description}</div>
                                <div class="category-transaction-date">
                                    ${typeLabels[transaction.type]} ‚Ä¢ ${date.toLocaleDateString('pt-BR')}
                                </div>
                            </div>
                            <div class="category-transaction-amount ${transaction.type}">
                                R$ ${transaction.amount.toLocaleString('pt-BR', {minimumFractionDigits: 2})}
                            </div>
                            ${transaction.id !== 'economy-summary' ? `
                            <div class="category-transaction-actions">
                                <button class="btn btn-warning btn-sm" onclick="openEditTransactionModal('${transaction.id}')">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-danger btn-sm" onclick="showConfirmationModal('deleteTransaction', '${transaction.id}')">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                            ` : ''}
                        </div>
                    `;
                }).join('');
            }
        }

        function closeCategoryTransactionsModal() {
            document.getElementById('categoryTransactionsModal').classList.remove('active');
        }

        // ===== FUN√á√ïES DE EDI√á√ÉO DE TRANSA√á√ïES =====
        async function openEditTransactionModal(transactionId) {
            const transaction = transactions.find(t => t.id === transactionId);
            if (!transaction) return;

            document.getElementById('editTransactionId').value = transaction.id;
            document.getElementById('editTransactionType').value = transaction.type;
            document.getElementById('editTransactionDescription').value = transaction.description;
            document.getElementById('editTransactionAmount').value = transaction.amount;
            document.getElementById('editTransactionTypeSelect').value = transaction.type;

            document.getElementById('editTransactionModal').classList.add('active');
        }

        function closeEditTransactionModal() {
            document.getElementById('editTransactionModal').classList.remove('active');
        }

        const safeUpdateTransaction = withLoading(updateTransaction, 'Atualizando transa√ß√£o...');

        async function updateTransaction() {
            const transactionId = document.getElementById('editTransactionId').value;
            const description = document.getElementById('editTransactionDescription').value.trim();
            const amount = parseFloat(document.getElementById('editTransactionAmount').value);
            const type = document.getElementById('editTransactionTypeSelect').value;

            if (!description) {
                showNotification('Digite uma descri√ß√£o', 'warning');
                return;
            }

            if (isNaN(amount) || amount <= 0) {
                showNotification('Digite um valor v√°lido maior que zero', 'warning');
                return;
            }

            const userId = currentUser.uid;

            try {
                await db.collection('users').doc(userId).collection('transactions').doc(transactionId).update({
                    description: description,
                    amount: amount,
                    type: type,
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                });

                // Invalidar caches
                const monthSelect = document.getElementById('monthSelect');
                const yearSelect = document.getElementById('yearSelect');
                const selectedMonth = parseInt(monthSelect.value);
                const selectedYear = parseInt(yearSelect.value);
                
                cache.remove(`stats_${userId}_${selectedMonth}_${selectedYear}`);
                cache.remove(`transactions_${userId}_${selectedMonth}_${selectedYear}`);

                closeEditTransactionModal();
                loadTransactions();
                showNotification('Transa√ß√£o atualizada com sucesso!', 'success');
                
            } catch (error) {
                console.error("‚ùå Erro ao atualizar transa√ß√£o:", error);
                showNotification("Erro ao atualizar transa√ß√£o: " + error.message, "error");
            }
        }

        async function deleteTransaction(transactionId = null) {
    // Se n√£o veio por par√¢metro, pega do input
    const id = transactionId || document.getElementById('editTransactionId').value;
    if (!id) {
        showNotification('ID da transa√ß√£o n√£o encontrado', 'error');
        return;
    }
    
    const userId = currentUser.uid;

    try {
        await db.collection('users').doc(userId).collection('transactions').doc(id).delete();
        
        // Invalidar caches
        const monthSelect = document.getElementById('monthSelect');
        const yearSelect = document.getElementById('yearSelect');
        const selectedMonth = parseInt(monthSelect.value);
        const selectedYear = parseInt(yearSelect.value);
        
        cache.remove(`stats_${userId}_${selectedMonth}_${selectedYear}`);
        cache.remove(`transactions_${userId}_${selectedMonth}_${selectedYear}`);
        
        closeEditTransactionModal();
        loadTransactions();
        showNotification('Transa√ß√£o exclu√≠da com sucesso!', 'success');
    } catch (error) {
        console.error("‚ùå Erro ao excluir transa√ß√£o:", error);
        showNotification("Erro ao excluir transa√ß√£o: " + error.message, "error");
    }
}
        // ===== INICIALIZA√á√ÉO =====
        document.addEventListener('DOMContentLoaded', function() {
            checkLoggedInUser();
            
            // Set default dates for custom report
            const now = new Date();
            const firstDay = new Date(now.getFullYear(), now.getMonth(), 1);
            const lastDay = new Date(now.getFullYear(), now.getMonth() + 1, 0);
            
            document.getElementById('reportStartDate').value = firstDay.toISOString().split('T')[0];
            document.getElementById('reportEndDate').value = lastDay.toISOString().split('T')[0];
            
            // Ensure the simulator is calculated when the page loads
            setTimeout(() => {
                if (document.getElementById('juros-compostos-simulator')) {
                    calculateCompoundInterest();
                }
            }, 1000);

            // Listen for online/offline events
            window.addEventListener('online', () => {
                showNotification('Conex√£o restaurada!', 'success');
                // Tentar sincronizar opera√ß√µes pendentes
                syncPendingOperations();
            });

            window.addEventListener('offline', () => {
                showNotification('Voc√™ est√° offline. Algumas funcionalidades podem n√£o estar dispon√≠veis.', 'warning');
            });

            // Melhorar o select de tipos de investimento
            const investmentTypeSelects = document.querySelectorAll('.investment-type-select');
            investmentTypeSelects.forEach(select => {
                select.addEventListener('change', function() {
                    const selectedOption = this.selectedOptions[0];
                    const icon = selectedOption.getAttribute('data-icon');
                    const color = selectedOption.getAttribute('data-color');
                    
                    // Adicionar estilo visual ao select
                    this.style.borderLeft = `4px solid ${color}`;
                    this.style.background = `${color}10`;
                });
                
                // Aplicar estilo inicial
                const selectedOption = select.selectedOptions[0];
                if (selectedOption) {
                    const color = selectedOption.getAttribute('data-color');
                    select.style.borderLeft = `4px solid ${color}`;
                    select.style.background = `${color}10`;
                }
            });
        });

        // ===== SINCRONIZA√á√ÉO OFFLINE =====
        async function syncPendingOperations() {
            if (pendingOperations.length === 0) return;
            
            showNotification('Sincronizando dados offline...', 'info');
            
            for (const operation of pendingOperations) {
                try {
                    switch(operation.type) {
                        case 'transaction':
                            await db.collection('users').doc(currentUser.uid).collection('transactions').add(operation.data);
                            break;
                    }
                    
                    // Remover da fila ap√≥s sucesso
                    const index = pendingOperations.findIndex(op => op.id === operation.id);
                    if (index > -1) {
                        pendingOperations.splice(index, 1);
                    }
                } catch (error) {
                    console.error('Erro ao sincronizar opera√ß√£o:', error);
                }
            }
            
            localStorage.setItem('pending_operations', JSON.stringify(pendingOperations));
            
            if (pendingOperations.length === 0) {
                showNotification('Todos os dados foram sincronizados!', 'success');
            } else {
                showNotification(`${pendingOperations.length} opera√ß√µes pendentes para sincroniza√ß√£o`, 'warning');
            }
            
            // Recarregar dados
            loadTransactions();
            updateDashboardStats();
        }
    </script>
</body>
</html>

